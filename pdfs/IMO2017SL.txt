Shortlisted
Problems
(with solutions)

58th International Mathematical Olympiad
Rio de Janeiro, 12–23 July 2017

Note of Condentiality

The Shortlist has to be kept stri tly ondential
until the on lusion of the following
International Mathemati al Olympiad.
IMO General Regulations 6.6

Contributing Countries
The Organizing Committee and the Problem Sele tion Committee of IMO 2017 thank the
following 51

ontributing 150 problem proposals:

ountries for

Albania,

Algeria,

Armenia,

Belgium,

Bulgaria,

Cuba,

Fran e,

Georgia,

Israel,

Italy,

Mexi o,

Montenegro,

Singapore,
Taiwan,
Ukraine,

Cyprus,

Germany,

Japan,

Tajikistan,

Gree e,

Kazakhstan,
Moro

Slovakia,

Australia,

o,

United Kingdom,

Azerbaijan,

Cze h Republi ,
Hong Kong,
Latvia,

Netherlands,

Slovenia,

Tanzania,

Austria,

India,

Iran,

Lithuania,
Romania,

South Afri a,

Thailand,

Denmark,

Estonia,
Ireland,

Luxembourg,

Russia,

Sweden,

Belarus,

Serbia,

Switzerland,

Trinidad and Tobago,

Turkey,

U.S.A.

Problem Sele tion Committee

Carlos Gustavo Tamm de Araújo Moreira (Gugu) ( hairman),
Lu iano Monteiro de Castro, Ilya I. Bogdanov, Géza Kós, Carlos Yuzo Shine,
Zhuo Qun (Alex) Song, Ralph Costa Teixeira, Eduardo Tengan

4

IMO 2017, Rio de Janeiro

Problems

Algebra
A1.

Let a1 , a2 , . . . , an , k , and M be positive integers su h that

1
1
1
`
` ¨¨¨`
“k
a1 a2
an

a1 a2 . . . an “ M.

and

If M ą 1, prove that the polynomial

P pxq “ Mpx ` 1qk ´ px ` a1 qpx ` a2 q ¨ ¨ ¨ px ` an q
has no positive roots.

A2.

(Trinidad and Tobago)

Let q be a real number. Gugu has a napkin with ten distin t real numbers written

on it, and he writes the following three lines of real numbers on the bla kboard:

• In the rst line, Gugu writes down every number of the form a ´ b, where a and b are two
(not ne essarily distin t) numbers on his napkin.

• In the se ond line, Gugu writes down every number of the form qab, where a and b are
two (not ne essarily distin t) numbers from the

rst line.

• In the third line, Gugu writes down every number of the form a2 ` b2 ´ c2 ´ d2 , where
a, b, c, d are four (not ne essarily distin t) numbers from the rst line.
Determine all values of q su h that, regardless of the numbers on Gugu's napkin, every
number in the se ond line is also a number in the third line.

A3.

(Austria)

Let S be a nite set, and let A be the set of all fun tions from S to S . Let f be an

element of A, and let T “ f pSq be the image of S under f . Suppose that f ˝ g ˝ f ‰ g ˝ f ˝ g
for every g in A with g ‰ f . Show that f pT q “ T .

A4.

(India)

A sequen e of real numbers a1 , a2 , . . . satises the relation

an “ ´ max pai ` aj q
i`j“n

for all n ą 2017.

Prove that this sequen e is bounded, i.e., there is a
positive integers n.

onstant M su h that |an | ď M for all

(Russia)

Shortlisted problems

A5.

5

An integer n ě 3 is given. We

all an n-tuple of real numbers px1 , x2 , . . . , xn q

Shiny

if for ea h permutation y1 , y2 , . . . , yn of these numbers we have

n´1
ÿ
i“1

Find the largest

yi yi`1 “ y1 y2 ` y2 y3 ` y3 y4 ` ¨ ¨ ¨ ` yn´1 yn ě ´1.

onstant K “ Kpnq su h that

ÿ

1ďiăjďn

xi xj ě K

holds for every Shiny n-tuple px1 , x2 , . . . , xn q.

A6.

(Serbia)

Find all fun tions f : R Ñ R su h that

f pf pxqf pyqq ` f px ` yq “ f pxyq
for all x, y P R.

A7.

(Albania)

Let a0 , a1 , a2 , . . . be a sequen e of integers and b0 , b1 , b2 , . . . be a sequen e of

positive

integers su h that a0 “ 0, a1 “ 1, and

#
an bn ` an´1 ,
an`1 “
an bn ´ an´1 ,

if bn´1 “ 1
if bn´1 ą 1

for n “ 1, 2, . . ..

Prove that at least one of the two numbers a2017 and a2018 must be greater than or equal to 2017.

A8.

(Australia)

Assume that a fun tion f : R Ñ R satises the following

`

˘`

ondition:

˘

For every x, y P R su h that f pxq ` y f pyq ` x ą 0, we have f pxq ` y “ f pyq ` x.
Prove that f pxq ` y ď f pyq ` x whenever x ą y .

(Netherlands)

6

IMO 2017, Rio de Janeiro

Combinatori s
C1.

A re tangle R with odd integer side lengths is divided into small re tangles with integer

side lengths. Prove that there is at least one among the small re tangles whose distan es from
the four sides of R are either all odd or all even.

C2.

Let n be a positive integer. Dene a

exa tly n o

(Singapore)

hameleon to be any sequen e of 3n letters, with
swap to be the transposition of

urren es of ea h of the letters a, b, and c. Dene a

two adja ent letters in a hameleon. Prove that for any hameleon X , there exists a hameleon Y
2
su h that X annot be hanged to Y using fewer than 3n {2 swaps.

C3.

(Australia)

Sir Alex plays the following game on a row of 9

ells. Initially, all

ells are empty. In

ea h move, Sir Alex is allowed to perform exa tly one of the following two operations:

j
(1) Choose any number of the form 2 , where j is a non-negative integer, and put it into an
empty

ell.

(2) Choose two (not ne essarily adja ent) ells with the same number in them; denote that
j
j`1
and erase the number in
number by 2 . Repla e the number in one of the ells with 2
the other

ell.

At the end of the game, one
while the other

ell

n
ontains the number 2 , where n is a given positive integer,

ells are empty. Determine the maximum number of moves that Sir Alex

have made, in terms of n.

C4.

Let N ě 2 be an integer. NpN ` 1q so

ould

(Thailand)
er players, no two of the same height, stand

in a row in some order. Coa h Ralph wants to remove NpN ´ 1q people from this row so that
in the remaining row of 2N players, no one stands between the two tallest ones, no one stands

between the third and the fourth tallest ones, . . . , and nally no one stands between the two
shortest ones. Show that this is always possible.

C5.

(Russia)

A hunter and an invisible rabbit play a game in the Eu lidean plane. The hunter's

starting point H0

th

oin ides with the rabbit's starting point R0 . In the n

(n ě 1), the following happens.

(1) First the invisible rabbit moves se retly and unobserved from its

round of the game

urrent point Rn´1 to

some new point Rn with Rn´1 Rn “ 1.

1
(2) The hunter has a tra king devi e (e.g. dog) that returns an approximate position Rn of
1
the rabbit, so that Rn Rn ď 1.
(3) The hunter then visibly moves from point Hn´1 to a new point Hn with Hn´1 Hn “ 1.
9
Is there a strategy for the hunter that guarantees that after 10 su h rounds the distan e
between the hunter and the rabbit is below 100?

(Austria)

Shortlisted problems

C6.
unit

7

Let n ą 1 be an integer. An n ˆ n ˆ n

ube is painted with one

ube is

olor. For ea h n ˆ n ˆ 1 box

of the three possible orientations), we

3
omposed of n unit ubes. Ea h
2
onsisting of n unit ubes (of any

onsider the set of the

olor is listed only on e). This way, we get 3n sets of

olors present in that box (ea h

olors, split into three groups a

ording

to the orientation. It happens that for every set in any group, the same set appears in both
of the other groups. Determine, in terms of n, the maximal possible number of

olors that are

present.

C7.

(Russia)
For any nite sets X and Y of positive integers, denote by fX pkq the k

th

smallest

positive integer not in X , and let

X ˚ Y “ X Y tfX pyq : y P Y u.
Let A be a set of a ą 0 positive integers, and let B be a set of b ą 0 positive integers. Prove
that if A ˚ B “ B ˚ A, then

A
˚ pA ˚ ¨ ¨ ¨ ˚ pA ˚ pA ˚ Aqq . . . q “ looooooooooooooooooomooooooooooooooooooon
B ˚ pB ˚ ¨ ¨ ¨ ˚ pB ˚ pB ˚ Bqq . . . q .
looooooooooooooooooomooooooooooooooooooon
A appears b times

C8.

Let

B appears a times

n be a given positive integer.

with nonnegative

oordinates initially

(U.S.A.)

In the Cartesian plane, ea h latti e point

ontains a buttery, and there are no other butter-

neighborhood of a latti e point c onsists of all latti e points within the axis-aligned
entered at c, apart from c itself. We all a buttery lonely, rowded,
omfortable, depending on whether the number of butteries in its neighborhood N is re-

ies. The

p2n ` 1q ˆ p2n ` 1q square

or

spe tively less than, greater than, or equal to half of the number of latti e points in N .
Every minute, all lonely butteries y away simultaneously.

This pro ess goes on for as

long as there are any lonely butteries. Assuming that the pro ess eventually stops, determine
the number of

omfortable butteries at the nal state.

(Bulgaria)

8

IMO 2017, Rio de Janeiro

Geometry
G1.

onvex pentagon su h that AB “ BC “ CD , =EAB “ =BCD ,
“ =CBA. Prove that the perpendi ular line from E to BC and the line segments AC and BD are on urrent.
Let ABCDE be a

and =EDC

(Italy)

G2.

Let R and S be distin t points on ir le Ω, and let t denote the tangent line to Ω
1
at R. Point R is the ree tion of R with respe t to S . A point I is hosen on the smaller ar
RS of Ω so that the ir um ir le Γ of triangle ISR1 interse ts t at two dierent points. Denote
by A the ommon point of Γ and t that is
1
that JR is tangent to Γ.

G3.

Let O be the

losest to R. Line AI meets Ω again at J . Show

(Luxembourg)

ir um enter of an a ute s alene triangle ABC . Line OA interse ts the

altitudes of ABC through B and C at P and Q, respe tively. The altitudes meet at H . Prove
that the

ir um enter of triangle P QH lies on a median of triangle ABC .

G4.

In triangle ABC , let ω be the ex ir le opposite A. Let D , E , and F be the points

where ω is tangent to lines BC , CA, and AB , respe tively. The
at P and Q. Let M be the midpoint of AD . Prove that the

G5.

Let ABCC1 B1 A1 be a

(Ukraine)

ir le AEF interse ts line BC

ir le MP Q is tangent to ω .

(Denmark)

onvex hexagon su h that AB “ BC , and suppose that the

line segments AA1 , BB1 , and CC1 have the same perpendi ular bise tor.

Let the diagonals

AC1 and A1 C meet at D , and denote by ω the ir le ABC . Let ω interse t the
again at E ‰ B . Prove that the lines BB1 and DE interse t on ω .

G6.

ir le A1 BC1

(Ukraine)

Let n ě 3 be an integer. Two regular n-gons A and B are given in the plane. Prove

that the verti es of A that lie inside B or on its boundary are

onse utive.

(That is, prove that there exists a line separating those verti es of A that lie inside B or on
its boundary from the other verti es of A.)

G7.

A

(Cze h Republi )

onvex quadrilateral ABCD has an ins ribed

ir le with

enter I . Let Ia , Ib , Ic ,

and Id be the in enters of the triangles DAB , ABC , BCD , and CDA, respe tively. Suppose
that the

external tangents of the

G8.

ir les AIb Id and CIb Id meet at X , and the ommon
0
ir les BIa Ic and DIa Ic meet at Y . Prove that =XIY “ 90 .

ommon external tangents of the

(Kazakhstan)

There are 2017 mutually external

are tangent and no three share a
is a

ommon tangent to two

ir les drawn on a bla kboard, su h that no two

ommon tangent. A

tangent segment is a line segment that

ir les, starting at one tangent point and ending at the other one.

Lu iano is drawing tangent segments on the bla kboard, one at a time, so that no tangent
segment interse ts any other

ir les or previously drawn tangent segments.

drawing tangent segments until no more
segments when he stops drawing.

Lu iano keeps

an be drawn. Find all possible numbers of tangent

(Australia)

Shortlisted problems

9

This page is intentionally left blank

10

IMO 2017, Rio de Janeiro

Number Theory
N1.

The sequen e a0 , a1 , a2 , . . . of positive integers satises

#?
an ,
an`1 “
an ` 3,

if

?
an is an integer

otherwise

for every n ě 0.

Determine all values of a0 ą 1 for whi h there is at least one number a su h that an “ a for

innitely many values of n.

N2.

(South Afri a)

Let p ě 2 be a prime number. Eduardo and Fernando play the following game making

moves alternately: in ea h move, the
that was not

urrent player hooses an index i in the set t0, 1, . . . , p´1u

hosen before by either of the two players and then

hooses an element ai of the

set t0, 1, 2, 3, 4, 5, 6, 7, 8, 9u. Eduardo has the rst move. The game ends after all the indi es

i P t0, 1, . . . , p ´ 1u have been

hosen. Then the following number is

M “ a0 ` 10 ¨ a1 ` ¨ ¨ ¨ ` 10

p´1

¨ ap´1 “

p´1
ÿ
j“0

omputed:

aj ¨ 10j .

The goal of Eduardo is to make the number M divisible by p, and the goal of Fernando is to
prevent this.
Prove that Eduardo has a winning strategy.

N3.

(Moro o)

Determine all integers n ě 2 with the following property: for any integers a1 , a2 , . . . , an

whose sum is not divisible by n, there exists an index 1 ď i ď n su h that none of the numbers

ai , ai ` ai`1 , . . . , ai ` ai`1 ` ¨ ¨ ¨ ` ai`n´1
is divisible by n. (We let ai “ ai´n when i ą n.)

N4.

Call a rational number

(Thailand)

short if it has nitely many digits in its de imal expansion.
-tasti if there exists a number

For a positive integer m, we say that a positive integer t is m
t

10 ´ 1
10k ´ 1
is short, and su h that
is not short for any
c¨m
c¨m
1 ď k ă t. Let Spmq be the set of m-tasti numbers. Consider Spmq for m “ 1, 2, . . .. What is
the maximum number of elements in Spmq?
c P t1, 2, 3, . . . , 2017u su h that

N5.

(Turkey)

Find all pairs pp, qq of prime numbers with p ą q for whi h the number

pp ` qqp`q pp ´ qqp´q ´ 1
pp ` qqp´q pp ´ qqp`q ´ 1
is an integer.

(Japan)

Shortlisted problems

N6.

11

Find the smallest positive integer n, or show that no su h n exists, with the following

property: there are innitely many distin t n-tuples of positive rational numbers pa1 , a2 , . . . , an q

su h that both

a1 ` a2 ` ¨ ¨ ¨ ` an

1
1
1
`
` ¨¨¨`
a1 a2
an

and

are integers.

N7.

(Singapore)

Say that an ordered pair px, yq of integers is an

irredu ible latti e point if x and

y are relatively prime. For any nite set S of irredu ible latti e points, show that there is a
homogenous polynomial in two variables, f px, yq, with integer oe ients, of degree at least 1,
su h that f px, yq “ 1 for ea h px, yq in the set S .
Note: A homogenous polynomial of degree n is any nonzero polynomial of the form
f px, yq “ a0 xn ` a1 xn´1 y ` a2 xn´2 y 2 ` ¨ ¨ ¨ ` an´1 xy n´1 ` an y n .

N8.

(U.S.A.)
Let p be an odd prime number and Zą0 be the set of positive integers. Suppose that

a fun tion f : Zą0 ˆ Zą0 Ñ t0, 1u satises the following properties:

• f p1, 1q “ 0;
• f pa, bq ` f pb, aq “ 1 for any pair of relatively prime positive integers pa, bq not both equal
to 1;
• f pa ` b, bq “ f pa, bq for any pair of relatively prime positive integers pa, bq.
Prove that

p´1
ÿ

n“1

f pn2 , pq ě

a

2p ´ 2.

(Italy)

12

IMO 2017, Rio de Janeiro

Solutions
Algebra
A1.

Let a1 , a2 , . . . , an , k , and M be positive integers su h that

1
1
1
`
` ¨¨¨`
“k
a1 a2
an

and

a1 a2 . . . an “ M.

If M ą 1, prove that the polynomial

P pxq “ Mpx ` 1qk ´ px ` a1 qpx ` a2 q ¨ ¨ ¨ px ` an q
has no positive roots.

Solution 1.

(Trinidad and Tobago)

We rst prove that, for x ą 0,

ai px ` 1q1{ai ď x ` ai ,
with equality if and only if ai “ 1. It is

(1)

lear that equality o

If ai ą 1, the AMGM inequality applied to a single

yields

urs if ai “ 1.

opy of x ` 1 and ai ´ 1

opies of 1

ai ´1 ones
hkkkkkkkikkkkkkkj
a
px ` 1q ` 1 ` 1 ` ¨ ¨ ¨ ` 1
ě ai px ` 1q ¨ 1ai ´1 ùñ ai px ` 1q1{ai ď x ` ai .
ai
Sin e x ` 1 ą 1, the inequality is stri t for ai ą 1.
Multiplying the inequalities (1) for i “ 1, 2, . . . , n yields
n
ź
i“1

ai px ` 1q1{ai ď

n
n
ź
ź
řn
px ` ai q ðñ Mpx ` 1q i“1 1{ai ´
px ` ai q ď 0 ðñ P pxq ď 0
i“1

i“1

with equality i ai “ 1 for all i P t1, 2, . . . , nu. But this implies M “ 1, whi h is not possible.
`
Hen e P pxq ă 0 for all x P R , and P has no positive roots.

Inequality (1) an be obtained in several ways. For instan e, we may also use the
binomial theorem: sin e ai ě 1,
ˆ
ˆ ˙ ˆ ˙
˙
ai ˆ ˙ ˆ ˙j
ÿ
x ai
ai
ai
ai
x
x
1`
“
ě
“ 1 ` x.
`
¨
ai
ai
ai
j
0
1
j“0

Comment 1.

Both proofs of (1) mimi proofs to Bernoulli's inequality for a positive integer exponent ai ; we an
use this inequality dire tly:
ˆ
˙
x ai
x
1`
“ 1 ` x,
ě 1 ` ai ¨
ai
ai

and so

x ` ai “ ai

ˆ

x
1`
ai

˙

ě ai p1 ` xq1{ai ,

or its (reversed) formulation, with exponent 1{ai ď 1:

p1 ` xq1{ai ď 1 `

1
x ` ai
¨x“
ùñ ai p1 ` xq1{ai ď x ` ai .
ai
ai

Shortlisted problems  solutions

Solution 2.

13

We will prove that, in fa t, all oe ients of the polynomial P pxq are non-positive,

and at least one of them is negative, whi h implies that P pxq ă 0 for x ą 0.

Indeed, sin e aj ě 1 for all j and aj ą 1 for some j (sin e a1 a2 . . . an “ M ą 1), we have
k “ a11 ` a12 ` ¨ ¨ ¨ ` a1n ă n, so the oe ient of xn in P pxq is ´1 ă 0. Moreover, the oe ient
r
of x in P pxq is negative for k ă r ď n “ degpP q.
r
For 0 ď r ď k , the oe ient of x in P pxq is
ˆ ˙
ˆ ˙
ÿ
ÿ
k
k
´
ai1 ai2 ¨ ¨ ¨ ain´r ,
´
ai1 ai2 ¨ ¨ ¨ ain´r “ a1 a2 ¨ ¨ ¨ an ¨
M¨
r
r
1ďi ăi ă¨¨¨ăi
ďn
1ďi ăi ă¨¨¨ăi
ďn
1

n´r

2

1

whi h is non-positive i

n´r

2

ˆ ˙
ÿ
1
k
ď
.
r
a a ¨ ¨ ¨ ajr
1ďj ăj ă¨¨¨ăj ďn j1 j2
1

(2)

r

2

We will prove (2) by indu tion on r . For r “ 0 it is an equality be ause the onstant term of
ř
P pxq is P p0q “ 0, and if r “ 1, (2) be omes k “ ni“1 a1i . For r ą 1, if (2) is true for a given
r ă k , we have
ˆ ˙
˙
ˆ
ÿ
k´r
k
k´r
1
k
ď
¨
¨
,
“
r`1
r ` 1 1ďj ăj ă¨¨¨ăj ďn aj1 aj2 ¨ ¨ ¨ ajr
r
r`1
1

r

2

and it su es to prove that

ÿ
ÿ
1
k´r
¨
ď
r ` 1 1ďj ăj ă¨¨¨ăj ďn aj1 aj2 ¨ ¨ ¨ ajr
1ďj ă¨¨¨ăj ăj
1

r

2

r

1

r`1

1
,
a
a
a
¨
¨
¨
a
j
j
j
j
r
r`1
1
2
ďn

whi h is equivalent to

ˆ

1
1
1
` `¨¨¨` ´r
a1 a2
an

˙

ÿ

ÿ
1
ď pr ` 1q
a a ¨ ¨ ¨ ajr
1ďj ăj ă¨¨¨ăj ďn j1 j2
1ďj ă¨¨¨ăj ăj
1

2

Sin e there are r ` 1 ways to

term

r

1

hoose a fra tion

r

r`1

1
.
a a ¨ ¨ ¨ ajr ajr`1
ďn j1 j2

1
1
from
to fa tor out, every
aji
aj1 aj2 ¨¨¨ajr ajr`1

1
in the right hand side appears exa tly r ` 1 times in the produ t
aj1 aj2 ¨¨¨ajr ajr`1

ˆ

1
1
1
`
` ¨¨¨`
a1 a2
an

Hen e all terms in the right hand side

˙

1
.
a a ¨ ¨ ¨ ajr
1ďj ăj ă¨¨¨ăj ďn j1 j2

1

`

1
aj1 a2j2 ¨ ¨ ¨ ajr

` ¨¨¨`

1

2

r

an el out.

The remaining terms in the left hand side

a2j1 aj2 ¨ ¨ ¨ ajr

ÿ

an be grouped in sums of the type

1
r
´
2
aj1 aj2 ¨ ¨ ¨ ajr
aj1 aj2 ¨ ¨ ¨ ajr
ˆ
˙
1
1
1
1
´r ,
`
` ¨¨¨`
“
aj1 aj2 ¨ ¨ ¨ ajr aj1 aj2
ajr

whi h are all non-positive be ause ai ě 1

ùñ a1i ď 1, i “ 1, 2, . . . , n.

The result is valid for any real numbers ai , i “ 1, 2, . . . , n with ai ě 1 and produ t M
greater than 1. A variation of Solution 1, namely using weighted AMGM (or the Bernoulli inequality
for real exponents), a tually proves that P pxq ă 0 for x ą ´1 and x ‰ 0.
Comment 2.

14

IMO 2017, Rio de Janeiro

A2.

Let q be a real number. Gugu has a napkin with ten distin t real numbers written on

it, and he writes the following three lines of real numbers on the bla kboard:

• In the rst line, Gugu writes down every number of the form a ´ b, where a and b are two
(not ne essarily distin t) numbers on his napkin.

• In the se ond line, Gugu writes down every number of the form qab, where a and b are
two (not ne essarily distin t) numbers from the

rst line.

• In the third line, Gugu writes down every number of the form a2 ` b2 ´ c2 ´ d2 , where
a, b, c, d are four (not ne essarily distin t) numbers from the rst line.
Determine all values of q su h that, regardless of the numbers on Gugu's napkin, every
number in the se ond line is also a number in the third line.

Answer:

´2, 0, 2.

Solution 1.

Call a number q

(Austria)

good if every number in the se ond line appears in the third line

un onditionally. We rst show that the numbers 0 and ˘2 are good. The third line ne essarily

ontains 0, so 0 is good. For any two numbers a, b in the rst line, write a “ x´y and b “ u´v ,

where x, y, u, v are (not ne essarily distin t) numbers on the napkin. We may now write

2ab “ 2px ´ yqpu ´ vq “ px ´ vq2 ` py ´ uq2 ´ px ´ uq2 ´ py ´ vq2 ,
whi h shows that 2 is good. By negating both sides of the above equation, we also see that ´2
is good.

We now show that ´2, 0, and 2 are the only good numbers. Assume for sake of

that q is a good number, where q R t´2, 0, 2u.

numbers on Gugu's napkin to arrive at a

also

hoi es of

ontradi tion.

The se ond line then

ontain both of them. But the third line only

Furthermore, the third line

ontradi tion

onsider some parti ular

ontains the integers 1, 2, . . . , 10.

Assume that the napkin
the integers ´9, ´8, . . . , 9.

We now

Then, the rst line

ontains

ontains q and 81q , so the third line must
ontains integers, so q must be an integer.
2
` 92 ´ 02 ´ 02 or less

ontains no number greater than 162 “ 9

than ´162, so we must have ´162 ď 81q ď 162. This shows that the only possibilities for q

are ˘1.

Now assume that q “ ˘1. Let the napkin

line

ontain 0, 1, 4, 8, 12, 16, 20, 24, 28, 32. The rst

ontains ˘1 and ˘4, so the se ond line

rst line, a ı 2 pmod 4q, so we may
number in the third line must be

be in the third line, whi h is a
Solution 2.

ontains ˘4. However, for every number a in the
2
on lude that a ” 0, 1 pmod 8q. Consequently, every

ongruent to ´2, ´1, 0, 1, 2 pmod 8q; in parti ular, ˘4

annot

ontradi tion.

Let q be a good number, as dened in the rst solution, and dene the polynomial

P px1 , . . . , x10 q as
ź
ź`
˘
qpx1 ´ x2 qpx3 ´ x4 q ´ pa1 ´ a2 q2 ´ pa3 ´ a4 q2 ` pa5 ´ a6 q2 ` pa7 ´ a8 q2 ,
pxi ´ xj q
iăj

ai PS

where S “ tx1 , . . . , x10 u.
We

laim that P px1 , . . . , x10 q “ 0 for every

hoi e of real numbers px1 , . . . , x10 q. If any two

of the xi are equal, then P px1 , . . . , x10 q “ 0 trivially. If no two are equal, assume that Gugu

has those ten numbers x1 , . . . , x10 on his napkin. Then, the number qpx1 ´ x2 qpx3 ´ x4 q is in
the se ond line, so we must have some a1 , . . . , a8 so that

qpx1 ´ x2 qpx3 ´ x4 q ´ pa1 ´ a2 q2 ´ pa3 ´ a4 q2 ` pa5 ´ a6 q2 ` pa7 ´ a8 q2 “ 0,

Shortlisted problems  solutions

15

and hen e P px1 , . . . , x10 q “ 0.

Sin e every polynomial that evaluates to zero everywhere is the zero polynomial, and the

produ t of two nonzero polynomials is ne essarily nonzero, we may dene F su h that

F px1 , . . . , x10 q ” qpx1 ´ x2 qpx3 ´ x4 q ´ pa1 ´ a2 q2 ´ pa3 ´ a4 q2 ` pa5 ´ a6 q2 ` pa7 ´ a8 q2 ” 0 (1)
for some parti ular

hoi e ai P S .

Ea h of the sets ta1 , a2 u, ta3 , a4 u, ta5 , a6 u, and ta7 , a8 u is equal to at most one of the four

sets tx1 , x3 u, tx2 , x3 u, tx1 , x4 u, and tx2 , x4 u. Thus, without loss of generality, we may assume
that at most one of the sets ta1 , a2 u, ta3 , a4 u, ta5 , a6 u, and ta7 , a8 u is equal to tx1 , x3 u.

Let

u1 , u3 , u5 , u7 be the indi ator fun tions for this equality of sets: that is, ui “ 1 if and only if
tai , ai`1 u “ tx1 , x3 u. By assumption, at least three of the ui are equal to 0.
We now ompute the oe ient of x1 x3 in F . It is equal to q ` 2pu1 ` u3 ´ u5 ´ u7 q “ 0,
and sin e at least three of the ui are zero, we must have that q P t´2, 0, 2u, as desired.

16

IMO 2017, Rio de Janeiro

A3.

Let S be a nite set, and let A be the set of all fun tions from S to S . Let f be an

element of A, and let T “ f pSq be the image of S under f . Suppose that f ˝ g ˝ f ‰ g ˝ f ˝ g

for every g in A with g ‰ f . Show that f pT q “ T .
Solution. For

n ě 1, denote the n-th

(India)

omposition of f with itself by

def

f n “ flooooooomooooooon
˝ f ˝ ¨¨¨˝ f .
n times

By hypothesis, if g P A satises f ˝ g ˝ f “ g ˝ f ˝ g , then g “ f . A natural idea is to try to
n
n
plug in g “ f for some n in the expression f ˝ g ˝ f “ g ˝ f ˝ g in order to get f “ f , whi h
solves the problem:

Claim. If there exists n ě 3 su h that f n`2 “ f 2n`1 , then the restri tion f : T Ñ T of f to T

is a bije tion.

Proof. Indeed, by hypothesis, f n`2 “ f 2n`1 ðñ f ˝ f n ˝ f “ f n ˝ f ˝ f n ùñ f n “ f .

n´2
n´2
Sin e n ´ 2 ě 1, the image of f
is ontained in T “ f pSq, hen e f
restri ts to a fun tion
n´2
f
: T Ñ T . This is the inverse of f : T Ñ T . In fa t, given t P T , say t “ f psq with s P S ,
we have

t “ f psq “ f n psq “ f n´2 pf ptqq “ f pf n´2 ptqq,

f n´2 ˝ f “ f ˝ f n´2 “ id on T

i.e.,

(here id stands for the identity fun tion). Hen e, the restri tion f : T Ñ T of f to T is bije tive
n´2
with inverse given by f
: T Ñ T.
l
It remains to show that n as in the

def

Sm “ f m pSq
Clearly the image of f

m`1

laim exists. For that, dene

pSm is image of f m q

ontained in the image of f

is

m

, i.e., there is a des ending

hain of

subsets of S

S Ě S1 Ě S2 Ě S3 Ě S4 Ě ¨ ¨ ¨ ,

whi h must eventually stabilise sin e S is nite, i.e., there is a k ě 1 su h that

def

Sk “ Sk`1 “ Sk`2 “ Sk`3 “ ¨ ¨ ¨ “ S8 .
Hen e f restri ts to a

surje tive fun tion f : S8 Ñ S8 , whi h is also bije tive sin e S8 Ď S is

nite. To sum up, f : S8 Ñ S8 is a permutation of the elements of the nite set S8 , hen e
r
there exists an integer r ě 1 su h that f “ id on S8 (for example, we may hoose r “ |S8 |!).
In other words,

f m`r “ f m on S for all m ě k.

“ f m for all integers t ě 1 and m ě k . So, to nd n as in
the laim and nish the problem, it is enough to hoose m and t in order to ensure that there
exists n ě 3 satisfying
#
#
2n ` 1 “ m ` tr
m “ 3 ` tr
ðñ
n`2“m
n “ m ´ 2.

Clearly, p˚q also implies that f

This

an be

learly done by

m`tr

p˚q

hoosing m large enough with m ” 3 pmod rq. For instan e, we

may take n “ 2kr ` 1, so that

f n`2 “ f 2kr`3 “ f 4kr`3 “ f 2n`1
where the middle equality follows by p˚q sin e 2kr ` 3 ě k .

Shortlisted problems  solutions

A4.

17

A sequen e of real numbers a1 , a2 , . . . satises the relation

an “ ´ max pai ` aj q
i`j“n

for all n ą 2017.

Prove that this sequen e is bounded, i.e., there is a
positive integers n.

onstant M su h that |an | ď M for all

(Russia)

Set D “ 2017. Denote

Solution 1.

Mn “ max ak
Clearly, the sequen es
bounded.

mn “ ´ min ak “ maxp´ak q.

and

kăn

kăn

pmn q and pMn q are nonde reasing.

kăn

We need to prove that both are

Consider an arbitrary n ą D ; our rst aim is to bound an in terms of mn and Mn .

(i) There exist indi es p and q su h that an “ ´pap ` aq q and p ` q “ n. Sin e ap , aq ď Mn , we
have an ě ´2Mn .

(ii) On the other hand,

hoose an index k ă n su h that ak “ Mn . Then, we have

an “ ´ maxpan´ℓ ` aℓ q ď ´pan´k ` ak q “ ´an´k ´ Mn ď mn ´ Mn .
ℓăn

Summarizing (i) and (ii), we get

´2Mn ď an ď mn ´ Mn ,
when e

mn ď mn`1 ď maxtmn , 2Mn u
Now, say that an index n ą D is

and

Mn ď Mn`1 ď maxtMn , mn ´ Mn u.

(1)

lu ky if mn ď 2Mn . Two ases are possible.

Case 1. Assume that there exists a lu ky index n. In this

ase, (1) yields mn`1 ď 2Mn and

Mn ď Mn`1 ď Mn . Therefore, Mn`1 “ Mn and mn`1 ď 2Mn “ 2Mn`1 . So, the index n ` 1
is also lu ky, and Mn`1 “ Mn . Applying the same arguments repeatedly, we obtain that all
indi es k ą n are lu ky (i.e., mk ď 2Mk for all these indi es), and Mk “ Mn for all su h indi es.
Thus, all of the mk and Mk are bounded by 2Mn .
Case 2. Assume now that there is no lu ky index, i.e., 2Mn ă mn for all n ą D. Then (1)
shows that for all n ą D we have mn ď mn`1 ď mn , so mn “ mD`1 for all n ą D . Sin e
Mn ă mn {2 for all su h indi es, all of the mn and Mn are bounded by mD`1 .
Thus, in both ases the sequen es pmn q and pMn q are bounded, as desired.
Solution 2.

As in the previous solution, let D “ 2017. If the sequen e is bounded above, say,

by Q, then we have that an ě minta1 , . . . , aD , ´2Qu for all n, so the sequen e is bounded. As-

sume for sake of ontradi tion that the sequen e is not bounded above. Let ℓ “ minta1 , . . . , aD u,
and L “ maxta1 , . . . , aD u. Call an index n

good if the following riteria hold:

an ą ai for ea h i ă n,

an ą ´2ℓ,

We rst show that there must be some good index n.

and

nąD

(2)

By assumption, we may take an

index N su h that aN ą maxtL, ´2ℓu. Choose n minimally su h that an “ maxta1 , a2 , . . . , aN u.
Now, the rst

third

ondition in (2) is satised be ause of the minimality of n, and the se ond and

onditions are satised be ause an

1 ď i ď D.

ě aN ą L, ´2ℓ, and L ě ai for every i su h that

18

IMO 2017, Rio de Janeiro

Let n be a good index. We derive a

ontradi tion. We have that

an ` au ` av ď 0,

(3)

whenever u ` v “ n.

We dene the index u to maximize au over 1 ď u ď n ´ 1, and let v “ n ´ u. Then, we note

that au ě av by the maximality of au .

Assume rst that v ď D . Then, we have that

aN ` 2ℓ ď 0,
be ause au ě av ě ℓ. But this

ontradi ts our assumption that an ą ´2ℓ in the se ond

of (2).

riteria

Now assume that v ą D . Then, there exist some indi es w1 , w2 summing up to v su h that

av ` aw1 ` aw2 “ 0.
But

ombining this with (3), we have

an ` au ď aw1 ` aw2 .
Be ause an ą au , we have that maxtaw1 , aw2 u ą au . But sin e ea h of the wi is less than v , this
ontradi ts the maximality of au .

Comment 1.

We present two harder versions of this problem below.

Version 1. Let a1 , a2 , . . . be a sequen e of numbers that satises the relation
an “ ´ max pai ` aj ` ak q
i`j`k“n

for all n ą 2017.

Then, this sequen e is bounded.

Proof. Set D “ 2017. Denote
and

Mn “ max ak
kăn

mn “ ´ min ak “ maxp´ak q.
kăn

kăn

Clearly, the sequen es pmn q and pMn q are nonde reasing. We need to prove that both are bounded.

Consider an arbitrary n ą 2D ; our rst aim is to bound an in terms of mi and Mi . Set k “ tn{2u.

(i) Choose indi es p, q , and r su h that an “ ´pap ` aq ` ar q and p ` q ` r “ n. Without loss of
generality, p ě q ě r .
Assume that p ě k ` 1pą Dq; then p ą q ` r . Hen e

´ap “

max

pai1 ` ai2 ` ai3 q ě aq ` ar ` ap´q´r ,

i1 `i2 `i3 “p

and therefore an “ ´pap ` aq ` ar q ě paq ` ar ` ap´q´r q ´ aq ´ ar “ ap´q´r ě ´mn .
Otherwise, we have k ě p ě q ě r . Sin e n ă 3k , we have r ă k . Then ap , aq ď Mk`1 and
ar ď Mk , when e an ě ´2Mk`1 ´ Mk .
Thus, in any ase an ě ´ maxtmn , 2Mk`1 ` Mk u.

(ii) On the other hand, hoose p ď k and q ď k ´ 1 su h that ap “ Mk`1 and aq “ Mk . Then p ` q ă n,
so an ď ´pap ` aq ` an´p´q q “ ´an´p´q ´ Mk`1 ´ Mk ď mn ´ Mk`1 ´ Mk .
To summarize,

when e

´ maxtmn , 2Mk`1 ` Mk u ď an ď mn ´ Mk`1 ´ Mk ,

mn ď mn`1 ď maxtmn , 2Mk`1 ` Mk u and

Mn ď Mn`1 ď maxtMn , mn ´ Mk`1 ´ Mk u.

(4)

Shortlisted problems  solutions

19

Now, say that an index n ą 2D is lu ky if mn ď 2Mtn{2u`1 ` Mtn{2u . Two ases are possible.

Case 1. Assume that there exists a lu ky index n; set k “ tn{2u. In this ase, (4) yields mn`1 ď

2Mk`1 ` Mk and Mn ď Mn`1 ď Mn (the last relation holds, sin e mn ´ Mk`1 ´ Mk ď p2Mk`1 `
Mk q ´ Mk`1 ´ Mk “ Mk`1 ď Mn ). Therefore, Mn`1 “ Mn and mn`1 ď 2Mk`1 ` Mk ; the last relation
shows that the index n ` 1 is also lu ky.
Thus, all indi es N ą n are lu ky, and MN “ Mn ě mN {3, when e all the mN and MN are
bounded by 3Mn .

Case 2. Conversely, assume that there is no lu ky index, i.e., 2Mtn{2u`1 ` Mtn{2u ă mn for all n ą 2D.
Then (4) shows that for all n ą 2D we have mn ď mn`1 ď mn , i.e., mN “ m2D`1 for all N ą 2D .
Sin e MN ă m2N `1 {3 for all su h indi es, all the mN and MN are bounded by m2D`1 .
l
Thus, in both ases the sequen es pmn q and pMn q are bounded, as desired.

Version 2. Let a1 , a2 , . . . be a sequen e of numbers that satises the relation
an “ ´

max

pai1 ` ¨ ¨ ¨ ` aik q

i1 `¨¨¨`ik “n

for all n ą 2017.

Then, this sequen e is bounded.

Proof. As in the solutions above, let D “ 2017. If the sequen e is bounded above, say, by Q, then we

have that an ě minta1 , . . . , aD , ´kQu for all n, so the sequen e is bounded. Assume for sake of ontradi tion that the sequen e is not bounded above. Let ℓ “ minta1 , . . . , aD u, and L “ maxta1 , . . . , aD u.
Call an index n good if the following riteria hold:

an ą ai for ea h i ă n,

an ą ´kℓ,

and

nąD

(5)

We rst show that there must be some good index n. By assumption, we may take an index N
su h that aN ą maxtL, ´kℓu. Choose n minimally su h that an “ maxta1 , a2 , . . . , aN u. Now, the rst
ondition is satised be ause of the minimality of n, and the se ond and third onditions are satised
be ause an ě aN ą L, ´kℓ, and L ě ai for every i su h that 1 ď i ď D .
Let n be a good index. We derive a ontradi tion. We have that

an ` av1 ` ¨ ¨ ¨ ` avk ď 0,

(6)

whenever v1 ` ¨ ¨ ¨ ` vk “ n.
We dene the sequen e of indi es v1 , . . . , vk´1 to greedily maximize av1 , then av2 , and so forth,
sele ting only from indi es su h that the equation v1 ` ¨ ¨ ¨ ` vk “ n an be satised by positive integers
v1 , . . . , vk . More formally, we dene them indu tively so that the following riteria are satised by
the vi :
1. 1 ď vi ď n ´ pk ´ iq ´ pv1 ` ¨ ¨ ¨ ` vi´1 q.

2. avi is maximal among all hoi es of vi from the rst riteria.

First of all, we note that for ea h i, the rst riteria is always satisable by some vi , be ause we
are guaranteed that
vi´1 ď n ´ pk ´ pi ´ 1qq ´ pv1 ` ¨ ¨ ¨ ` vi´2 q,
whi h implies

1 ď n ´ pk ´ iq ´ pv1 ` ¨ ¨ ¨ ` vi´1 q.

Se ondly, the sum v1 ` ¨ ¨ ¨ ` vk´1 is at most n ´ 1. Dene vk “ n ´ pv1 ` ¨ ¨ ¨ ` vk´1 q. Then, (6)
is satised by the vi . We also note that avi ě avj for all i ă j ; otherwise, in the denition of vi , we
ould have sele ted vj instead.
Assume rst that vk ď D . Then, from (6), we have that

an ` kℓ ď 0,
by using that av1 ě ¨ ¨ ¨ ě avk ě ℓ. But this ontradi ts our assumption that an ą ´kℓ in the se ond
riteria of (5).

20

IMO 2017, Rio de Janeiro

Now assume that vk ą D , and then we must have some indi es w1 , . . . , wk summing up to vk su h
that
avk ` aw1 ` ¨ ¨ ¨ ` awk “ 0.

But ombining this with (6), we have

an ` av1 ` ¨ ¨ ¨ ` avk´1 ď aw1 ` ¨ ¨ ¨ ` awk .
Be ause an ą av1 ě ¨ ¨ ¨ ě avk´1 , we have that maxtaw1 , . . . , awk u ą avk´1 . But sin e ea h of the wi
is less than vk , in the denition of the vk´1 we ould have hosen one of the wi instead, whi h is a
l
ontradi tion.
It seems that ea h sequen e satisfying the ondition in Version 2 is eventually periodi ,
at least when its terms are integers.
However, up to this moment, the Problem Sele tion Committee is not aware of a proof for this fa t
(even in the ase k “ 2).
Comment 2.

Shortlisted problems  solutions

A5.

21

An integer n ě 3 is given. We

all an n-tuple of real numbers px1 , x2 , . . . , xn q

Shiny if

for ea h permutation y1 , y2 , . . . , yn of these numbers we have

n´1
ÿ
i“1

Find the largest

yi yi`1 “ y1 y2 ` y2 y3 ` y3 y4 ` ¨ ¨ ¨ ` yn´1 yn ě ´1.

onstant K “ Kpnq su h that

ÿ

1ďiăjďn

xi xj ě K

holds for every Shiny n-tuple px1 , x2 , . . . , xn q.
Answer:

(Serbia)

K “ ´pn ´ 1q{2.

Solution 1.

First of all, we show that we may not take a larger

onstant K . Let t be a positive

number, and take x2 “ x3 “ ¨ ¨ ¨ “ t and x1 “ ´1{p2tq. Then, every produ t xi xj (i ‰ j ) is
2
equal to either t or ´1{2. Hen e, for every permutation yi of the xi , we have

y1 y2 ` ¨ ¨ ¨ ` yn´1yn ě pn ´ 3qt2 ´ 1 ě ´1.
This justies that the n-tuple px1 , . . . , xn q is Shiny. Now, we have

ÿ
iăj

xi xj “ ´

n ´ 1 pn ´ 1qpn ´ 2q 2
`
t.
2
2

ř

This shows
iăj xi xj gets arbitrarily lose to ´pn ´ 1q{2.ř
that we may not take K any larger than ´pn ´ 1q{2. It remains to show that
iăj xi xj ě

Thus, as t approa hes 0 from above,

´pn ´ 1q{2 for any Shiny

hoi e of the xi .

From now onward, assume that px1 , . . . , xn q is a Shiny n-tuple. Let the zi (1 ď i ď n) be

some permutation of the xi to be

ř hosen later.
ř The indi es for zi will always be taken modulo n.
We will rst split up the sum
iăj xi xj “
iăj zi zj into tpn ´ 1q{2u expressions, ea h of the
form y1 y2 ` ¨ ¨ ¨ ` yn´1 yn for some permutation yi of the zi , and some leftover terms. More

spe i ally, write

ÿ
iăj

zi zj “

n´1
ÿ

u
t n´1
2

ÿ

q“0 i`j”q pmod nq
iıj pmod nq

zi zj “

ÿ

p“1

ÿ

i`j”2p´1,2p pmod nq
iıj pmod nq

zi zj ` L,

(1)

where L “ z1 z´1 ` z2 z´2 ` ¨ ¨ ¨ ` zpn´1q{2 z´pn´1q{2 if n is odd, and L “ z1 z´1 ` z1 z´2 ` z2 z´2 `

¨ ¨ ¨ ` zpn´2q{2 z´n{2 if n is even. We note that for ea h p “ 1, 2, . . . , tpn ´ 1q{2u, there is some

permutation yi of the zi su h that

ÿ

i`j”2p´1,2p pmod nq
iıj pmod nq
be ause we may

zi zj “

n´1
ÿ

yk yk`1 ,

k“1

hoose y2i´1 “ zi`p´1 for 1 ď i ď pn ` 1q{2 and y2i “ zp´i for 1 ď i ď n{2.

We show (1) graphi ally for n “ 6, 7 in the diagrams below. The edges of the graphs ea h

represent a produ t zi zj , and the dashed and dotted series of lines represents the sum of the
edges, whi h is of the form y1 y2 ` ¨ ¨ ¨ ` yn´1 yn for some permutation yi of the zi pre isely when

the series of lines is a Hamiltonian path. The lled edges represent the summands of L.

22

IMO 2017, Rio de Janeiro

Now, be ause the zi are Shiny, we have that (1) yields the following bound:

Z

^
n´1
zi zj ě ´
` L.
2
iăj
ÿ

It remains to show that, for ea h n, there exists some permutation zi of the xi su h that L ě 0
when n is odd, and L ě ´1{2 when n is even. We now split into
and provide

ases based on the parity of n

onstru tions of the permutations zi .

Sin e we have not made any assumptions yet about the xi , we may now assume without
loss of generality that

x1 ď x2 ď ¨ ¨ ¨ ď xk ď 0 ď xk`1 ď ¨ ¨ ¨ ď xn .

(2)

Case 1: n is odd.
Without loss of generality, assume that k (from (2)) is even, be ause we may negate all
the xi if k is odd. We then have x1 x2 , x3 x4 , . . . , xn´2 xn´1 ě 0 be ause the fa tors are of the
same sign. Let L “ x1 x2 ` x3 x4 ` ¨ ¨ ¨ ` xn´2 xn´1 ě 0. We

hoose our zi so that this denition

of L agrees with the sum of the leftover terms in (1). Relabel the xi as zi su h that

tz1 , zn´1 u, tz2 , zn´2 u, . . . , tzpn´1q{2 , zpn`1q{2 u
are some permutation of

tx1 , x2 u, tx3 , x4 u, . . . , txn´2 , xn´1 u,
and zn “ xn . Then, we have L “ z1 zn´1 ` ¨ ¨ ¨ ` zpn´1q{2 zpn`1q{2 , as desired.

Case 2: n is even.

Let L “ x1 x2 ` x2 x3 ` ¨ ¨ ¨ ` xn´1 xn . Assume without loss of generality k ‰ 1. Now, we have

2L “ px1 x2 ` ¨ ¨ ¨ ` xn´1 xn q ` px1 x2 ` ¨ ¨ ¨ ` xn´1 xn q ě px2 x3 ` ¨ ¨ ¨ ` xn´1 xn q ` xk xk`1
ě x2 x3 ` ¨ ¨ ¨ ` xn´1 xn ` xn x1 ě ´1,
where the rst inequality holds be ause the only negative term in L is xk xk`1 , the se ond
inequality holds be ause x1

ď xk ď 0 ď xk`1 ď xn , and the third inequality holds be ause
hoose a suitable zi

the xi are assumed to be Shiny. We thus have that L ě ´1{2. We now

su h that the denition of L mat hes the leftover terms in (1).

Shortlisted problems  solutions

23

Relabel the xi with zi in the following manner:
modulo n). We have that

L“

ÿ

x2i´1 “ z´i , x2i “ zi (again taking indi es
zi zj ,

i`j”0,´1 pmod nq
iıj pmod nq

as desired.

ř

iăj xi xj ě ´pn ´ 1q{2 for any Shiny n-tuple
px1 , . . . , xn q. Assume an ordering of the xi as in (2), and let ℓ “ n ´ k . Assume without loss
of generality that k ě ℓ. Also assume k ‰ n, (as otherwise, all of the xi are nonpositive, and
so the inequality is trivial). Dene the sets of indi es S “ t1, 2, . . . , ku and T “ tk ` 1, . . . , nu.
We present another proof that

Solution 2.

Dene the following sums:

K“

ÿ

M“

xi xj ,

iăj
i,jPS

ÿ

xi xj ,

and

iPS
jPT

L“

ÿ

xi xj

iăj
i,jPT

By denition, K, L ě 0 and M ď 0. We aim to show that K ` L ` M ě ´pn ´ 1q{2.
We split into

Case 1: k ą ℓ.

ases based on whether k “ ℓ or k ą ℓ.

Consider all permutations φ : t1, 2, . . . , nu Ñ t1, 2, . . . , nu su h that φ

Note that there are k!ℓ! su h permutations φ. Dene

f pφq “

n´1
ÿ

´1

pT q “ t2, 4, . . . , 2ℓu.

xφpiq xφpi`1q .

i“1

We know that f pφq ě ´1 for every permutation φ with the above property. Averaging f pφq
over all φ gives

´1 ď

1 ÿ
2ℓ
2pk ´ ℓ ´ 1q
f pφq “ M `
K,
k!ℓ! φ
kℓ
kpk ´ 1q

where the equality holds be ause there are kℓ produ ts in M , of whi h 2ℓ are sele ted for ea h φ,
and there are kpk ´ 1q{2 produ ts in K , of whi h k ´ ℓ ´ 1 are sele ted for ea h φ. We now

have

˙
ˆ
k
ℓ
k k´ℓ´1
K “´ `
K ` L.
K `L`M ě K `L` ´ ´
2
k´1
2 k´1

Sin e k ď n ´ 1 and K, L ě 0, we get the desired inequality.

Case 2: k “ ℓ “ n{2.

We do a similar approa h,

onsidering all φ : t1, 2, . . . , nu Ñ t1, 2, . . . , nu su h that φ

t2, 4, . . . , 2ℓu, and dening f the same way. Analogously to Case 1, we have
´1 ď

´1

pT q “

1 ÿ
2ℓ ´ 1
f pφq “
M,
k!ℓ! φ
kℓ

be ause there are kℓ produ ts in M , of whi h 2ℓ ´ 1 are sele ted for ea h φ. Now, we have that

K `L`M ěM ě´
where the last inequality holds be ause n ě 4.

n´1
n2
ě´
,
4pn ´ 1q
2

24

IMO 2017, Rio de Janeiro

A6.

Find all fun tions f : R Ñ R su h that

f pf pxqf pyqq ` f px ` yq “ f pxyq

p˚q

for all x, y P R.

(Albania)

Answer: There are 3 solutions:

x ÞÑ 0
Solution. An easy

or

x ÞÑ x ´ 1

x ÞÑ 1 ´ x

or

px P Rq.

he k shows that all the 3 above mentioned fun tions indeed satisfy the

original equation p˚q.

In order to show that these are the only solutions, rst observe that if f pxq is a solution

then ´f pxq is also a solution. Hen e, without loss of generality we may (and will) assume that

f p0q ď 0 from now on.
(@x P R).

We have to show that either f is identi ally zero or f pxq “ x ´ 1

Observe that, for a xed x ‰ 1, we may

hoose y P R so that x ` y “ xy

and therefore from the original equation p˚q we have

´
´ x ¯¯
f f pxq ¨ f
“0
x´1

In parti ular, plugging in x “ 0 in (1), we

We analyze two

x
ðñ y “ x´1
,

px ‰ 1q.

(1)

2
on lude that f has at least one zero, namely pf p0qq :

`
˘
f pf p0qq2 “ 0.

(2)

ases (re all that f p0q ď 0):

Case 1: f p0q “ 0.

Setting y “ 0 in the original equation we get the identi ally zero solution:

f pf pxqf p0qq ` f pxq “ f p0q ùñ f pxq “ 0 for all x P R.
From now on, we work on the main

Case 2: f p0q ă 0.

We begin with the following

Claim 1.
f p1q “ 0,

f paq “ 0 ùñ a “ 1,

and

f p0q “ ´1.

(3)

Proof. We need to show that 1 is the unique zero of f . First, observe that f has at least one
zero a by (2); if a ‰ 1 then setting x “ a in (1) we get f p0q “ 0, a ontradi tion. Hen e
2
from (2) we get pf p0qq “ 1. Sin e we are assuming f p0q ă 0, we on lude that f p0q “ ´1. l
Setting y “ 1 in the original equation p˚q we get

f pf pxqf p1qq`f px`1q “ f pxq ðñ f p0q`f px`1q “ f pxq ðñ f px`1q “ f pxq`1

px P Rq.

An easy indu tion shows that

f px ` nq “ f pxq ` n

px P R, n P Zq.

(4)

Shortlisted problems  solutions

25

Now we make the following

Claim 2. f is inje tive.
Proof. Suppose that f paq “ f pbq with a ‰ b. Then by (4), for all N P Z,
f pa ` N ` 1q “ f pb ` Nq ` 1.
Choose any integer N ă ´b; then there exist x0 , y0 P R with x0 ` y0 “ a ` N ` 1, x0 y0 “ b ` N .

Sin e a ‰ b, we have x0 ‰ 1 and y0 ‰ 1. Plugging in x0 and y0 in the original equation p˚q we
get

f pf px0 qf py0 qq ` f pa ` N ` 1q “ f pb ` Nq ðñ f pf px0 qf py0 qq ` 1 “ 0
ðñ f pf px0 qf py0 q ` 1q “ 0
ðñ f px0 qf py0q “ 0
However, by Claim 1 we have f px0 q ‰ 0 and f py0 q ‰ 0 sin e x0 ‰ 1 and y0 ‰ 1, a

get

by (4)
by (3).
ontradi tion.

l

Now the end is near. For any t P R, plug in px, yq “ pt, ´tq in the original equation p˚q to

f pf ptqf p´tqq ` f p0q “ f p´t2 q ðñ f pf ptqf p´tqq “ f p´t2 q ` 1
ðñ f pf ptqf p´tqq “ f p´t2 ` 1q
ðñ f ptqf p´tq “ ´t2 ` 1

by (3)
by (4)
by inje tivity of f.

Similarly, plugging in px, yq “ pt, 1 ´ tq in p˚q we get

f pf ptqf p1 ´ tqq ` f p1q “ f ptp1 ´ tqq ðñ f pf ptqf p1 ´ tqq “ f ptp1 ´ tqq
ðñ f ptqf p1 ´ tq “ tp1 ´ tq

by (3)
by inje tivity of f.

But sin e f p1 ´ tq “ 1 ` f p´tq by (4), we get

f ptqf p1 ´ tq “ tp1 ´ tq ðñ f ptqp1 ` f p´tqq “ tp1 ´ tq ðñ f ptq ` p´t2 ` 1q “ tp1 ´ tq
ðñ f ptq “ t ´ 1,
as desired.
Comment. Other approa hes are possible. For instan e, after Claim 1, we may dene

def

gpxq “ f pxq ` 1.
Repla ing x ` 1 and y ` 1 in pla e of x and y in the original equation p˚q, we get

f pf px ` 1qf py ` 1qq ` f px ` y ` 2q “ f pxy ` x ` y ` 1q

px, y P Rq,

and therefore, using (4) (so that in parti ular gpxq “ f px ` 1q), we may rewrite p˚q as

gpgpxqgpyqq ` gpx ` yq “ gpxy ` x ` yq

px, y P Rq.

p˚˚q

We are now to show that gpxq “ x for all x P R under the assumption (Claim 1) that 0 is the unique
zero of g .

Claim 3. Let n P Z and x P R. Then
(a) gpx ` nq “ x ` n, and the onditions gpxq “ n and x “ n are equivalent.
(b) gpnxq “ ngpxq.

26

IMO 2017, Rio de Janeiro

Proof. For part (a), just note that gpx ` nq “ x ` n is just a reformulation of (4). Then gpxq “ n ðñ
gpx ´ nq “ 0 ðñ x ´ n “ 0 sin e 0 is the unique zero of g. For part (b), we may assume that x ‰ 0
sin e the result is obvious when x “ 0. Plug in y “ n{x in p˚˚q and use part (a) to get
´
´ n ¯¯
´
´
´
´ n ¯¯
´n¯
n¯
n¯
g gpxqg
`g x`
“g n`x`
ðñ g gpxqg
“ n ðñ gpxqg
“ n.
x
x
x
x
x
In other words, for x ‰ 0 we have

n
˘.
gpxq “ `
g n{x

In parti ular, for n “ 1, we get gp1{xq “ 1{gpxq, and therefore repla ing x Ð nx in the last equation
we nally get
n
˘ “ ngpxq,
gpnxq “ `
g 1{x
as required.

Claim 4. The fun tion g is additive, i.e., gpa ` bq “ gpaq ` gpbq for all a, b P R.
Proof. Set x Ð ´x and y Ð ´y in p˚˚q; sin e g is an odd fun tion (by Claim 3(b) with n “ ´1), we

get

gpgpxqgpyqq ´ gpx ` yq “ ´gp´xy ` x ` yq.

Subtra ting the last relation from p˚˚q we have

2gpx ` yq “ gpxy ` x ` yq ` gp´xy ` x ` yq
and sin e by Claim 3(b) we have 2gpx ` yq “ gp2px ` yqq, we may rewrite the last equation as
#
α “ xy ` x ` y
gpα ` βq “ gpαq ` gpβq
where
β “ ´xy ` x ` y.
In other words, we have additivity for all α, β P R for whi h there are real numbers x and y satisfying

x`y “

α`β
2

and

xy “

α´β
,
2

α´β
2
i.e., for all α, β P R su h that p α`β
2 q ´ 4 ¨ 2 ě 0. Therefore, given any a, b P R, we may hoose n P Z
large enough so that we have additivity for α “ na and β “ nb, i.e.,

gpnaq ` gpnbq “ gpna ` nbq ðñ ngpaq ` ngpbq “ ngpa ` bq
by Claim 3(b). Can elling n, we get the desired result. (Alternatively, setting either pα, βq “ pa, bq or
α´β
2
pα, βq “ p´a, ´bq will ensure that p α`β
l
2 q ´ 4 ¨ 2 ě 0).
Now we may nish the solution. Set y “ 1 in p˚˚q, and use Claim 3 to get

gpgpxqgp1qq ` gpx ` 1q “ gp2x ` 1q ðñ gpgpxqq ` gpxq ` 1 “ 2gpxq ` 1 ðñ gpgpxqq “ gpxq.
By additivity, this is equivalent to gpgpxq ´ xq “ 0. Sin e 0 is the unique zero of g by assumption, we
nally get gpxq ´ x “ 0 ðñ gpxq “ x for all x P R.

Shortlisted problems  solutions

A7.

27

Let a0 , a1 , a2 , . . . be a sequen e of integers and b0 , b1 , b2 , . . . be a sequen e of

positive

integers su h that a0 “ 0, a1 “ 1, and

#
an bn ` an´1 ,
an`1 “
an bn ´ an´1 ,

if bn´1 “ 1

for n “ 1, 2, . . ..

if bn´1 ą 1

Prove that at least one of the two numbers a2017 and a2018 must be greater than or equal to 2017.

(Australia)

The value of b0 is irrelevant sin e a0 “ 0, so we may assume that b0 “ 1.

Solution 1.

Lemma. We have an ě 1 for all n ě 1.
Proof. Let us suppose otherwise in order to obtain a ontradi tion. Let
n ě 1 be the smallest integer with an ď 0.

(1)

n ě 2. It follows that an´1 ě 1 and an´2 ě 0. Thus we annot have an “
an´1 bn´1 ` an´2 , so we must have an “ an´1 bn´1 ´ an´2 . Sin e an ď 0, we have an´1 ď an´2 .
Thus we have an´2 ě an´1 ě an .
Note that

Let

r be the smallest index with ar ě ar`1 ě ar`2 .

(2)

Then r ď n´2 by the above, but also r ě 2: if b1 “ 1, then a2 “ a1 “ 1 and a3 “ a2 b2 `a1 ą a2 ;

if b1 ą 1, then a2 “ b1 ą 1 “ a1 .
By the minimal

minimal

hoi e (2) of r , it follows that ar´1 ă ar . And sin e 2 ď r ď n ´ 2, by the

hoi e (1) of n we have ar´1 , ar , ar`1 ą 0. In order to have ar`1 ě ar`2 , we must have

ar`2 “ ar`1 br`1 ´ ar so that br ě 2. Putting everything together, we

on lude that

ar`1 “ ar br ˘ ar´1 ě 2ar ´ ar´1 “ ar ` par ´ ar´1 q ą ar ,
l
To omplete the problem, we prove that maxtan , an`1 u ě n by indu tion. The ases n “ 0, 1
are given. Assume it is true for all non-negative integers stri tly less than n, where n ě 2. There
whi h

are two

ontradi ts (2).

ases:

Case 1: bn´1 “ 1.

Then an`1 “ an bn ` an´1 . By the indu tive assumption one of an´1 , an is at least n ´ 1 and

the other, by the lemma, is at least 1. Hen e

an`1 “ an bn ` an´1 ě an ` an´1 ě pn ´ 1q ` 1 “ n.
Thus maxtan , an`1 u ě n, as desired.

Case 2: bn´1 ą 1.

Sin e we dened b0 “ 1 there is an index r with 1 ď r ď n ´ 1 su h that

bn´1 , bn´2 , . . . , br ě 2

and

br´1 “ 1.

We have ar`1 “ ar br ` ar´1 ě 2ar ` ar´1 . Thus ar`1 ´ ar ě ar ` ar´1 .

laim that ar ` ar´1 ě r . Indeed, this holds by inspe tion for r “ 1; for r ě 2, one

Now we

of ar , ar´1 is at least r ´ 1 by the indu tive assumption, while the other, by the lemma, is at
least 1. Hen e ar ` ar´1 ě r , as

the previous paragraph.
Sin e r

laimed, and therefore ar`1 ´ ar ě r by the last inequality in

ě 1 and, by the lemma, ar ě 1, from ar`1 ´ ar ě r we get the following two

inequalities:

ar`1 ě r ` 1

and

ar`1 ą ar .

28

IMO 2017, Rio de Janeiro

Now observe that

am ą am´1 ùñ am`1 ą am for m “ r ` 1, r ` 2, . . . , n ´ 1,
sin e am`1 “ am bm ´ am´1 ě 2am ´ am´1 “ am ` pam ´ am´1 q ą am . Thus

an ą an´1 ą ¨ ¨ ¨ ą ar`1 ě r ` 1 ùñ an ě n.
So maxtan , an`1 u ě n, as desired.
Solution 2.

We say that an index n ą 1 is

bad if bn´1 “ 1 and bn´2 ą 1; otherwise n is good.

The value of b0 is irrelevant to the denition of pan q sin e a0 “ 0; so we assume that b0 ą 1.

Lemma 1. (a) an ě 1 for all n ą 0.

(b) If n ą 1 is good, then an ą an´1 .

Proof. Indu tion on n. In the base ases n “ 1, 2 we have a1 “ 1 ě 1, a2 “ b1 a1 ě 1, and nally

a2 ą a1 if 2 is good, sin e in this

ase b1 ą 1.

Now we assume that the lemma statement is proved for n “ 1, 2, . . . , k with k ě 2, and

prove it for n “ k ` 1. Re all that ak and ak´1 are positive by the indu tion hypothesis.

Case 1: k is bad.

We have bk´1 “ 1, so ak`1 “ bk ak ` ak´1 ě ak ` ak´1 ą ak ě 1, as required.

Case 2: k is good.

We already have
sub ases.

ak ą ak´1 ě 1 by the indu tion hypothesis.

We

onsider three easy

Sub ase 2.1: bk ą 1.

Then ak`1 ě bk ak ´ ak´1 ě ak ` pak ´ ak´1 q ą ak ě 1.

Sub ase 2.2: bk “ bk´1 “ 1.

Then ak`1 “ ak ` ak´1 ą ak ě 1.

Sub ase 2.3: bk “ 1 but bk´1 ą 1.

Then k ` 1 is bad, and we need to prove only (a), whi h is trivial: ak`1 “ ak ´ ak´1 ě 1.

So, in all three sub ases we have veried the required relations.

Lemma 2.

Assume that n ą 1 is bad.

Then there exists a j

an´1 ` j ` 1, and an`i ě an´1 ` i for all 1 ď i ă j .
Proof. Re all that bn´1 “ 1. Set

l

P t1, 2, 3u su h that an`j ě

m “ infti ą 0 : bn`i´1 ą 1u
(possibly m “ `8). We

a

laim that j “ mintm, 3u works. Again, we distinguish several

ording to the value of m; in ea h of them we use Lemma 1 without referen e.

Case 1: m “ 1, so bn ą 1.

Then an`1 ě 2an ` an´1 ě an´1 ` 2, as required.

Case 2: m “ 2, so bn “ 1 and bn`1 ą 1.
Then we su

essively get

an`1 “ an ` an´1 ě an´1 ` 1,
an`2 ě 2an`1 ` an ě 2pan´1 ` 1q ` an “ an´1 ` pan´1 ` an ` 2q ě an´1 ` 4,
whi h is even better than we need.

ases,

Shortlisted problems  solutions

29

Case 3: m ą 2, so bn “ bn`1 “ 1.
Then we su

essively get

an`1 “ an ` an´1 ě an´1 ` 1, an`2 “ an`1 ` an ě an´1 ` 1 ` an ě an´1 ` 2,
an`3 ě an`2 ` an`1 ě pan´1 ` 1q ` pan´1 ` 2q ě an´1 ` 4,
l
Lemmas 1(b) and 2 provide enough information to prove that maxtan , an`1 u ě n for all n
and, moreover, that an ě n often enough. Indeed, assume that we have found some n with
an´1 ě n´1. If n is good, then by Lemma 1(b) we have an ě n as well. If n is bad, then Lemma 2
yields maxtan`i , an`i`1 u ě an´1 ` i ` 1 ě n ` i for all 0 ď i ă j and an`j ě an´1 ` j ` 1 ě n ` j ;
so n ` j is the next index to start with.
as required.

30

IMO 2017, Rio de Janeiro

A8.

Assume that a fun tion f : R Ñ R satises the following

`

˘`

ondition:

˘

For every x, y P R su h that f pxq ` y f pyq ` x ą 0, we have f pxq ` y “ f pyq ` x.
Prove that f pxq ` y ď f pyq ` x whenever x ą y .
Dene gpxq “ x ´ f pxq. The

Solution 1.

`

(Netherlands)

ondition on f then rewrites as follows:

˘`

˘

For every x, y P R su h that px ` yq ´ gpxq px ` yq ´ gpyq ą 0, we have gpxq “ gpyq.
This

ondition may in turn be rewritten in the following form:

If gpxq ‰ gpyq, then the number x ` y lies (non-stri tly) between gpxq and gpyq.

Noti e here that the fun tion g1 pxq “ ´gp´xq also satises p˚q, sin e

g1 pxq ‰ g1 pyq

ùñ

p˚q

gp´xq ‰ gp´yq ùñ ´px ` yq lies between gp´xq and gp´yq
ùñ x ` y lies between g1 pxq and g1 pyq.

On the other hand, the relation we need to prove reads now as

gpxq ď gpyq
Again, this

whenever x ă y .

(1)

ondition is equivalent to the same one with g repla ed by g1 .

If gpxq “ 2x for all x P R, then p˚q is obvious; so in what follows we

onsider the other

ase. We split the solution into a sequen e of lemmas, strengthening one another. We always
onsider some value of x with gpxq ‰ 2x and denote X “ gpxq.

Lemma 1.

Assume that X ă 2x. Then on the interval pX ´ x; xs the fun tion g attains at

most two values  namely, X and, possibly, some Y

ą X . Similarly, if X ą 2x, then g attains
ă X.

at most two values on rx; X ´ xq  namely, X and, possibly, some Y

Proof. We start with the rst
interval is nonempty.

laim of the lemma. Noti e that X ´ x ă x, so the

onsidered

Take any a P pX ´ x; xq with gpaq ‰ X (if it exists). If gpaq ă X , then p˚q yields gpaq ď

a ` x ď gpxq “ X , so a ď X ´ x whi h is impossible. Thus, gpaq ą X and hen e by p˚q we get
X ď a ` x ď gpaq.
Now, for any b P pX ´ x; xq with gpbq ‰ X we similarly get b ` x ď gpbq. Therefore, the
number a ` b (whi h is smaller than ea h of a ` x and b ` x) annot lie between gpaq and gpbq,
whi h by p˚q implies that gpaq “ gpbq. Hen e g may attain only two values on pX ´ x; xs,
namely X and gpaq ą X .
To prove the se ond laim, noti e that g1 p´xq “ ´X ă 2 ¨ p´xq, so g1 attains at most two
values on p´X ` x, ´xs, i.e., ´X and, possibly, some ´Y ą ´X . Passing ba k to g , we get
what we need.
l

Lemma 2. If X ă 2x, then g is onstant on pX ´ x; xq. Similarly, if X ą 2x, then g is onstant
on px; X ´ xq.

Proof. Again, it su es to prove the rst

laim only. Assume, for the sake of

ontradi tion,

that there exist a, b P pX ´ x; xq with gpaq ‰ gpbq; by Lemma 1, we may assume that gpaq “ X

“ gpbq ą X .
Noti e that mintX ´ a, X ´ bu ą X ´ x, so there exists a u P pX ´ x; xq su h that
u ă mintX ´ a, X ´ bu. By Lemma 1, we have either gpuq “ X or gpuq “ Y . In the former
ase, by p˚q we have X ď u ` b ď Y whi h ontradi ts u ă X ´ b. In the se ond ase, by p˚q
we have X ď u ` a ď Y whi h ontradi ts u ă X ´ a. Thus the lemma is proved.
l
and Y

Shortlisted problems  solutions

31

Lemma 3. If X ă 2x, then gpaq “ X for all a P pX ´ x; xq. Similarly, if X ą 2x, then gpaq “ X
for all a P px; X ´ xq.

Proof. Again, we only prove the rst laim.
laim may be violated only if g takes on a

By Lemmas 1 and 2, this

onstant value Y

on pX ´ x, xq. Choose any a, b P pX ´ x; xq with a ă b. By p˚q, we have

ąX

Y ě b ` x ě X.

(2)

ě b ` x ą 2a. Applying Lemma 2 to a in pla e of x, we obtain that g
is onstant on pa, Y ´ aq. By (2) again, we have x ď Y ´ b ă Y ´ a; so x, b P pa; Y ´ aq. But
X “ gpxq ‰ gpbq “ Y , whi h is a ontradi tion.
l
Now we are able to nish the solution. Assume that gpxq ą gpyq for some x ă y . Denote
X “ gpxq and Y “ gpyq; by p˚q, we have X ě x ` y ě Y , so Y ´ y ď x ă y ď X ´ x,
and hen e pY ´ y; yq X px; X ´ xq “ px, yq ‰ ∅. On the other hand, sin e Y ´ y ă y and
x ă X ´x, Lemma 3 shows that g should attain a onstant value X on px; X ´xq and a onstant
value Y ‰ X on pY ´ y; yq. Sin e these intervals overlap, we get the nal ontradi tion.
In parti ular, we have Y

As in the previous solution, we pass to the fun tion g satisfying p˚q and noti e

Solution 2.

that we need to prove the
If g is

ondition (1). We will also make use of the fun tion g1 .

learly satised. So, in the sequel we assume that g takes on at

onstant, then (1) is

least two dierent values. Now we

olle t some information about the fun tion g .

Claim 1. For any c P R, all the solutions of gpxq “ c are bounded.
Proof. Fix any y P R with gpyq ‰ c. Assume rst that gpyq ą c. Now, for any x with gpxq “ c,

by p˚q we have c ď x ` y ď gpyq, or c ´ y ď x ď gpyq ´ y . Sin e c and y are

onstant, we get

what we need.

If gpyq ă c, we may swit h to the fun tion g1 for whi h we have g1 p´yq ą ´c. By the above

arguments, we obtain that all the solutions of g1 p´xq “ ´c are bounded, whi h is equivalent

l

to what we need.

As an immediate
that the next

onsequen e, the fun tion g takes on innitely many values, whi h shows

laim is indeed widely appli able.

Claim 2. If gpxq ă gpyq ă gpzq, then x ă z .
Proof. By p˚q, we have gpxq ď x ` y ď gpyq ď z ` y ď gpzq, so x ` y ď z ` y , as required.

l

Claim 3. Assume that gpxq ą gpyq for some x ă y . Then gpaq P tgpxq, gpyqu for all a P rx; ys.
Proof. If gpyq ă gpaq ă gpxq, then the triple py, a, xq violates Claim 2. If gpaq ă gpyq ă gpxq,
then the triple pa, y, xq violates Claim 2. If gpyq ă gpxq ă gpaq, then the triple py, x, aq violates
Claim 2. The only possible

a

ases left are gpaq P tgpxq, gpyqu.

In view of Claim 3, we say that an interval I (whi h may be open,
∗
if the fun tion g takes on just two values on I .

Diri hlet interval

Assume now, for the sake of

rx; ys is a Diri hlet interval. Set

l

losed, or semi-open) is

ontradi tion, that (1) is violated by some x ă y . By Claim 3,

r “ infta : pa; ys is a Diri hlet intervalu

and

s “ suptb : rx; bq is a Diri hlet intervalu.

Clearly, r ď x ă y ď s. By Claim 1, r and s are nite. Denote X

∆ “ py ´ xq{2.

“ gpxq, Y “ gpyq, and

Suppose rst that there exists a t P pr; r ` ∆q with f ptq “ Y . By the denition of r , the
1
P pr ´ ∆; rs su h that gpr 1q R tX, Y u.

interval pr ´ ∆; ys is not Diri hlet, so there exists an r
∗

The name

Diri hlet interval

fun tion on this interval.

is

hosen for the reason that

g theoreti ally might a t similarly to the Diri hlet

32

IMO 2017, Rio de Janeiro

1
1
The fun tion g attains at least three distin t values on rr ; ys, namely gpr q, gpxq, and gpyq.
1
1
Claim 3 now yields gpr q ď gpyq; the equality is impossible by the hoi e of r , so in fa t
gpr 1 q ă Y . Applying p˚q to the pairs pr 1 , yq and pt, xq we obtain r 1 ` y ď Y ď t ` x, when e
r ´ ∆ ` y ă r 1 ` y ď t ` x ă r ` ∆ ` x, or y ´ x ă 2∆. This is a ontradi tion.
Thus, gptq “ X for all t P pr; r ` ∆q. Applying the same argument to g1 , we get gptq “ Y

for all t P ps ´ ∆; sq.
Finally,

we

hoose r

1

hoose some s1 , s2 P ps ´ ∆; sq with s1 ă s2 and denote δ “ ps2 ´ s1 q{2. As before,
P pr ´ δ; rq with gpr 1q R tX, Y u and obtain gpr 1q ă Y . Choose any t P pr; r ` δq; by

the above arguments, we have gptq “ X and gps1 q “ gps2 q “ Y . As before, we apply p˚q to the
1
1
pairs pr , s2 q and pt, s1 q obtaining r ´ δ ` s2 ă r ` s2 ď Y ď t ` s1 ă r ` δ ` s1 , or s2 ´ s1 ă 2δ .
This is a nal

ontradi tion.

The original submission dis ussed the same fun tions f , but the question was dierent  namely, the following one:
Comment 1.

Prove that the equation f pxq “ 2017x has at most one solution, and the equation f pxq “ ´2017x
has at least one solution.
The Problem Sele tion Committee de ided that the question we are proposing is more natural,
sin e it provides more natural information about the fun tion g (whi h is indeed the main hara ter
in this story). On the other hand, the new problem statement is strong enough in order to imply the
original one easily.
Namely, we will dedu e from the new problem statement (along with the fa ts used in the solutions)
that piq for every N ą 0 the equation gpxq “ ´N x has at most one solution, and piiq for every N ą 1
the equation gpxq “ N x has at least one solution.
Claim piq is now trivial. Indeed, g is proven to be non-de reasing, so gpxq`N x is stri tly in reasing
and thus has at most one zero.

We pro eed on laim piiq. If gp0q “ 0, then the required root has been already found. Otherwise,
we may assume that gp0q ą 0 and denote c “ gp0q. We intend to prove that x “ c{N is the required
root. Indeed, by monotoni ity we have gpc{N q ě gp0q “ c; if we had gpc{N q ą c, then p˚q would yield
c ď 0 ` c{N ď gpc{N q whi h is false. Thus, gpxq “ c “ N x.
Comment 2.
There are plenty of fun tions g satisfying p˚q (and hen e of fun tions f satisfying
the problem onditions). One simple example is g0 pxq “ 2x. Next, for any in reasing sequen e
A “ p. . . , a´1 , a0 , a1 , . . . q whi h is unbounded in both dire tions (i.e., for every N this sequen e ontains
terms greater than N , as well as terms smaller than ´N ), the fun tion gA dened by

gA pxq “ ai ` ai`1

whenever x P rai ; ai`1 q

satises p˚q. Indeed, pi k any x ă y with gpxq ‰ gpyq; this means that x P rai ; ai`1 q and y P raj ; aj`1 q
for some i ă j . Then we have gpxq “ ai ` ai`1 ď x ` y ă aj ` aj`1 “ gpyq, as required.
There also exist examples of the mixed behavior; e.g., for an arbitrary sequen e A as above and an
arbitrary subset I Ď Z the fun tion
#
g0 pxq, x P rai ; ai`1 q with i P I ;
gA,I pxq “
gA pxq, x P rai ; ai`1 q with i R I
also satises p˚q.

Finally, it is even possible to provide a omplete des ription of all fun tions g satisfying p˚q (and
hen e of all fun tions f satisfying the problem onditions); however, it seems to be far out of s ope for
the IMO. This des ription looks as follows.

Let A be any losed subset of R whi h is unbounded in both dire tions. Dene the fun tions iA ,
sA , and gA as follows:

iA pxq “ infta P A : a ě xu,

sA pxq “ supta P A : a ď xu,

gA pxq “ iA pxq ` sA pxq.

Shortlisted problems  solutions

33

It is easy to see that for dierent sets A and B the fun tions gA and gB are also dierent (sin e, e.g.,
for any a P A z B the fun tion gB is onstant in a small neighborhood of a, but the fun tion gA is not).
One may he k, similarly to the arguments above, that ea h su h fun tion satises p˚q.
Finally, one more modi ation is possible. Namely, for any x P A one may redene gA pxq (whi h
is 2x) to be any of the numbers
where

gA` pxq “ iA` pxq ` x or

gA´ pxq “ x ` sA´ pxq,

iA` pxq “ infta P A : a ą xu and

sA´ pxq “ supta P A : a ă xu.

This really hanges the value if x has some right (respe tively, left) semi-neighborhood disjoint from A,
so there are at most ountably many possible hanges; all of them an be performed independently.
With some eort, one may show that the onstru tion above provides all fun tions g satisfying p˚q.

34

IMO 2017, Rio de Janeiro

Combinatori s
C1.

A re tangle R with odd integer side lengths is divided into small re tangles with integer

side lengths. Prove that there is at least one among the small re tangles whose distan es from
the four sides of R are either all odd or all even.

Solution. Let the width and height of

squares and

R be odd numbers a and b.

olor them green and yellow in a

and b are odd, the

(Singapore)
Divide R into ab unit

he kered pattern. Sin e the side lengths of a

orner squares of R will all have the same

olor, say green.

Call a re tangle (either R or a small re tangle) green if its orners are all green; all it
yellow if the orners are all yellow, and all it mixed if it has both green and yellow orners. In
parti ular, R is a green re tangle.
We will use the following trivial observations.

‚ Every mixed re tangle ontains the same number of green and yellow squares;
‚ Every green re tangle ontains one more green square than yellow square;
‚ Every yellow re tangle ontains one more yellow square than green square.
The re tangle R is green, so it

ontains more green unit squares than yellow unit squares.

Therefore, among the small re tangles, at least one is green.

Let S be su h a small green

re tangle, and let its distan es from the sides of R be x, y , u and v , as shown in the pi ture.
The top-left

orner of R and the top-left

orner of S have the same

only if x and u have the same parity. Similarly, the other three green

olor, whi h happen if and
orners of S indi ate that

x and v have the same parity, y and u have the same parity, i.e. x, y , u and v are all odd or all
even.

R
x
u

v

S
y

Shortlisted problems  solutions

C2.

35

Let n be a positive integer. Dene a

exa tly n o

hameleon to be any sequen e of 3n letters, with
swap to be the transposition of

urren es of ea h of the letters a, b, and c. Dene a

two adja ent letters in a hameleon. Prove that for any hameleon X , there exists a hameleon Y
2
su h that X annot be hanged to Y using fewer than 3n {2 swaps.

(Australia)

Solution 1.

To start, noti e that the swap of two identi al letters does not hange a hameleon,

so we may assume there are no su h swaps.
For any two

hameleons X and Y , dene their

distan e dpX, Y q to be the minimal number

of swaps needed to transform X into Y (or vi e versa). Clearly, dpX, Y q ` dpY, Zq ě dpX, Zq

for any three

hameleons X , Y , and Z .

Lemma. Consider two hameleons
cc . . . c
bb . . . b loomoon
P “ loomoon
aa . . . a loomoon
n

n

and

n

n

2
Then dpP, Qq ě 3n .

Proof. For any

aa . . . a .
bb . . . b loomoon
Q “ loomoon
cc . . . c loomoon
n

n

hameleon X and any pair of distin t letters u, v P ta, b, cu, we dene fu,v pXq

X su h that the left one is o upied by u, and
the right one is o upied by v . Dene f pXq “ fa,b pXq ` fa,c pXq ` fb,c pXq. Noti e that
fa,b pP q “ fa,c pP q “ fb,c pP q “ n2 and fa,b pQq “ fa,c pQq “ fb,c pQq “ 0, so f pP q “ 3n2 and
f pQq “ 0.
1
Now onsider some swap hanging a hameleon X to X ; say, the letters a and b are swapped.
1
1
1
Then fa,b pXq and fa,b pX q dier by exa tly 1, while fa,c pXq “ fa,c pX q and fb,c pXq “ fb,c pX q.
1
This yields |f pXq ´ f pX q| “ 1, i.e., on any swap the value of f hanges by 1. Hen e dpX, Y q ě
|f pXq ´ f pY q| for any two hameleons X and Y . In parti ular, dpP, Qq ě |f pP q ´ f pQq| “ 3n2 ,
l
as desired.
Ba k to the problem, take any hameleon X and noti e that dpX, P q ` dpX, Qq ě dpP, Qq ě
2
2
3n by the lemma. Consequently, maxtdpX, P q, dpX, Qqu ě 3n2 , whi h establishes the problem
to be the number of pairs of positions in

statement.

The problem may be reformulated in a graph language. Constru t a graph G with the
hameleons as verti es, two verti es being onne ted with an edge if and only if these hameleons dier
by a single swap. Then dpX, Y q is the usual distan e between the verti es X and Y in this graph.
Re all that the radius of a onne ted graph G is dened as

Comment 1.

rpGq “ min max dpu, vq.
vPV uPV

So we need to prove that the radius of the onstru ted graph is at least 3n2 {2.
It is well-known that the radius of any onne ted graph is at least the half of its diameter (whi h
is simply maxu,vPV dpu, vq). Exa tly this fa t has been used above in order to nish the solution.
Solution 2.

We use the notion of distan e from Solution 1, but provide a dierent lower

bound for it.
In any

hameleon X , we enumerate the positions in it from left to right by 1, 2, . . . , 3n.

Dene sc pXq as the sum of positions o

upied by c. The value of sc

hanges by at most 1 on

ea h swap, but this fa t alone does not su e to solve the problem; so we need an improvement.
For every

hameleon X , denote by Xc the sequen e obtained from X by removing all n

letters c. Enumerate the positions in Xc from left to right by 1, 2, . . . , 2n, and dene sc,b pXq
as the sum of positions in Xc o

upied by b. (In other words, here we

onsider the positions of

the b's relatively to the a's only.) Finally, denote

d1 pX, Y q :“ |sc pXq ´ sc pY q| ` |sc,b pXq ´ sc,b pY q|.

36

IMO 2017, Rio de Janeiro

1
onsider any swap hanging a hameleon X to X . If no letter c is involved into this
1
swap, then sc pXq “ sc pX q; on the other hand, exa tly one letter b hanges its position in Xc , so
|sc,b pXq ´ sc,b pX 1 q| “ 1. If a letter c is involved into a swap, then Xc “ Xc1 , so sc,b pXq “ sc,b pX 1 q
1
1
1
and |sc pXq ´ sc pX q| “ 1. Thus, in all ases we have d pX, X q “ 1.
1
As in the previous solution, this means that dpX, Y q ě d pX, Y q for any two hameleons X
1
2
and Y . Now, for any hameleon X we will indi ate a hameleon Y with d pX, Y q ě 3n {2, thus
Now

nishing the solution.

npn`1q
The fun tion sc attains all integer values from 1 ` ¨ ¨ ¨ ` n “
to p2n ` 1q ` ¨ ¨ ¨ ` 3n “
2
npn`1q
npn`1q
2
2
2n ` 2 . If sc pXq ď n ` 2 , then we put the letter c into the last n positions in Y ;
otherwise we put the letter c into the rst n positions in Y . In either ase we already have
|sc pXq ´ sc pY q| ě n2 .
npn`1q
npn`1q
n2
2
Similarly, sc,b ranges from
` npn`1q
to n `
. So, if sc,b pXq ď
, then we put
2
2
2
2
the letter b into the last n positions in Y whi h are still free; otherwise, we put the letter b into
the rst n su h positions. The remaining positions are o upied by a. In any
2
2
2
|sc,b pXq ´ sc,b pY q| ě n2 , thus d1 pX, Y q ě n2 ` n2 “ 3n2 , as desired.

ase, we have

The two solutions above used two lower bounds |f pXq ´ f pY q| and d1 pX, Y q for the
number dpX, Y q. One may see that these bounds are losely related to ea h other, as
Comment 2.

fa,c pXq ` fb,c pXq “ sc pXq ´

npn ` 1q
2

and

fa,b pXq “ sc,b pXq ´

npn ` 1q
.
2

One an see that, e.g., the bound d1 pX, Y q ould as well be used in the proof of the lemma in Solution 1.
Let us des ribe here an even sharper bound whi h also an be used in dierent versions of the
solutions above.
In ea h hameleon X , enumerate the o urren es of a from the left to the right as a1 , a2 , . . . , an .
Sin e we got rid of swaps of identi al letters, the relative order of these letters remains the same during
the swaps. Perform the same operation with the other letters, obtaining new letters b1 , . . . , bn and
c1 , . . . , cn . Denote by A the set of the 3n obtained letters.
Sin e all 3n letters be ame dierent, for any hameleon X and any s P A we may dene the
position Ns pXq of s in X (thus 1 ď Ns pXq ď 3n). Now, for any two hameleons X and Y we say that
a pair of letters ps, tq P Aˆ A is an pX, Y q-inversion if Ns pXq ă Nt pXq but Ns pY q ą Nt pY q, and dene
d˚ pX, Y q to be the number of pX, Y q-inversions. Then for any two hameleons Y and Y 1 diering by a
single swap, we have |d˚ pX, Y q ´ d˚ pX, Y 1 q| “ 1. Sin e d˚ pX, Xq “ 0, this yields dpX, Y q ě d˚ pX, Y q
for any pair of hameleons X and Y . The bound d˚ may also be used in both Solution 1 and Solution 2.
In fa t, one may prove that the distan e d˚ dened in the previous omment oin ides
with d. Indeed, if X ‰ Y , then there exist an pX, Y q-inversion ps, tq. One an show that su h s and t
may be hosen to o upy onse utive positions in Y . Clearly, s and t orrespond to dierent letters
among ta, b, cu. So, swapping them in Y we get another hameleon Y 1 with d˚ pX, Y 1 q “ d˚ pX, Y q ´ 1.
Pro eeding in this manner, we may hange Y to X in d˚ pX, Y q steps.
Using this fa t, one an show that the estimate in the problem statement is sharp for all n ě 2.
(For n “ 1 it is not sharp, sin e any permutation of three letters an be hanged to an opposite one in
no less than three swaps.) We outline the proof below.
For any k ě 0, dene
Comment 3.

X2k “ abc
abc . . . abc cba
cba . . . cba
looooooomooooooon
looooooomooooooon
3k letters

3k letters

and

X2k`3 “ abc
abc . . . abc abc bca cab cba
cba . . . cba .
looooooomooooooon
looooooomooooooon
3k letters

3k letters

P

T
We laim that for every n ě 2 and every hameleon Y , we have d˚ pXn , Y q ď 3n2 {2 . This will mean
2
that for every
P n2 ěT2 the number 3n {2 in the problem statement annot be hanged by any number
larger than 3n {2 .
For any distin t letters u, v P ta, b, cu and any two hameleons X and Y , we dene d˚u,v pX, Y q as
the number of pX, Y q-inversions ps, tq su h that s and t are instan es of u and v (in any of the two
possible orders). Then d˚ pX, Y q “ d˚a,b pX, Y q ` d˚b,c pX, Y q ` d˚c,a pX, Y q.

Shortlisted problems  solutions

37

We start with the ase when n “ 2k is even; denote X “ X2k . We show that d˚a,b pX, Y q ď 2k 2
for any hameleon Y ; this yields the required estimate. Pro eed by the indu tion on k with the trivial
base ase k “ 0. To perform the indu tion step, noti e that d˚a,b pX, Y q is indeed the minimal number of
swaps needed to hange Yc into Xc . One may show that moving a1 and a2k in Y onto the rst and the
last positions in Y , respe tively, takes at most 2k swaps, and that subsequent moving b1 and b2k onto
the se ond and the se ond last positions takes at most 2k ´ 2 swaps. After performing that, one may
delete these letters from both Xc and Yc and apply the indu tion hypothesis; so Xc an be obtained
from Yc using at most 2pk ´ 1q2 ` 2k ` p2k ´ 2q “ 2k 2 swaps, as required.
If n “ 2k ` 3 is odd, the proof is similar but more te hni ally involved. Namely, we laim that
hameleon Y , and that the equality is a hieved only if Yc “
bb . . . b aa . . . a. The proof pro eeds by a similar indu tion, with some are taken of the base ase, as
well as of extra ting the equality ase. Similar estimates hold for d˚b,c and d˚c,a . Summing three su h
estimates, we obtain
R 2V
3n
˚
2
d pX2k`3 , Y q ď 3p2k ` 6k ` 5q “
` 1,
2

d˚a,b pX2k`3 , Y q ď 2k2 ` 6k ` 5 for any

whi h is by 1 more than we need. But the equality ould be a hieved only if Yc “ bb . . . b aa . . . a
and, similarly, Yb “ aa . . . a cc . . . c and Ya “ cc . . . c bb . . . b. Sin e these three equalities annot hold
simultaneously, the proof is nished.

38

IMO 2017, Rio de Janeiro

C3.

Sir Alex plays the following game on a row of 9

ells. Initially, all

ells are empty. In

ea h move, Sir Alex is allowed to perform exa tly one of the following two operations:

j
(1) Choose any number of the form 2 , where j is a non-negative integer, and put it into an
empty

ell.

(2) Choose two (not ne essarily adja ent) ells with the same number in them; denote that
j
j`1
number by 2 . Repla e the number in one of the ells with 2
and erase the number in
the other

ell.

At the end of the game, one
while the other

ell

n
ontains the number 2 , where n is a given positive integer,

ells are empty. Determine the maximum number of moves that Sir Alex

have made, in terms of n.

Answer:

2

ř8

j“0

Solution 1.

` n˘
j

ould

(Thailand)

´ 1.

We will solve a more general problem, repla ing the row of 9

ells with a row of k

ells, where k is a positive integer. Denote by mpn, kq the maximum possible number of moves
Sir Alex

an make starting with a row of k empty ells, and ending with one ell ontaining
n
and all the other k ´ 1 ells empty. Call an operation of type (1) an
,

the number 2

and an operation of type (2) a

insertion

merge.

Only one move is possible when k “ 1, so we have mpn, 1q “ 1. From now on we

onsider

k ě 2, and we may assume Sir Alex's last move was a merge. Then, just before the last move,
n´1
there were exa tly two ells with the number 2
, and the other k ´ 2 ells were empty.
n´1
Paint one of those numbers 2
blue, and the other one red. Now tra e ba k Sir Alex's
moves, always painting the numbers blue or red following this rule: if a and b merge into c,
paint a and b with the same olor as c. Noti e that in this ba kward pro ess new numbers are
produ ed only by reversing merges, sin e reversing an insertion simply means deleting one of
the numbers. Therefore, all numbers appearing in the whole pro ess will re eive one of the two
olors.
Sir Alex's rst move is an insertion. Without loss of generality, assume this rst number
inserted is blue. Then, from this point on, until the last move, there is always at least one

ell

with a blue number.
Besides the last move, there is no move involving a blue and a red number, sin e all merges
involves numbers with the same

olor, and insertions involve only one number. Call an insertion

of a blue number or merge of two blue numbers a

blue move, and dene a red move analogously.

The whole sequen e of blue moves ould be repeated on another row of k ells to produ e
n´1
one ell with the number 2
and all the others empty, so there are at most mpn ´ 1, kq blue
moves.

Now we look at the red moves. Sin e every time we perform a red move there is at least
one

ell o

upied with a blue number, the whole sequen e of red moves ould be repeated on a
n´1
ells to produ e one ell with the number 2
and all the others empty, so there

row of k ´ 1

are at most mpn ´ 1, k ´ 1q red moves. This proves that

mpn, kq ď mpn ´ 1, kq ` mpn ´ 1, k ´ 1q ` 1.

an start with an empty row of k ells and perform mpn ´ 1, kq
n´1
moves to produ e one ell with the number 2
and all the others empty, and after that
n´1
perform mpn ´ 1, k ´ 1q moves on those k ´ 1 empty ells to produ e the number 2
in one
n
of them, leaving k ´ 2 empty. With one more merge we get one ell with 2 and the others
On the other hand, we

empty, proving that

mpn, kq ě mpn ´ 1, kq ` mpn ´ 1, k ´ 1q ` 1.

Shortlisted problems  solutions

39

It follows that

mpn, kq “ mpn ´ 1, kq ` mpn ´ 1, k ´ 1q ` 1,

(1)

for n ě 1 and k ě 2.

“ 1 or n “ 0, we must insert 2n on our rst move and immediately get the nal
onguration, so mp0, kq “ 1 and mpn, 1q “ 1, for n ě 0 and k ě 1. These initial values,
together with the re urren e relation (1), determine mpn, kq uniquely.
If k

Finally, we show that

mpn, kq “ 2
for all integers n ě 0 and k ě 1.

k´1
ÿˆ
j“0

˙
n
´ 1,
j

(2)

We use indu tion on n. Sin e mp0, kq “ 1 for k ě 1, (2) is true for the base

ase. We make

the indu tion hypothesis that (2) is true for some xed positive integer n and all k ě 1. We
`n`1˘
have mpn ` 1, 1q “ 1 “ 2
´ 1, and for k ě 2 the re urren e relation (1) and the indu tion
0
hypothesis give us

˙
k´2
ÿ ˆn˙
n
´1`1
´1`2
mpn ` 1, kq “ mpn, kq ` mpn, k ´ 1q ` 1 “ 2
j
j
j“0
j“0
˙˙
˙
ˆ
˙
ˆˆ
˙
ˆ
ˆ
k´1
k´1
k´1
k´1
ÿ ˆn ` 1˙
ÿ
ÿ
ÿ n
n
n
n
´ 1,
´1“2
`
´1“2
`2
“2
j
j´1
j
j´1
j
j“0
j“0
j“0
j“0
k´1
ÿˆ

whi h

ompletes the proof.

After dedu ing the re urren e relation (1), it may be onvenient to homogenize the
re urren e relation by dening hpn, kq “ mpn, kq ` 1. We get the new relation

Comment 1.

(3)

hpn, kq “ hpn ´ 1, kq ` hpn ´ 1, kq,

for n ě 1 and k ě 2, with initial values hp0, kq “ hpn, 1q “ 2, for n ě 0 and k ě 1.
This may help one to guess the answer, and also with other approa hes like the one we develop
next.
We an use a generating fun tion to nd the answer without guessing. We work with
the homogenized re urren e relation (3). Dene
ř hpn, 0q “ 0 so that (3) is valid for k “ 1 as well. Now
we set up the generating fun tion f px, yq “ n,kě0 hpn, kqxn y k . Multiplying the re urren e relation (3)
by xn y k and summing over n, k ě 1, we get
Comment 2.

ÿ

n,kě1

hpn, kqxn y k “ x

ÿ

n,kě1

hpn ´ 1, kqxn´1 y k ` xy

ÿ

n,kě1

hpn ´ 1, k ´ 1qxn´1 y k´1 .

Completing the missing terms leads to the following equation on f px, yq:

f px, yq ´

ÿ

ně0

hpn, 0qxn ´

ÿ

kě1

hp0, kqy k “ xf px, yq ´ x

Substituting the initial values, we obtain

f px, yq “
Developing as a power series, we get

f px, yq “ 2

ÿ

ně0

1
2y
¨
.
1 ´ y 1 ´ xp1 ` yq
ÿ

jě1

yj ¨

ÿ

p1 ` yqn xn .

ně0

hpn, 0qxn ` xyf px, yq.

40

IMO 2017, Rio de Janeiro

The oe ient of xn in this power series is

ÿ ˆn ˙
2
y ¨ p1 ` yq “ 2
y ¨
yi,
i
jě1
jě1
iě0
ÿ

j

ÿ

n

j

and extra ting the oe ient of y k in this last expression we nally obtain the value for hpn, kq,

hpn, kq “ 2
This proves that

mpn, kq “ 2

k´1
ÿˆ
j“0

k´1
ÿˆ
j“0

˙
n
.
j

˙
n
´ 1.
j

The generating fun tion approa h also works if applied to the non-homogeneous re urren e relation (1), but the omputations are less straightforward.
Solution 2.

we

Dene merges and insertions as in Solution 1. After ea h move made by Sir Alex

ompute the number N of empty

ells, and the sum S of all the numbers written in the

ells. Insertions always in rease S by some power of 2, and in rease N exa tly by 1. Merges do
not

hange S and de rease N exa tly by 1. Sin e the initial value of N is 0 and its nal value

is 1, the total number of insertions ex eeds that of merges by exa tly one. So, to maximize the
number of moves, we need to maximize the number of insertions.
We will need the following lemma.

Lemma. If the binary representation of a positive integer A has d nonzero digits, then A annot
be represented as a sum of fewer than d powers of 2. Moreover, any representation of A as a
sum of d powers of 2 must

oin ide with its binary representation.

Proof. Let s be the minimum number of summands in all possible representations of A as sum
of powers of 2.

Suppose there is su h a representation with s summands, where two of the

summands are equal to ea h other.

Then, repla ing those two summands with the result of

their sum, we obtain a representation with fewer than s summands, whi h is a

ontradi tion.

We dedu e that in any representation with s summands, the summands are all distin t, so any
su h representation must

oin ide with the unique binary representation of A, and s “ d.

Now we split the solution into a sequen e of

l

laims.

Claim 1. After every move, the number S is the sum of at most k ´ 1 distin t powers of 2.
Proof. If S is the sum of k (or more) distin t powers of 2, the Lemma implies that the k ells
are lled with these numbers. This is a

ontradi tion sin e no more merges or insertions

an

l
Let Apn, k ´ 1q denote the set of all positive integers not ex eeding 2 with at most k ´ 1
nonzero digits in its base 2 representation. Sin e every insertion in reases the value of S , by
Claim 1, the total number of insertions is at most |Apn, k ´ 1q|. We pro eed to prove that it is

be made.

n

possible to a hieve this number of insertions.

Claim 2. Let Apn, k ´1q “ ta1 , a2 , . . . , am u, with a1 ă a2 ă ¨ ¨ ¨ ă am . If after some of Sir Alex's

moves the value of S is aj , with j P t1, 2, . . . , m ´ 1u, then there is a sequen e of moves after
whi h the value of S is exa tly aj`1 .

Proof. Suppose S “ aj . Performing all possible merges, we eventually get dierent powers of 2

in all nonempty

ells. After that, by Claim 1 there will be at least one empty

want to insert aj`1 ´ aj . It remains to show that aj`1 ´ aj is a power of 2.

ell, in whi h we

For this purpose, we noti e that if aj has less than k ´ 1 nonzero digits in base 2 then
aj`1 “ aj ` 1. Otherwise, we have aj “ 2bk´1 ` ¨ ¨ ¨ ` 2b2 ` 2b1 with b1 ă b2 ă ¨ ¨ ¨ ă bk´1 . Then,
b
adding any number less than 2 1 to aj will result in a number with more than k ´ 1 nonzero

Shortlisted problems  solutions

41

b
binary digits. On the other hand, aj ` 2 1 is a sum of k powers of 2, not all distin t, so by the
b
Lemma it will be a sum of less then k distin t powers of 2. This means that aj`1 ´ aj “ 2 1 ,

l

ompleting the proof.

Claims 1 and 2 prove that the maximum number of insertions is |Apn, k ´ 1q|.

ompute this number.

ř

We now

` ˘

k´1 n
Claim 3. |Apn, k ´ 1q| “ j“0
.
j
n
Proof. The number 2 is the only element of Apn, k ´ 1q with n ` 1 binary digits. Any other

element has at most n binary digits, at least one and at most k ´ 1 of them are nonzero (so
`n˘
they are ones). For ea h j P t1, 2, . . . , k ´ 1u, there are
su h elements with exa tly j binary
j
řk´1 `n˘ řk´1 `n˘
digits equal to one. We on lude that |Apn, k ´ 1q| “ 1 `
l
j“1 j “
j“0 j .
Re alling that the number of insertions ex eeds that of merges by exa tly 1, we dedu e that
řk´1 `n˘
j“0 j ´ 1.

the maximum number of moves is 2

42

IMO 2017, Rio de Janeiro

C4.

Let N ě 2 be an integer. NpN ` 1q so

er players, no two of the same height, stand

in a row in some order. Coa h Ralph wants to remove NpN ´ 1q people from this row so that
in the remaining row of 2N players, no one stands between the two tallest ones, no one stands

between the third and the fourth tallest ones, . . . , and nally no one stands between the two
shortest ones. Show that this is always possible.

Solution 1.

(Russia)

Split the row into N blo ks with N ` 1

onse utive people ea h. We will show

how to remove N ´ 1 people from ea h blo k in order to satisfy the
the j

th

oa h's wish.

th

onstru t a pN ` 1q ˆ N matrix where xi,j is the height of the i

First,

blo kin other words, ea h

tallest person of

olumn lists the heights within a single blo k, sorted in

de reasing order from top to bottom.
We will reorder this matrix by repeatedly swapping whole
mutation, make sure that x2,1

olumns. First, by

“ maxtx2,i : i “ 1, 2, . . . , Nu (the rst

olumn per-

olumn

ontains the

olumn ex luded). In short, at step k (k “ 1, 2, . . . , N ´ 1), we permute the

olumns from

se ond row). With the rst olumn xed, permute the other ones so that
x3,2 “ maxtx3,i : i “ 2, . . . , Nu (the se ond olumn ontains the tallest person of the third row,
largest height of the

rst

k to N so that xk`1,k “ maxtxi,k : i “ k, k ` 1, . . . , Nu, and end up with an array like this:
ą

.

ą

ą

xN,3 ¨ ¨ ¨ xN,N ´1 ą xN,N
ą

ą

xN,2

ą

ą

xN,1
ą

.
..

ą

.
..

ą

..

ą

ą
.
..

ą

ą
.
..

x3,N

ą

ą
.
..

x2,N
ą

x3,2 ą x3,3 ¨ ¨ ¨ x3,N ´1

ą

ą

x3,1

ą

ą

x2,3 ¨ ¨ ¨ x2,N ´1

x1,N
ą

ą

x2,1 ą x2,2

x1,3 ¨ ¨ ¨ x1,N ´1
ą

x1,2

ą

x1,1

xN `1,1 xN `1,2 xN `1,3 ¨ ¨ ¨ xN `1,N ´1 xN `1,N
Now we make the bold

hoi e: from the original row of people, remove everyone but those

with heights

x1,1 ą x2,1 ą x2,2 ą x3,2 ą ¨ ¨ ¨ ą xN,N ´1 ą xN,N ą xN `1,N

Of

ourse this

need to

p˚q

height order p˚q is not ne essarily their spatial order in the new row. We now

onvin e ourselves that ea h pair pxk,k ; xk`1,k q remains spatially together in this new

row. But xk,k and xk`1,k belong to the same
only people that

olumn/blo k of

onse utive N ` 1 people; the

ould possibly stand between them were also in this blo k, and they are all

gone.
Solution 2.

Split the people into N groups

by height : group G1 has the N ` 1 tallest ones,

group G2 has the next N ` 1 tallest, and so on, up to group GN with the N ` 1 shortest people.
Now s an the original row from left to right, stopping as soon as you have s anned two

people ( onse utively or not) from the same group, say, Gi . Sin e we have N groups, this must
happen before or at the pN ` 1q

th

person of the row. Choose this pair of people, removing all

the other people from the same group Gi and also all people that have been s anned so far.
The only people that

ould separate this pair's heights were in group Gi (and they are gone);

the only people that

ould separate this pair's positions were already s anned (and they are

gone too).
We are now left with N ´ 1 groups (all ex ept Gi ). Sin e ea h of them lost at most one

person, ea h one has at least N uns anned people left in the row. Repeat the s anning pro ess
from left to right,

hoosing the next two people from the same group, removing this group and

Shortlisted problems  solutions

43

everyone s anned up to that point. On e again we end up with two people who are next to
ea h other in the remaining row and whose heights

annot be separated by anyone else who

remains (sin e the rest of their group is gone). After pi king these 2 pairs, we still have N ´ 2

groups with at least N ´ 1 people ea h.

If we repeat the s anning pro ess a total of N times, it is easy to

he k that we will end

up with 2 people from ea h group, for a total of 2N people remaining. The height order is
guaranteed by the grouping, and the s anning

onstru tion from left to right guarantees that

ea h pair from a group stand next to ea h other in the nal row. We are done.
Solution 3.

This is essentially the same as solution 1, but presented indu tively. The essen e

of the argument is the following lemma.

Lemma. Assume that we have N disjoint groups of at least N ` 1 people in ea h, all people

have distin t heights.

Then one

an

hoose two people from ea h group so that among the

hosen people, the two tallest ones are in one group, the third and the fourth tallest ones are
in one group, . . . , and the two shortest ones are in one group.

Proof. Indu tion on N ě 1; for N “ 1, the statement is trivial.

Consider now N groups G1 , . . . , GN with at least N `1 people in ea h for N ě 2. Enumerate

the people by 1, 2, . . . , NpN ` 1q a

ording to their height, say, from tallest to shortest. Find

the least s su h that two people among 1, 2, . . . , s are in one group (without loss of generality,
say this group is GN ). By the minimality of s, the two mentioned people in GN are s and some

i ă s.

Now we

hoose people i and s in GN , forget about this group, and remove the people

1, 2, . . . , s from G1 , . . . , GN ´1 . Due to minimality of s again, ea h of the obtained groups
G11 , . . . , G1N ´1 ontains at least N people. By the indu tion hypothesis, one an hoose a pair
1
1
of people from ea h of G1 , . . . , GN ´1 so as to satisfy the required onditions. Sin e all these
people have numbers greater than s, addition of the pair ps, iq from GN does not violate these
requirements.
l
To solve the problem, it su es now to split the row into N
people in ea h and apply the Lemma to those groups.

ontiguous groups with N ` 1

One an identify ea h person with a pair of indi es pp, hq (p, h P t1, 2, . . . , N pN ` 1qu)
Say
that pa, bq separates px1 , y1 q and px2 , y2 q whenever a is stri tly between x1 and y1 , or b is stri tly
between x2 and y2 . So the oa h wants to pi k 2N people ppi , hi qpi “ 1, 2, . . . , 2N q su h that no hosen
person separates pp1 , h1 q from pp2 , h2 q, no hosen person separates pp3 , h3 q and pp4 , h4 q, and so on.
This formulation reveals a duality between positions and heights. In that sense, solutions 1 and 2 are
dual of ea h other.

Comment 1.

so that the pth person in the row (say, from left to right) is the hth tallest person in the group.

Comment 2. The number N pN ` 1q is sharp for N “ 2 and N “ 3, due to arrangements 1, 5, 3, 4, 2
and 1, 10, 6, 4, 3, 9, 5, 8, 7, 2, 11.

44

IMO 2017, Rio de Janeiro

C5.

A hunter and an invisible rabbit play a game in the Eu lidean plane. The hunter's

th

starting point H0

oin ides with the rabbit's starting point R0 . In the n

(n ě 1), the following happens.

(1) First the invisible rabbit moves se retly and unobserved from its

round of the game

urrent point Rn´1 to

some new point Rn with Rn´1 Rn “ 1.

1
(2) The hunter has a tra king devi e (e.g. dog) that returns an approximate position Rn of
1
the rabbit, so that Rn Rn ď 1.
(3) The hunter then visibly moves from point Hn´1 to a new point Hn with Hn´1 Hn “ 1.
9
Is there a strategy for the hunter that guarantees that after 10 su h rounds the distan e

between the hunter and the rabbit is below 100?

(Austria)

Answer: There is no su h strategy for the hunter. The rabbit wins".
Solution. If the answer were yes", the hunter would have a strategy that would work", no

1
matter how the rabbit moved or where the radar pings Rn appeared. We will show the opposite:
with bad lu k from the radar pings, there is no strategy for the hunter that guarantees that
9
the distan e stays below 100 in 10 rounds.
So, let dn be the distan e between the hunter and the rabbit after n rounds. Of ourse, if
dn ě 100 for any n ă 109 , the rabbit has won  it just needs to move straight away from the

hunter, and the distan e will be kept at or above 100 thereon.

We will now show that, while dn ă 100, whatever given strategy the hunter follows, the
1
2
rabbit has a way of in reasing dn by at least
every 200 rounds (as long as the radar pings are
2
2
4
4
6
9
lu ky enough for the rabbit). This way, dn will rea h 10 in less than 2 ¨ 10 ¨ 200 “ 4 ¨ 10 ă 10
rounds, and the rabbit wins.

Suppose the hunter is at Hn and the rabbit is at Rn . Suppose even that the rabbit

reveals

its position at this moment to the hunter (this allows us to ignore all information from previous
radar pings). Let r be the line Hn Rn , and Y1 and Y2 be points whi h are 1 unit away from r
and 200 units away from Rn , as in the gure below.

Y1
200

1

200 − dn

dn

r

y

H

Rn

Hn

ε

200

′

Z
y

R′

1
Y2

The rabbit's plan is simply to

hoose one of the points Y1 or Y2 and hop 200 rounds straight

towards it. Sin e all hops stay within 1 distan e unit from r , it is possible that all radar pings
stay on r . In parti ular, in this

ase, the hunter has no way of knowing whether the rabbit

hose Y1 or Y2 .
Looking at su h pings, what is the hunter going to do? If the hunter's strategy tells him to
1
go 200 rounds straight to the right, he ends up at point H in the gure. Note that the hunter
does not have a better alternative! Indeed, after these 200 rounds he will always end up at
1
a point to the left of H . If his strategy took him to a point above r , he would end up even
further from Y2 ; and if his strategy took him below r , he would end up even further from Y1 .
In other words, no matter what strategy the hunter follows, he

def

1

1

an never be sure his distan e

to the rabbit will be less than y “ H Y1 “ H Y2 after these 200 rounds.
2
1
To estimate y , we take Z as the midpoint of segment Y1 Y2 , we take R as a point 200 units
1
1 1
to the right of Rn and we dene ε “ ZR (note that H R “ dn ). Then

Shortlisted problems  solutions

45

y 2 “ 1 ` pH 1 Zq2 “ 1 ` pdn ´ εq2
where

ε “ 200 ´ Rn Z “ 200 ´
In parti ular, ε

2

?

2002 ´ 1 “

` 1 “ 400ε, so

1
1
?
ą
.
400
200 ` 2002 ´ 1

y 2 “ d2n ´ 2εdn ` ε2 ` 1 “ d2n ` εp400 ´ 2dn q.
1
1
2
2
and we assumed dn ă 100, this shows that y ą dn ` . So, as we laimed, with this
400
2
1
2
2
list of radar pings, no matter what the hunter does, the rabbit might a hieve dn`200 ą dn ` .
2
The wabbit wins.
Sin e ε ą

Many dierent versions of the solution above an be found by repla ing 200 with some
other number N for the number of hops the rabbit takes between reveals. If this is done, we have:

Comment 1.

ε“N´
and
so, as long as N ą dn , we would nd

a
N2 ´ 1 ą

1
1
?
ą
2N
N ` N2 ´ 1

ε2 ` 1 “ 2N ε,

y 2 “ d2n ` εp2N ´ 2dn q ą d2n `

N ´ dn
.
N

1
For example, taking N “ 101 is already enoughthe squared distan e in reases by at least 101
every
2
4
8
9
101 rounds, and 101 ¨ 10 “ 1.0201 ¨ 10 ă 10 rounds are enough for the rabbit. If the statement is
made sharper, some su h versions might not work any longer.
Comment 2.

rounds.

The original statement asked whether the distan e ould be kept under 1010 in 10100

46

IMO 2017, Rio de Janeiro

C6.
unit

Let n ą 1 be an integer.

ube is painted with one

An n ˆ n ˆ n

ube is

olor. For ea h n ˆ n ˆ 1 box

of the three possible orientations), we

3
omposed of n unit ubes. Ea h
2
onsisting of n unit ubes (of any

onsider the set of the

olor is listed only on e). This way, we get 3n sets of

olors present in that box (ea h

olors, split into three groups a

ording

to the orientation. It happens that for every set in any group, the same set appears in both
of the other groups. Determine, in terms of n, the maximal possible number of

olors that are

present.

(Russia)

npn`1qp2n`1q
Answer: The maximal number is
.
6
Solution 1.

-box, a y -box, or a z -box, a

Call a n ˆ n ˆ 1 box an x

its short side. Let C be the number of

olors in a valid

ording to the dire tion of

onguration. We start with the upper

bound for C .
Let C1 , C2 , and C3 be the sets of

olors whi h appear in the big

twi e, and at least thri e, respe tively. Let Mi be the set of unit

ube exa tly on e, exa tly

ubes whose

and denote ni “ |Mi |.

Consider any x-box X , and let Y and Z be a y - and a z -box

olors are in Ci ,

ontaining the same set of

olors as X does.

Claim. 4|X X M1 | ` |X X M2 | ď 3n ` 1.
Proof. We distinguish two ases.
Case 1: X X M1 ‰ ∅.

A ube from X X M1 should appear in all three boxes X , Y , and Z , so it should lie in
X X Y X Z . Thus X X M1 “ X X Y X Z and |X X M1 | “ 1.
Consider now the ubes in X X M2 . There are at most 2pn ´ 1q of them lying in X X Y or
X X Z (be ause the ube from X X Y X Z is in M1 ). Let a be some other ube from X X M2 .
1
Re all that there is just one other ube a sharing a olor with a. But both Y and Z should
1
1
1
ontain su h ube, so a P Y X Z (but a R X X Y X Z ). The map a ÞÑ a is learly inje tive,
so the number of ubes a we are interested in does not ex eed |pY X Zq z X| “ n ´ 1. Thus
|X XM2 | ď 2pn´1q`pn´1q “ 3pn´1q, and hen e 4|X XM1 |`|X XM2 | ď 4`3pn´1q “ 3n`1.

Case 2: X X M1 “ ∅.
In this

ase, the same argument applies with several

hanges.

Indeed, X X M2

ontains

at most 2n ´ 1 ubes from X X Y or X X Z . Any other ube a in X X M2 orresponds to
1
1
some a P Y X Z (possibly with a P X ), so there are at most n of them. All this results in

|X X M2 | ď p2n ´ 1q ` n “ 3n ´ 1, whi h is even better than we need (by the assumptions of
our ase).
l
Summing up the inequalities from the Claim over all x-boxes X , we obtain
4n1 ` n2 ď np3n ` 1q.
3
Obviously, we also have n1 ` n2 ` n3 “ n .

Now we are prepared to estimate C . Due to the denition of the Mi , we have ni ě i|Ci |, so

C ď n1 `

n1 ` n2 ` n3 4n1 ` n2
n3 3n2 ` n
npn ` 1qp2n ` 1q
n2 n3
`
“
`
ď
`
“
.
2
3
3
6
3
6
6

It remains to present an example of an appropriate
of

olors. For ea h

olor, we present the set of all

oloring in the above-mentioned number

ubes of this

olor. These sets are:

n singletons of the form Si “ tpi, i, iqu (with 1 ď i ď n);
` n˘
1
2
3
doubletons of the forms Di,j “ tpi, j, jq, pj, i, iqu, Di,j “ tpj, i, jq, pi, j, iqu, and Di,j “
2. 3
2
tpj, j, iq, pi, i, jqu (with 1 ď i ă j ď n);
1.

Shortlisted problems  solutions

3.

47

` ˘
2 n3 triplets of the form Ti,j,k “ tpi, j, kq, pj, k, iq, pk, i, jqu (with 1 ď i ă j ă k ď n or
1 ď i ă k ă j ď n).
th

One may easily see that the i
that

n`

boxes of ea h orientation

ontain the same set of

olors, and

npn ` 1qp2n ` 1q
3npn ´ 1q npn ´ 1qpn ´ 2q
`
“
2
3
6

olors are used, as required.
Solution 2.

We will approa h a new version of the original problem. In this new version, ea h

ube may have a

olor, or be

invisible (not both). Now we make sets of olors for ea h n ˆ n ˆ 1

box as before (where invisible" is not

onsidered a

as before. Finally, we require that, for every

olor) and group them by orientation, also

non-empty set in any group, the same set must

appear in the other 2 groups. What is the maximum number of
requirements?
Let us

all

olors present with these new

strange a big nˆnˆn ube whose painting s heme satises the new requirements,

and let D be the number of

olors in a strange

ube.

Note that any

ube that satises the

original requirements is also strange, so maxpDq is an upper bound for the original answer.
.
Claim. D ď npn`1qp2n`1q
6
Proof. The proof is by indu tion on n. If n “ 1, we must paint the ube with at most 1 olor.
Now, pi k a n ˆ n ˆ n strange

ube A, where n ě 2. If A is

ompletely invisible, D “ 0 and

we are done. Otherwise, pi k a non-empty set of olors S whi h orresponds to, say, the boxes
X , Y and Z of dierent orientations.
Now nd all ubes in A whose olors are in S and make them invisible. Sin e X , Y
and Z are now ompletely invisible, we an throw them away and fo us on the remaining
pn ´ 1q ˆ pn ´ 1q ˆ pn ´ 1q ube B . The sets of olors in all the groups for B are the same
as the sets for A, removing exa tly the olors in S , and no others! Therefore, every nonempty
set that appears in one group for B still shows up in all possible orientations (it is possible
that an empty set of olors in B only mat hed X , Y or Z before these were thrown away, but
remember we do not require empty sets to mat h anyway). In summary, B is also strange.
pn´1qnp2n´1q
olors. Sin e
By the indu tion hypothesis, we may assume that B has at most
6
pn´1qnp2n´1q
2
there were at most n dierent olors in S , we have that A has at most
` n2 “
6
npn`1qp2n`1q
olors.
l
6
Finally, the

onstru tion in the previous solution shows a painting s heme (with no invisible

ubes) that rea hes this maximum, so we are done.

48

IMO 2017, Rio de Janeiro

C7.

For any nite sets X and Y of positive integers, denote by fX pkq the k

th

smallest

positive integer not in X , and let

X ˚ Y “ X Y tfX pyq : y P Y u.
Let A be a set of a ą 0 positive integers, and let B be a set of b ą 0 positive integers. Prove
that if A ˚ B “ B ˚ A, then

A
˚ pA ˚ ¨ ¨ ¨ ˚ pA ˚ pA ˚ Aqq . . . q “ looooooooooooooooooomooooooooooooooooooon
B ˚ pB ˚ ¨ ¨ ¨ ˚ pB ˚ pB ˚ Bqq . . . q .
looooooooooooooooooomooooooooooooooooooon
B appears a times

A appears b times

(U.S.A.)

Ă Zą0 , we dene gpXq “
tgpxq : x P Xu. We have that the image of fX is fX pZą0 q “ Zą0 z X . We now show a general
lemma about the operation ˚, with the goal of showing that ˚ is asso iative.
Lemma 1. Let X and Y be nite sets of positive integers. The fun tions fX˚Y and fX ˝ fY are

Solution 1.

For any fun tion g : Zą0 Ñ Zą0 and any subset X

equal.

Proof. We have
fX˚Y pZą0 q “ Zą0 zpX ˚Y q “ pZą0 zXqzfX pY q “ fX pZą0 qzfX pY q “ fX pZą0 zY q “ fX pfY pZą0 qq.
Thus, the fun tions fX˚Y and fX ˝ fY are stri tly in reasing fun tions with the same range.

“ fX ˝ fY .
l
Lemma 1 implies that ˚ is asso iative, in the sense that pA ˚ Bq ˚ C “ A ˚ pB ˚ Cq for any
nite sets A, B , and C of positive integers. We prove the asso iativity by noting

Be ause a stri tly fun tion is uniquely dened by its range, we have fX˚Y

Zą0 z ppA ˚ Bq ˚ Cq “ fpA˚Bq˚C pZą0 q “ fA˚B pfC pZą0 qq “ fA pfB pfC pZą0 qqq
“ fA pfB˚C pZą0 q “ fA˚pB˚Cq pZą0 q “ Zą0 z pA ˚ pB ˚ Cqq.

In light of the asso iativity of ˚, we may drop the parentheses when we write expressions

like A ˚ pB ˚ Cq. We also introdu e the notation

X ˚k “ loooooooooooooooooooomoooooooooooooooooooon
X ˚ pX ˚ ¨ ¨ ¨ ˚ pX ˚ pX ˚ Xqq . . . q .
X appears k times

˚b
Our goal is then to show that A ˚ B “ B ˚ A implies A
“ B ˚a . We will do so via the following
general lemma.

Lemma 2. Suppose that X and Y are nite sets of positive integers satisfying X ˚ Y “ Y ˚ X

and |X| “ |Y |. Then, we must have X “ Y .

Proof. Assume that X and Y are not equal. Let s be the largest number in exa tly one of

X and Y . Without loss of generality, say that s P X z Y . The number fX psq
number not in X , whi h implies that
ˇ
ˇ
fX psq “ s ` ˇX X t1, 2, . . . , fX psquˇ.

ounts the s

th

(1)

Sin e fX psq ě s, we have that

(
(
fX psq ` 1, fX psq ` 2, . . . X X “ fX psq ` 1, fX psq ` 2, . . . X Y,

whi h, together with the assumption that |X| “ |Y |, gives

ˇ
ˇ ˇ
ˇ
ˇX X t1, 2, . . . , fX psquˇ “ ˇY X t1, 2, . . . , fX psquˇ.

(2)

Shortlisted problems  solutions

Now

49

onsider the equation

ˇ
ˇ
t ´ ˇY X t1, 2, . . . , tuˇ “ s.
“
˘
This equation is satised only when t P fY psq, fY ps ` 1q , be ause the left hand side ounts
the number of elements up to t that are not in Y . We have that the value t “ fX psq satises
the above equation be ause of (1) and (2). Furthermore, sin e fX psq R X and fX psq ě s, we
have that fX psq R Y due to the maximality of s. Thus, by the above dis ussion, we must have
fX psq “ fY psq.
Finally, we arrive at a ontradi tion. The value fX psq is neither in X nor in fX pY q, be ause
s is not in Y by assumption. Thus, fX psq R X ˚Y . However, sin e s P X , we have fY psq P Y ˚X ,
a ontradi tion.
l
˚b
˚a
We are now ready to nish the proof. Note rst of all that |A | “ ab “ |B |. Moreover,
˚b
sin e A ˚ B “ B ˚ A, and ˚ is asso iative, it follows that A
˚ B ˚a “ B ˚a ˚ A˚b . Thus, by
˚b
Lemma 2, we have A
“ B ˚a , as desired.
Taking A “ X ˚k and B “ X ˚l generates many non-trivial examples where A˚B “ B˚A.
There are also other examples not of this form. For example, if A “ t1, 2, 4u and B “ t1, 3u, then
A ˚ B “ t1, 2, 3, 4, 6u “ B ˚ A.
Comment 1.

Solution 2.

We will use Lemma 1 from Solution 1. Additionally, let X

˚k

be dened as in

Solution 1. If X and Y are nite sets, then

fX “ fY ðñ fX pZą0 q “ fY pZą0 q ðñ pZą0 z Xq “ pZą0 z Y q ðñ X “ Y,

(3)

where the rst equivalen e is be ause fX and fY are stri tly in reasing fun tions, and the se ond
equivalen e is be ause fX pZą0 q “ Zą0 z X and fY pZą0 q “ Zą0 z Y .

Denote g “ fA and h “ fB . The given relation A ˚ B “ B ˚ A is equivalent to fA˚B “ fB˚A

be ause of (3), and by Lemma 1 of the rst solution, this is equivalent to g ˝h “ h˝g . Similarly,
˚b
“ B ˚a is equivalent to g b “ ha . We will show that
the required relation A

g b pnq “ ha pnq

(4)

for all n P Zą0 , whi h su es to solve the problem.
To start, we

laim that (4) holds for all su iently large n.

Indeed, let p and q be the

maximal elements of A and B , respe tively; we may assume that p ě q . Then, for every n ě p
b
a
we have gpnq “ n ` a and hpnq “ n ` b, when e g pnq “ n ` ab “ h pnq, as was laimed.
b
In view of this laim, if (4) is not identi ally true, then there exists a maximal s with g psq ‰
ha psq. Without loss of generality, we may assume that gpsq ‰ s, for if we had gpsq “ hpsq “ s,

then s would satisfy (4). As g is in reasing, we then have gpsq ą s, so (4) holds for n “ gpsq.

But then we have

gpg bpsqq “ g b`1 psq “ g bpnq “ ha pnq “ ha pgpsqq “ gpha psqq,

where the last equality holds in view of g ˝ h “ h ˝ g . By the inje tivity of g , the above
b
a
equality yields g psq “ h psq, whi h ontradi ts the hoi e of s. Thus, we have proved that (4)

is identi ally true on Zą0 , as desired.

We present another proof of Lemma 2 of the rst solution.
Let x “ |X| “ |Y |. Say that u is the smallest number in X and v is the smallest number in Y ;
assume without loss of generality that u ď v .
Let T be any nite set of positive integers, and dene t “ |T |. Enumerate the elements of X as
x1 ă x2 ă ¨ ¨ ¨ ă xn . Dene Sm “ fpT ˚X ˚pm´1q q pXq, and enumerate its elements sm,1 ă sm,2 ă ¨ ¨ ¨ ă
sm,n . Note that the Sm are pairwise disjoint; indeed, if we have m ă m1 , then
Comment 2.

1

Sm Ă T ˚ X ˚m Ă T ˚ X ˚pm ´1q

and

1

1

Sm1 “ pT ˚ X ˚m q z pT ˚ X ˚pm ´1q q

We laim the following statement, whi h essentially says that the Sm are eventually linear translates
of ea h other:

50

IMO 2017, Rio de Janeiro

Claim. For every i, there exists some mi and ci su h that for all m ą mi , we have that sm,i “ t`mn´ci .
Furthermore, the ci do not depend on the hoi e of T .

First, we show that this laim implies Lemma 2. We may hoose T “ X and T “ Y . Then, there
is some m1 su h that for all m ě m1 , we have

fX ˚m pXq “ fpY ˚X ˚pm´1q q pXq.

(5)

Be ause u is the minimum element of X , v is the minimum element of Y , and u ď v , we have that
˜
¸
˜
¸
8
8
ď
ď
`
˘
1
1
fX ˚m pXq Y X ˚m “
fpY ˚X ˚pm´1q q pXq Y Y ˚ X ˚pm ´1q “ tu, u ` 1, . . . u,
m“m1

m“m1

and in both the rst and se ond expressions, the unions are of pairwise distin t sets. By (5), we obtain
1
1
1
1
X ˚m “ Y ˚ X ˚pm ´1q . Now, be ause X and Y ommute, we get X ˚m “ X ˚pm ´1q ˚ Y , and so X “ Y .
We now prove the laim.

Proof of the laim. We indu t downwards on i, rst proving the statement for i “ n, and so on.

Assume that m is hosen so that all elements of Sm are greater than all elements of T (whi h is
possible be ause T is nite). For i “ n, we have that sm,n ą sk,n for every k ă m. Thus, all pm ´ 1qn
numbers of the form sk,u for k ă m and 1 ď u ď n are less than sm,n . We then have that sm,n is the
ppm ´ 1qn ` xn qth number not in T , whi h is equal to t ` pm ´ 1qn ` xn. So we may hoose cn “ xn ´ n,
whi h does not depend on T , whi h proves the base ase for the indu tion.
For i ă n, we have again that all elements sm,j for j ă i and sp,i for p ă m are less than sm,i ,
so sm,i is the ppm ´ 1qi ` xi qth element not in T or of the form sp,j for j ą i and p ă m. But by
the indu tive hypothesis, ea h of the sequen es sp,j is eventually periodi with period n, and thus the
sequen e sm,i su h must be as well. Sin e ea h of the sequen es sp,j ´ t with j ą i eventually do not
depend on T , the sequen e sm,i ´ t eventually does not depend on T either, so the indu tive step is
l
omplete. This proves the laim and thus Lemma 2.

Shortlisted problems  solutions

C8.

51

Let n be a given positive integer.

nonnegative

oordinates initially

In the Cartesian plane, ea h latti e point with

ontains a buttery, and there are no other butteries. The

neighborhood of a latti e point c onsists of all latti e points within the axis-aligned p2n ` 1q ˆ
p2n ` 1q square entered at c, apart from c itself. We all a buttery lonely, rowded, or omfortable, depending on whether the number of butteries in its neighborhood N is respe tively
less than, greater than, or equal to half of the number of latti e points in N .
Every minute, all lonely butteries y away simultaneously.

This pro ess goes on for as

long as there are any lonely butteries. Assuming that the pro ess eventually stops, determine
the number of

Answer:

omfortable butteries at the nal state.

(Bulgaria)

2

n ` 1.

Solution. We always identify a buttery with the latti e point it is situated at. For two points

and q , we write p ě q if ea h

oordinate of p is at least the

orresponding

p

oordinate of q . Let

O be the origin, and let Q be the set of initially o upied points, i.e., of all latti e points with
nonnegative oordinates. Let RH “ tpx, 0q : x ě 0u and RV “ tp0, yq : y ě 0u be the sets of
the latti e points lying on the horizontal and verti al boundary rays of Q. Denote by Npaq the
neighborhood of a latti e point a.

1. Initial observations. We

all a set of latti e points

up-right losed if its points stay in the

set after being shifted by any latti e ve tor pi, jq with i, j ě 0. Whenever the butteries form a

losed set S , we have |Nppq X S| ě |Npqq X S| for any two points p, q P S with p ě q .

up-right

So, sin e Q is up-right

losed, the set of butteries at any moment also preserves this property.

We assume all forth oming sets of latti e points to be up-right
When speaking of some set S of latti e points, we

losed.

all its points

lonely, omfortable, or

rowded with respe t to this set (i.e., as if the butteries were exa tly at all points of S ). We
stable if it ontains no lonely points. In what follows, we are interested only

all a set S Ă Q

in those stable sets whose

omplements in Q are nite, be ause one

nite number of butteries

an y away on ea h minute.

If the initial set Q of butteries

an easily see that only a

ontains some stable set S , then,

learly no buttery of

this set will y away. On the other hand, the set F of all butteries in the end of the pro ess
is stable. This means that F is the largest (with respe t to in lusion) stable set within Q, and
we are about to des ribe this set.

2. A des ription of a nal set. The following notion will be useful. Let U “ t~u1 , ~u2, . . . , ~ud u

be a set of d pairwise non-parallel latti e ve tors, ea h having a positive x- and a negative

y - oordinate. Assume that they are numbered in in reasing order a ording to slope. We now
ÝÝÝÑ ui
dene a U - urve to be the broken line p0 p1 . . . pd su h that p0 P RV , pd P RH , and pi´1 pi “ ~
for all i “ 1, 2, . . . , m (see the Figure below to the left).
~u~u44444

pp00000

~u1
~u~u22222 ~u
~u33333
−→

~u1

O

pp1111

Kn

~v1

−→
~u3

~v~v33333

pp33333
~u4

D
D

d1
d2

pp2222

~u2

d0

O

Constru tion of U - urve

pp4444

d3
~v4

r1 r2 r3

r4 (k4 = 3)

Constru tion of D

52

IMO 2017, Rio de Janeiro

Now, let Kn “ tpi, jq : 1 ď i ď n,

´n ď j ď ´1u. Consider all the rays emerging at O and
passing through a point from Kn ; number them as r1 , . . . , rm in in reasing order a ording to
ÝÝÑ
slope. Let Ai be the farthest from O latti e point in ri X Kn , set ki “ |ri X Kn |, let ~
vi “ OAi ,
vi : 1 ď i ď mu; see the Figure above to the right. We will on entrate
and nally denote V “ t~
1
on the V - urve d0 d1 . . . dm ; let D be the set of all latti e points p su h that p ě p for some (not
1
ne essarily latti e) point p on the V - urve. In fa t, we will show that D “ F .
Clearly, the V - urve is symmetri in the line y “ x. Denote by D the onvex hull of D .

3. We prove that the set D ontains all stable sets. Let S Ă Q be a stable set (re all that

it is assumed to be up-right
onvex hull;

omplement in Q). Denote by S its

losed and to have a nite

learly, the verti es of S are latti e points. The boundary of S

onsists of two rays

(horizontal and verti al ones) along with some V˚ - urve for some set of latti e ve tors V˚ .

Claim 1. For every ~vi P V , there is a ~vi˚ P V˚ o-dire ted with ~v with |~vi˚ | ě |~v |.
Proof. Let ℓ be the supporting line of S parallel to ~vi (i.e., ℓ ontains some point of S , and
the set S lies on one side of ℓ). Take any point b P ℓ X S and
the set Npbq z ℓ into two

onsider Npbq. The line ℓ splits

ongruent parts, one having an empty interse tion with S . Hen e, in

order for b not to be lonely, at least half of the set ℓ X Npbq (whi h

ontains 2ki points) should

ontains a segment ℓ X S with at least ki ` 1 latti e points
orresponds to the required ve tor ~
vi˚ P V˚ .
l

lie in S . Thus, the boundary of S

(in luding b) on it; this segment

~v1∗
~v~viiii
||

Kn

b
∗∗
> k {{zz ~v~viiiii∗∗
>
kiiii p
pooii
nntts
}}
s

~v2∗

~v1

~v3∗

~v2
ℓ

~v3

p

p

′

~v4∗

~v4
Proof of Claim 1

∂S
∂D

Proof of Claim 2

Claim 2. Ea h stable set S Ď Q lies in D.
Proof. To show this, it su es to prove that the V˚ - urve lies in D, i.e., that all its verti es

1
1
do so. Let p be an arbitrary vertex of the V˚ - urve; p partitions this

urve into two parts, X

(being down-right of p) and Y (being up-left of p). The set V is split now into two parts: VX
onsisting of those ~
vi P V for whi h ~vi˚ orresponds to a segment in X , and a similar part VY .
Noti e that the V - urve onsists of several segments orresponding to VX , followed by those
orresponding to VY . Hen e there is a vertex p of the V - urve separating VX from VY . Claim 1
1
1
now yields that p ě p, so p P D , as required.
l
Claim 2 implies that the nal set F is

ontained in D .

4. D is stable, and its omfortable points are known. Re all the denitions of ri ; let ri1 be the
ray omplementary to ri . By our denitions, the set NpOq
1
ri and ri`1 , as well as between ri1 and ri`1
.

ontains no points between the rays

Claim 3. In the set D, all latti e points of the V - urve are omfortable.
Proof. Let p be any latti e point of the V - urve, belonging to some segment di di`1 . Draw the
line ℓ

ontaining this segment. Then ℓ X D

ontains exa tly ki ` 1 latti e points, all of whi h lie

in Nppq ex ept for p. Thus, exa tly half of the points in Nppq X ℓ lie in D . It remains to show

that all points of Nppq above ℓ lie in D (re all that all the points below ℓ la k this property).

Shortlisted problems  solutions

53

Noti e that ea h ve tor in V has one
of p

oordinate greater than n{2; thus the neighborhood

ontains parts of at most two segments of the V - urve su

eeding di di`1 , as well as at most

two of those pre eding it.
The angles formed by these onse utive segments are obtained from those formed by rj and
1
rj´1 (with i ´ 1 ď j ď i ` 2) by shifts; see the Figure below. All the points in Nppq above ℓ
1
1
whi h ould lie outside D lie in shifted angles between rj , rj`1 or rj , rj´1 . But those angles,
restri ted to Nppq, have no latti e points due to the above remark. The

laim is proved.

l

′
ri−1
′
ri+2

di
ri+2
p

ri+1

Kn

di+1
ddi+2
i+2
i+2
i+2

ri
ri−1
Proof of Claim 3

Claim 4. All the points of D whi h are not on the boundary of D are rowded.
Proof. Let p P D be su h a point. If it is to the up-right of some point p1 on the urve, then the
Ý
Ñ
1
1
laim is easy: the shift of Npp q X D by p p is still in D , and Nppq

ontains at least one more

point of D  either below or to the left of p. So, we may assume that p lies in a right triangle
onstru ted on some hypothenuse di di`1 . Noti e here that di , di`1 P Nppq.

Draw a line ℓ k di di`1 through p, and draw a verti al line h through di ; see Figure below.

Let DL and DR be the parts of D lying to the left and to the right of h, respe tively (points
of D X h lie in both parts).

ℓ

p
ddiiiii

−→

di+1

di

p
ddi+1
i+1
i+1
i+1
i+1

h
Proof of Claim 4

ÝÑ ÝÝÝÝÝÑ ÝÝÝÑ ÝÝÝÑ
ÝÝÝÑ
ÝÑ
ÝÝÝÑ
order by slope. This means that DL shifted by di p still lies in D , as well as DR shifted by di`1 p.
As we have seen in the proof of Claim 3, these two shifts over all points of Nppq above ℓ, along
with those on ℓ to the left of p. Sin e Nppq ontains also di and di`1 , the point p is rowded.
l
Thus, we have proved that D “ F , and have shown that the latti e points on the V - urve
are exa tly the omfortable points of D . It remains to nd their number.
Re all the denition of Kn (see Figure on the rst page of the solution). Ea h segment di di`1
ontains ki latti e points dierent from di . Taken over all i, these points exhaust all the latti e
points in the V - urve, ex ept for d1 , and thus the number of latti e points on the V - urve is
ř
řm
2
1` m
i“1 ki . On the other hand,
i“1 ki is just the number of points in Kn , so it equals n .
2
Hen e the answer to the problem is n ` 1.
Noti e that the ve tors di p, di`1 di`2 , di di`1 , di´1 di , and pdi`1 are arranged in non-in reasing

54

IMO 2017, Rio de Janeiro

The assumption that the pro ess eventually stops is unne essary for the problem, as
one an see that, in fa t, the pro ess stops for every n ě 1. Indeed, the proof of Claims 3 and 4 do not
rely essentially on this assumption, and they together yield that the set D is stable. So, only butteries
that are not in D may y away, and this takes only a nite time.
This assumption has been inserted into the problem statement in order to avoid several te hni al
details regarding niteness issues. It may also simplify several other arguments.
Comment 1.

The des ription of the nal set Fp“ Dq seems to be ru ial for the solution; the
Problem Sele tion Committee is not aware of any solution that ompletely avoids su h a des ription.
On the other hand, after the set D has been dened, the further steps may be performed in several
ways. For example, in order to prove that all butteries outside D will y away, one may argue as
follows. (Here we will also make use of the assumption that the pro ess eventually stops.)

Comment 2.

First of all, noti e that the pro ess an be modied in the following manner: Ea h minute, exa tly
one of the lonely butteries ies away, until there are no more lonely butteries. The modied pro ess
ne essarily stops at the same state as the initial one. Indeed, one may observe, as in solution above,
that the (unique) largest stable set is still the nal set for the modied pro ess.
Thus, in order to prove our laim, it su es to indi ate an order in whi h the butteries should y
away in the new pro ess; if we are able to exhaust the whole set Q z D , we are done.

Let C0 “ d0 d1 . . . dm be the V - urve. Take its opy C and shift it downwards so that d0 omes to
some point below the origin O . Now we start moving C upwards ontinuously, until it omes ba k to its
initial position C0 . At ea h moment when C meets some latti e points, we onvin e all the butteries at
those points to y away in a ertain order. We will now show that we always have enough arguments
for butteries to do so, whi h will nish our argument for the laim..
Let C 1 “ d10 d11 . . . d1m be a position of C when it meets some butteries. We assume that all butteries
under this urrent position of C were already onvin ed enough and ied away. Consider the lowest
buttery b on C 1 . Let d1i d1i`1 be the segment it lies on; we hoose i so that b ‰ d1i`1 (this is possible
be ause C as not yet rea hed C0 ).
Draw a line ℓ ontaining the segment d1i d1i`1 . Then all the butteries in N pbq are situated on or
above ℓ; moreover, those on ℓ all lie on the segment di di`1 . But this segment now ontains at most ki
butteries (in luding b), sin e otherwise some buttery had to o upy d1i`1 whi h is impossible by the
hoi e of b. Thus, b is lonely and hen e may be onvin ed to y away.
After b has ied away, we swit h to the lowest of the remaining butteries on C 1 , and so on.
Claims 3 and 4 also allow some dierent proofs whi h are not presented here.

Shortlisted problems  solutions

This page is intentionally left blank

55

56

IMO 2017, Rio de Janeiro

Geometry
G1.

Let ABCDE be a onvex pentagon su h that AB “ BC “ CD , =EAB “ =BCD , and

=EDC “ =CBA. Prove that the perpendi ular line from E to BC and the line segments AC
and BD are on urrent.

(Italy)

Solution 1.

Throughout the solution, we refer to =A, =B , =C , =D , and =E as internal

angles of the pentagon ABCDE . Let the perpendi ular bise tors of AC and BD , whi h pass
respe tively through B and C , meet at point I .

Then BD K CI and, similarly, AC

K BI .

Hen e AC and BD meet at the ortho enter H of the triangle BIC , and IH K BC . It remains
to prove that E lies on the line IH or, equivalently, EI K BC .

Lines IB and IC bise t =B and =C , respe tively. Sin e IA “ IC , IB “ ID , and AB “

BC “ CD , the triangles IAB , ICB and ICD are ongruent. Hen e =IAB “ =ICB “
=C{2 “ =A{2, so the line IA bise ts =A. Similarly, the line ID bise ts =D . Finally, the
line IE bise ts =E be ause I lies on all the other four internal bise tors of the angles of the
pentagon.

0
The sum of the internal angles in a pentagon is 540 , so

=E “ 5400 ´ 2=A ` 2=B.
In quadrilateral ABIE ,

1
1
=BIE “ 3600 ´ =EAB ´ =ABI ´ =AEI “ 3600 ´ =A ´ =B ´ =E
2
2
1
0
0
“ 360 ´ =A ´ =B ´ p270 ´ =A ´ =Bq
2
1
0
“ 90 ` =B “ 900 ` =IBC,
2
whi h means that EI K BC ,

ompleting the proof.

E

A
D
I

H

B

Solution 2.

T

C

We present another proof of the fa t that E lies on line IH . Sin e all ve internal

bise tors of ABCDE meet at I , this pentagon has an ins ribed

ir le with

enter I . Let this

ir le tou h side BC at T .
Applying Brian hon's theorem to the (degenerate) hexagon ABT CDE we

AC , BD and ET are

on urrent, so point E also lies on line IHT ,

on lude that

ompleting the proof.

Shortlisted problems  solutions

57

We present yet another proof that EI K BC . In pentagon ABCDE , =E ă
=A ` =B ` =C ` =D ą 3600 . Then =A ` =B “ =C ` =D ą 1800 , so rays EA

Solution 3.

0

180 ðñ
and CB meet at a point P , and rays BC and ED meet at a point Q. Now,
=P BA “ 1800 ´ =B “ 1800 ´ =D “ =QDC

and, similarly, =P AB “ =QCD . Sin e AB “ CD , the triangles P AB and QCD are

ongruent

with the same orientation. Moreover, P QE is isos eles with EP “ EQ.

E
A
D
I

H
P

B

C

In Solution 1 we have proved that triangles IAB and ICD are also

Q
ongruent with the

Then we on lude that quadrilaterals P BIA and QDIC are ongruent,
“ IQ. Then EI is the perpendi ular bise tor of P Q and, therefore, EI K
P Q ðñ EI K BC .

same orientation.
whi h implies IP

Comment. Even though all three solutions used the point I , there are solutions that do not need it.
We present an outline of su h a solution: if J is the in enter of △QCD (with P and Q as dened in
Solution 3), then a simple angle hasing shows that triangles CJD and BHC are ongruent. Then if
S is the proje tion of J onto side CD and T is the orthogonal proje tion of H onto side BC , one an
verify that

QT “ QC ` CT “ QC ` DS “ QC `

CD ` DQ ´ QC
P B ` BC ` QC
PQ
“
“
,
2
2
2

so T is the midpoint of P Q, and E , H and T all lie on the perpendi ular bise tor of P Q.

58

IMO 2017, Rio de Janeiro

G2.

Let R and S be distin t points on ir le Ω, and let t denote the tangent line to Ω at R.
1
Point R is the ree tion of R with respe t to S . A point I is hosen on the smaller ar RS of
Ω so that the ir um ir le Γ of triangle ISR1 interse ts t at two dierent points. Denote by A
1
the ommon point of Γ and t that is losest to R. Line AI meets Ω again at J . Show that JR
is tangent to Γ.

(Luxembourg)

1
ir les Ω and Γ we have =JRS “ =JIS “ =AR S . On the other hand,
1
sin e RA is tangent to Ω, we get =SJR “ =SRA. So the triangles ARR and SJR are similar,
Solution 1.

In the

and

R1 R
AR1
AR1
“
“
.
RJ
SR
SR1
1
1
1
1
The last relation, together with =AR S “ =JRR , yields △ASR „ △R JR, hen e
1
1
1
1
=SAR “ =RR J . It follows that JR is tangent to Γ at R .
ω
A
ω
R

A

I
R
I

Ω

S
J

Ω

S
R′

J

R′
Solution 1

A′
Solution 2

1
1
As in Solution 1, we noti e that =JRS “ =JIS “ =AR S , so we have RJ k AR .
1
1 1
Let A be the ree tion of A about S ; then ARA R is a parallelogram with enter S , and
1
hen e the point J lies on the line RA .
1 1
1
1
From =SR A “ =SRA “ =SJR we get that the points S, J, A , R are on y li . This
1
1
1
1
1
1
proves that =SR J “ =SA J “ =SA R “ =SAR , so JR is tangent to Γ at R .
Solution 2.

Shortlisted problems  solutions

G3.

Let O be the

59

ir um enter of an a ute s alene triangle ABC . Line OA interse ts the

altitudes of ABC through B and C at P and Q, respe tively. The altitudes meet at H . Prove
that the

ir um enter of triangle P QH lies on a median of triangle ABC .

(Ukraine)

AB ă AC . We have =P QH “ 900 ´
1
=QAB “ 90 ´ =OAB “ 2 =AOB “ =ACB , and similarly =QP H “ =ABC . Thus triangles
ABC and HP Q are similar. Let Ω and ω be the ir um ir les of ABC and HP Q, respe tively.
0
Sin e =AHP “ 90 ´ =HAC “ =ACB “ =HQP , line AH is tangent to ω .
Solution. Suppose, without loss of generality, that

0

A
A
Ω
P
P

H
H

ω

T

O
Q
Q

B
B

S

Let T be the

M

enter of ω and let lines AT and BC meet at M .

C

We will take advantage

of the similarity between ABC and HP Q and the fa t that AH is tangent to ω at H , with

A on line P Q. Consider the

orresponding tangent AS to Ω, with S P BC . Then S and A

„ △HP Q, and therefore =OSM “ =OAT “ =OAM .
Hen e quadrilateral SAOM is y li , and sin e the tangent line AS is perpendi ular to AO ,
=OMS “ 1800 ´ =OAS “ 900 . This means that M is the orthogonal proje tion of O onto
BC , whi h is its midpoint. So T lies on median AM of triangle ABC .
orrespond to ea h other in △ABC

60

IMO 2017, Rio de Janeiro

G4.

In triangle ABC , let ω be the ex ir le opposite A. Let D , E , and F be the points

where ω is tangent to lines BC , CA, and AB , respe tively. The
at P and Q. Let M be the midpoint of AD . Prove that the

ir le AEF interse ts line BC

ir le MP Q is tangent to ω .

(Denmark)

Solution 1. Denote by Ω the ir le AEF P Q, and denote by γ the ir le P QM . Let the line
AD meet ω again at T ‰ D . We will show that γ is tangent to ω at T .
1
We rst prove that points P, Q, M, T are on y li . Let A be the enter of ω . Sin e
1
1
1
A E K AE and A F K AF , AA is a diameter in Ω. Let N be the midpoint of DT ; from
A1 D “ A1 T we an see that =A1 NA “ 900 and therefore N also lies on the ir le Ω. Now, from
the power of D with respe t to the ir les γ and Ω we get

DP ¨ DQ “ DA ¨ DN “ 2DM ¨
so P, Q, M, T are
If

DT
“ DM ¨ DT,
2

on y li .

EF k BC , then ABC is isos eles and the problem is now immediate by symmetry.

Otherwise, let the tangent line to ω at T meet line BC at point R. The tangent line segments
RD and RT have the same length, so A1 R is the perpendi ular bise tor of DT ; sin e ND “ NT ,

N lies on this perpendi ular bise tor.
1
2
1
In right triangle A RD , RD “ RN ¨RA “ RP ¨RQ, in whi h the last equality was obtained
2
from the power of R with respe t to Ω. Hen e RT “ RP ¨ RQ, whi h implies that RT is also
tangent to γ . Be ause RT is a ommon tangent to ω and γ , these two ir les are tangent at T .
A
Ω
M

γ
P

B

D

R

Q

C

ω
E
F

N
A

′

T

Solution 2.

After proving that P, Q, M, T are

fashion. We only

onsider the

on y li , we nish the problem in a dierent

ase in whi h EF and BC are not parallel. Let lines P Q and

EF meet at point R. Sin e P Q and EF are radi al axes of Ω, γ and ω, γ , respe tively, R is the
radi al

enter of these three

With respe t to the

ir les.

ir le ω , the line DR is the polar of D , and the line EF is the polar

of A. So the pole of line ADT is DR X EF “ R, and therefore RT is tangent to ω .
Finally, sin e T belongs to γ and ω and R is the radi al

enter of γ , ω and Ω, line RT is

the radi al axis of γ and ω , and sin e it is tangent to ω , it is also tangent to γ . Be ause RT is
a

ommon tangent to ω and γ , these two

ir les are tangent at T .

Comment. In Solution 2 we dened the point R from Solution 1 in a dierent way.

Shortlisted problems  solutions

Solution 3.

61

We give an alternative proof that the

ir les are tangent at the

ommon point T .

Again, we start from the fa t that P, Q, M, T are on y li . Let point O be the midpoint of
1
1
1
1
diameter AA . Then MO is the midline of triangle ADA , so MO k A D . Sin e A D K P Q,

MO is perpendi ular to P Q as well.
Looking at ir le Ω, whi h has enter O , MO K P Q implies that MO is the perpendi ular
Ŋ
bise tor of the hord P Q. Thus M is the midpoint of ar P
Q from γ , and the tangent line m
to γ at M is parallel to P Q.
A

Ω
m
M

γ
P

O

B

D

C

ω

Q
E

F

N
A

′

T

TD
. It takes D to M , and the line P Q
TM
ir le that is tangent to a line at a given point and that goes through

Consider the homothety with
to the line m. Sin e the

enter T and ratio

another given point is unique, this homothety also takes ω (tangent to P Q and going through T )
to γ (tangent to m and going through T ). We

on lude that ω and γ are tangent at T .

62

G5.

IMO 2017, Rio de Janeiro

Let ABCC1 B1 A1 be a

onvex hexagon su h that AB “ BC , and suppose that the line

segments AA1 , BB1 , and CC1 have the same perpendi ular bise tor. Let the diagonals AC1
and A1 C meet at D , and denote by ω the

ir le ABC . Let ω interse t the

ir le A1 BC1 again

at E ‰ B . Prove that the lines BB1 and DE interse t on ω .

(Ukraine)

“ CC1 , then the hexagon is symmetri about the line BB1 ; in parti ular the ir les ABC and A1 BC1 are tangent to ea h other. So AA1 and CC1 must be
dierent. Sin e the points A and A1 an be inter hanged with C and C1 , respe tively, we may
assume AA1 ă CC1 .
Let R be the radi al enter of the ir les AEBC and A1 EBC1 , and the ir um ir le of the
symmetri trapezoid ACC1 A1 ; that is the ommon point of the pairwise radi al axes AC , A1 C1 ,
and BE . By the symmetry of AC and A1 C1 , the point R lies on the ommon perpendi ular
bise tor of AA1 and CC1 , whi h is the external bise tor of =ADC .
Let F be the se ond interse tion of the line DR and the ir le ACD . From the power of
R with respe t to the ir les ω and ACF D we have RB ¨ RE “ RA ¨ RC “ RD ¨ DF , so the
points B, E, D and F are on y li .
Ŕ.
The line RDF is the external bise tor of =ADC , so the point F bise ts the ar CDA
Ő ; let M be the point
By AB “ BC , on ir le ω , the point B is the midpoint of ar AEC
Ŋ of ω . Noti e that the
diametri ally opposite to B , that is the midpoint of the opposite ar CA
points B , F and M lie on the perpendi ular bise tor of AC , so they are ollinear.

Solution 1.

If AA1

R

A

A1

E
D

X

B

B1

F
ω
C

C1

M

Finally, let X be the se ond interse tion point of ω and the line DE . Sin e BM is a diameter
0
in ω , we have =BXM “ 90 . Moreover,

=EXM “ 1800 ´ =MBE “ 1800 ´ =F BE “ =EDF ,
so MX and F D are parallel. Sin e BX is perpendi ular to MX and BB1 is perpendi ular
to F D , this shows that X lies on line BB1 .

Shortlisted problems  solutions

Solution 2.

63

Dene point M as the point opposite to B on

interse tion of lines

ir le ω , and point R as the

AC , A1 C1 and BE , and show that R lies on the external bise tor of

=ADC , like in the rst solution.
Ő , the line BER is the external bise tor of =CEA.
Sin e B is the midpoint of the ar AEC
Now we show that the internal angle bise tors of =ADC and =CEA meet on the segment AC .
Let the angle bise tor of =ADC meet AC at S , and let the angle bise tor of =CEA, whi h is
1
line EM , meet AC at S . By applying the angle bise tor theorem to both internal and external
bise tors of =ADC and =CEA,
AS : CS “ AD : CD “ AR : CR “ AE : CE “ AS 1 : CS 1 ,
1
so indeed S “ S .

0
By =RDS “ =SER “ 90 the points R, S , D and E are

on y li .

R

A

A1

E

B

S = S′

D
B1
X

ω
C

C1

M

Now let the lines BB1 and DE meet at point X . Noti e that =EXB “ =EDS be ause both

BB1 and DS are perpendi ular to the line DR, we have that =EDS “ =ERS in ir le SRDE ,
and =ERS “ =EMB be ause SR K BM and ER K ME . Therefore, =EXB “ =EMB , so
indeed, the point X lies on ω .

64

IMO 2017, Rio de Janeiro

G6.

Let n ě 3 be an integer. Two regular n-gons A and B are given in the plane. Prove

that the verti es of A that lie inside B or on its boundary are

onse utive.

(That is, prove that there exists a line separating those verti es of A that lie inside B or on
its boundary from the other verti es of A.)

In both solutions, by a

Solution 1.

(Cze h Republi )

polygon we always mean its interior together with its

boundary.
We start with nding a regular n-gon C whi h piq is ins ribed into B (that is, all verti es

of C lie on the perimeter of B ); and piiq is either a translation of A, or a homotheti

image of A

with a positive fa tor.

enters of A and B ,
ÝÝÝÑ
respe tively, and let A be an arbitrary vertex of A. Let OB C be the ve tor o-dire tional
Ý
ÝÝÑ
to OA A, with C lying on the perimeter of B . The rotations of C around OB by multiples
of 2π{n form the required polygon. Indeed, it is regular, ins ribed into B (due to the rotational
ÝÝÝÑ
ÝÝÝÑ
symmetry of B ), and nally the translation/homothety mapping OA A to OB C maps A to C .
Su h a polygon may be

Now we separate two

onstru ted as follows. Let OA and OB be the

ases.

BT
C1
A1

A
C2

C

A22222
A
BR

OA
OB

C

BL

A

C

A
A3333
C3

A

BB

B
Constru tion of C

Case 1: Translation

Case 1: C is a translation of A by a ve tor ~v .
Denote by t the translation transform by ve tor ~
v . We need to prove that the verti es of C
whi h stay in B under t are
sian

onse utive. To visualize the argument, we refer the plane to Carte-

oordinates so that the x-axis is

and top/bottom are also introdu ed, a

o-dire tional with ~
v . This way, the notions of right/left
ording to the x- and y - oordinates, respe tively.

Let BT and BB be the top and the bottom verti es of B (if several verti es are extremal, we
take the rightmost of them). They split the perimeter of B into the

right part BR and the left

part BL (the verti es BT and BB are assumed to lie in both parts); ea h part forms a onne ted

subset of the perimeter of B . So the verti es of C are also split into two parts CL Ă BL and

CR Ă BR , ea h of whi h

onsists of

onse utive verti es.

Now, all the points in BR (and hen e in CR ) move out from B under t, sin e they are

the rightmost points of B on the

orresponding horizontal lines. It remains to prove that the

verti es of CL whi h stay in B under t are

onse utive.

For this purpose, let C1 , C2 , and C3 be three verti es in CL su h that C2 is between C1
and C3 , and tpC1 q and tpC3 q lie in B ; we need to prove that tpC2 q P B as well. Let Ai “ tpCi q.

v
The line through C2 parallel to ~

this line

rosses the segment C1 C3 to the right of C2 ; this means that

rosses A1 A3 to the right of A2 , so A2 lies inside the triangle A1 C2 A3 whi h is

in B . This yields the desired result.

Case 2: C is a homotheti image of A entered at X with fa tor k ą 0.

ontained

Shortlisted problems  solutions

65

Denote by h the homothety mapping C to A. We need now to prove that the verti es of C
whi h stay in B after applying h are

onse utive. If X P B , the

laim is easy. Indeed, if k ă 1,

then the verti es of A lie on the segments of the form XC (C being a vertex of C ) whi h lie
in B . If k ą 1, then the verti es of A lie on the extensions of su h segments XC beyond C ,
and almost all these extensions lie outside B . The ex eptions may o

lies on the boundary of B , and they may
of B . But even in this

ase when X

ur only in

ause one or two verti es of A stay on the boundary

ase those verti es are still

onse utive.

So, from now on we assume that X R B .

Now, there are two verti es BT and BB of B su h that B is

ontained in the angle =BT XBB ;

if there are several options, say, for BT , then we hoose the farthest one from X if k ą 1, and the

nearest one if k ă 1. For the visualization purposes, we refer the plane to Cartesian
so that the y -axis is

Ý
ÝÝÝ
Ñ

oordinates

o-dire tional with BB BT , and X lies to the left of the line BT BB . Again,

the perimeter of B is split by BT and BB into the

right part BR and the left part BL , and the

set of verti es of C is split into two subsets CR Ă BR and CL Ă BL .

BT
A1

C11111
C

B
C

A
A22222

C22222
C

X

BR
A3

C33333
C
BB

X
X

C
A

Sub ase 2.1: k ą 1

Case 2, X inside B

Sub ase 2.1: k ą 1.

In this sub ase, all points from BR (and hen e from CR ) move out from B under h, be ause

they are the farthest points of B on the

orresponding rays emanated from X . It remains to

prove that the verti es of CL whi h stay in B under h are

onse utive.

Again, let C1 , C2 , C3 be three verti es in CL su h that C2 is between C1 and C3 , and hpC1 q

and hpC3 q lie in B . Let Ai “ hpCi q. Then the ray XC2
so this ray

rosses the segment C1 C3 beyond C2 ,

rosses A1 A3 beyond A2 ; this implies that A2 lies in the triangle A1 C2 A3 , whi h is

ontained in B .

BT

C3333
C
A3
C22222
C

X

A
A22222
BR

A
A
A11111
BB

Sub ase 2.2: k ă 1.
This

ase is

C
C11111
C

Sub ase 2.2: k ă 1

ompletely similar to the previous one. All points from BL (and hen e from CL

move out from B under h, be ause they are the nearest points of B on the

orresponding

66

IMO 2017, Rio de Janeiro

Assume that C1 , C2 , and C3 are three verti es in CR su h that C2

rays emanated from X .

C1 and C3 , and hpC1 q and hpC3 q lie in B; let Ai “ hpCi q. Then A2 lies on
the segment XC2 , and the segments XA2 and A1 A3 ross ea h other. Thus A2 lies in the
triangle A1 C2 A3 , whi h is ontained in B .

lies between

In fa t, Case 1 an be redu ed to Case 2 via the following argument.
Assume that A and C are ongruent. Apply to A a homothety entered at OB with a fa tor slightly
smaller than 1 to obtain a polygon A1 . With appropriately hosen fa tor, the verti es of A whi h were
outside/inside B stay outside/inside it, so it su es to prove our laim for A1 instead of A. And now,
the polygon A1 is a homotheti image of C , so the arguments from Case 2 apply.

Comment 1.

After the polygon C has been found, the rest of the solution uses only the onvexity of
the polygons, instead of regularity. Thus, it proves a more general statement:
Assume that A, B , and C are three onvex polygons in the plane su h that C is ins ribed into B ,
and A an be obtained from it via either translation or positive homothety. Then the verti es of A that
lie inside B or on its boundary are onse utive.
Comment 2.

Solution 2.

Let OA and OB be the

enters of A and B , respe tively. Denote rns “ t1, 2, . . . , nu.

We start with introdu ing appropriate enumerations and notations. Enumerate the
of B
to

lo kwise as ℓ1 , ℓ2 , . . . , ℓn . Denote by Hi the half-plane of ℓi that

ontain ℓi ); by Bi the

sidelines

ontains B (Hi is assumed

Ñ
Ý

ÝÝÝÑ

midpoint of the side belonging to ℓi ; and nally denote bi “ Bi OB .

(As usual, the numbering is

y li

modulo n, so ℓn`i “ ℓi et .)

ÝÝÝÑ
A1 of A su h that the ve tor OA A1 points mostly outside H1 ;
Ý
ÝÝÝÑ Ñ
stri tly speaking, this means that the s alar produ t xOA A1 , b1 y is minimal. Starting from A1 ,
enumerate the verti es of A lo kwise as A1 , A2 , . . . , An ; by the rotational symmetry, the hoi e
ÝÝÝÑ
of A1 yields that the ve tor OA Ai points mostly outside Hi , i.e.,
Ý
Ý
ÝÝÝÑ Ñ
ÝÝÝÑ Ñ
xOA Ai , bi y “ minxOA Aj , bi y.
(1)
Now,

hoose a vertex

jPrns

ℓ2
B1

−
→
b1

A1

ℓ1
H11111
H

ℓ3

B2
A2
−
→
b2

Bn

−
→
b3

B3

A3

−
→
bn

An

OB

A

B

OA

Enumerations and notations
We intend to reformulate the problem in more

ombinatorial terms, for whi h purpose we

introdu e the following notion. Say that a subset I Ď rns is
set are

onse utive in the

edge, this subset is

y li

mod n by an

onne ted in the usual graph sense). Clearly, the union of two

subsets sharing at least one element is

onne ted

onne ted too. Next, for any half-plane H the indi es

of verti es of, say, A that lie in H form a
To a

onne ted if the elements of this

order (in other words, if we join ea h i with i ` 1

onne ted set.

ess the problem, we denote

M “ tj P rns : Aj R Bu,

We need to prove that rns z M is
the other hand, sin e B “

investigate.

Ş

Mi “ tj P rns : Aj R Hi u

for i P rns.

onne ted, whi h is equivalent to M being

Ť

onne ted. On

iPrns Hi , we have M “
iPrns Mi , where the sets Mi are easier to
We will utilize the following properties of these sets; the rst one holds by the

denition of Mi , along with the above remark.

Shortlisted problems  solutions

67

M2 = {1, 2, 3}
A
A22222

A11111
A

A33333
A
M3 = {3, 4}

ℓ2

A
A44444

M1 = {n, 1, 2}
A
Annnnn

ℓℓ33333
ℓ1

A
A

B
B

A55555
A
The sets Mi

Property 1: Ea h set Mi is onne ted.

l

Property 2: If Mi is nonempty, then i P Mi .
Proof. Indeed, we have

Ý
Ý
Ý
ÝÝÝÑ Ñ
ÝÝÝÑ Ñ
ÝÝÝÑ Ñ
j P Mi ðñ Aj R Hi ðñ xBi Aj , bi y ă 0 ðñ xOA Aj , bi y ă xOA Bi , bi y.

(2)

The right-hand part of the last inequality does not depend on j . Therefore, if some j lies in Mi ,

l

then by (1) so does i.
In view of Property 2, it is useful to dene the set

M 1 “ ti P rns : i P Mi u “ ti P rns : Mi ‰ ∅u.

Property 3: The set M 1 is onne ted.
Proof. To prove this property, we pro eed on with the investigation started in (2) to write
Ý
Ý
Ý
Ý
Ý
ÝÝ
Ñ Ñ
ÝÝÝÝÑ Ñ
ÝÝÝÑ Ñ
ÝÝÝÑ Ñ
i P M 1 ðñ Ai P Mi ðñ xBi Ai , bi y ă 0 ðñ xOB OA , bi y ă xOB Bi , bi y ` xAi OA , bi y.
The right-hand part of the obtained inequality does not depend on i, due to the rotational
Ý
ÝÝÝÝÑ Ñ
1
symmetry; denote its onstant value by µ. Thus, i P M if and only if xOB OA , bi y ă µ. This
ondition is in turn equivalent to the fa t that Bi lies in a

boundary line is orthogonal to OB OA ; thus, it denes a
Now we

M

an be obtained from M

1

1

iPrns

Mi one by one. All these sets are
1
ontains an element of M (namely, i). Thus their union is

by adding all the sets

onne ted, and ea h nonempty Mi
also

l

Ď M , we have
ď
ď
M“
Mi “ M 1 Y
Mi ,

an nish the solution. Sin e M

iPrns

so

ertain (open) half-plane whose

onne ted set.

onne ted.

Here we present a way in whi h one an ome up with a solution like the one above.
Assume, for sake of simpli ity, that OA lies inside B . Let us rst put onto the plane a very small
regular n-gon A1 entered at OA and aligned with A; all its verti es lie inside B . Now we start blowing
it up, looking at the order in whi h the verti es leave B . To go out of B , a vertex should ross a ertain
side of B (whi h is hard to des ribe), or, equivalently, to ross at least one sideline of B  and this
event is easier to des ribe. Indeed, the rst vertex of A1 to ross ℓi is the vertex A1i ( orresponding to Ai
Ñ
ÝÝÝÑ Ý
in A); more generally, the verti es A1j ross ℓi in su h an order that the s alar produ t xOA Aj , bi y does
not in rease. For dierent indi es i, these orders are just y li shifts of ea h other; and this provides
some intuition for the notions and laims from Solution 2.
Comment 3.

68

IMO 2017, Rio de Janeiro

G7.

A

onvex quadrilateral ABCD has an ins ribed

ir le with

enter I . Let Ia , Ib , Ic ,

and Id be the in enters of the triangles DAB , ABC , BCD , and CDA, respe tively. Suppose
that the

ir les AIb Id and CIb Id meet at X , and the ommon
0
ir les BIa Ic and DIa Ic meet at Y . Prove that =XIY “ 90 .

ommon external tangents of the

external tangents of the

(Kazakhstan)

ωa , ωb , ωc and ωd the ir les AIb Id , BIa Ic , CIb Id , and DIa Ic , let their
enters be Oa , Ob , Oc and Od , and let their radii be ra , rb , rc and rd , respe tively.
Claim 1. Ib Id K AC and Ia Ic K BD.
Proof. Let the in ir les of triangles ABC and ACD be tangent to the line AC at T and T 1 ,
AB`AC´BC
1
in triangle ABC , AT “
respe tively. (See the gure to the left.) We have AT “
2
AD`AC´CD
in triangle ACD , and AB ´ BC “ AD ´ CD in quadrilateral ABCD , so
2
Solution. Denote by

AT “

AC ` AD ´ CD
AC ` AB ´ BC
“
“ AT 1 .
2
2

1
This shows T “ T . As an immediate
The se ond statement

onsequen e, Ib Id K AC .

l

an be shown analogously.

D

D

Id

Id

ωa

I
Oa

T′
T
Ib

A

C

T

A

C
Ib
B

B

Claim 2. The points Oa , Ob , Oc and Od lie on the lines AI , BI , CI and DI , respe tively.
Proof. By symmetry it su es to prove the laim for Oa . (See the gure to the right above.)
Noti e rst that the in ir les of triangles ABC and ACD
the quadrilateral ABCD with homothety

an be obtained from the in ir le of

enters B and D , respe tively, and homothety fa tors

less than 1, therefore the points Ib and Id lie on the line segments BI and DI , respe tively.
As is well-known, in every triangle the altitude and the diameter of the
from the same vertex are symmetri

ir um ir le starting

about the angle bise tor. By Claim 1, in triangle AId Ib ,

the segment AT is the altitude starting from A. Sin e the foot T lies inside the segment
Ib Id , the ir um enter Oa of triangle AId Ib lies in the angle domain Ib AId in su h a way that
=Ib AT “ =Oa AId . The points Ib and Id are the in enters of triangles ABC and ACD , so the
lines AIb and AId bise t the angles =BAC and =CAD , respe tively. Then

=Oa AD “ =Oa AId ` =Id AD “ =Ib AT ` =Id AD “ 21 =BAC ` 21 =CAD “ 12 =BAD,
so Oa lies on the angle bise tor of =BAD , that is, on line AI .
The point X is the external similitude

enter of ωa and ωc ; let U be their internal similitude

enter. The points Oa and Oc lie on the perpendi ular bise tor of the
and ωc , and the two similitude
parallel to AC .

l
ommon

hord Ib Id of ωa

enters X and U lie on the same line; by Claim 2, that line is

Shortlisted problems  solutions

69

D

ωc
ωa

Id
I

Oa

W

U

Oc

X
A

C
Ib
B

Y
From the similarity of the

ir les ωa and ωc , from Oa Ib “ Oa Id “ Oa A “ ra and Oc Ib “

Oc Id “ Oc C “ rc , and from AC k Oa Oc we

an see that

Oa X
Oa U
ra
O a Ib
O a Id
Oa A
Oa I
“
“
“
“
“
“
.
Oc X
Oc U
rc
O c Ib
O c Id
Oc C
Oc I
So the points X, U, Ib , Id , I lie on the Apollonius
this Apollonius

ir le of the points Oa , Oc with ratio ra : rc . In

ir le XU is a diameter, and the lines IU and IX are respe tively the internal

and external bise tors of =Oa IOc “ =AIC , a

in the Apollonius

ording to the angle bise tor theorem. Moreover,

ir le the diameter UX is the perpendi ular bise tor of Ib Id , so the lines IX

and IU are the internal and external bise tors of =Ib IId “ =BID , respe tively.

Repeating the same argument for the points B, D instead of A, C , we get that the line IY is

the internal bise tor of =AIC and the external bise tor of =BID . Therefore, the lines IX and

IY respe tively are the internal and external bise tors of =BID , so they are perpendi ular.
In fa t the points Oa , Ob , Oc and Od lie on the line segments AI , BI , CI and DI ,
respe tively. For the point Oa this an be shown for example by =Id Oa A ` =AOa Ib “ p1800 ´
2=Oa AId q`p1800 ´2=Ib AOa q “ 360˝ ´=BAD “ =ADI `=DIA`=AIB `=IBA ą =Id IA`=AIIb .
The solution also shows that the line IY passes through the point U , and analogously, IX passes
through the internal similitude enter of ωb and ωd .
Comment.

70

IMO 2017, Rio de Janeiro

G8.

There are 2017 mutually external

tangent and no three share a
a

ommon tangent to two

ir les drawn on a bla kboard, su h that no two are

ommon tangent. A

tangent segment is a line segment that is

ir les, starting at one tangent point and ending at the other one.

Lu iano is drawing tangent segments on the bla kboard, one at a time, so that no tangent
segment interse ts any other

ir les or previously drawn tangent segments.

drawing tangent segments until no more

Lu iano keeps

an be drawn. Find all possible numbers of tangent

segments when he stops drawing.

Answer: If there were

n

(Australia)

ir les, there would always be exa tly 3pn ´ 1q segments; so the only

possible answer is 3 ¨ 2017 ´ 3 “ 6048.
Solution 1.

First,

onsider a parti ular arrangement of

ir les C1 , C2 , . . . , Cn where all the

enters are aligned and ea h Ci is e lipsed from the other ir les by its neighbors  for example,
2
taking Ci with enter pi , 0q and radius i{2 works. Then the only tangent segments that an

be drawn are between adja ent

ir les Ci and Ci`1 , and exa tly three segments

for ea h pair. So Lu iano will draw exa tly 3pn ´ 1q segments in this

For the general

nal

ase, start from a

sure we never have 4
drawn remains

C5

onguration (that is, an arrangement of

and segments in whi h no further segments
ontinuously resize and move the

ase.

C4

C3

C2

C1

an be drawn

an be drawn).

ir les

The idea of the solution is to

ir les around the plane, one by one (in parti ular, making

ir les with a ommon tangent line), and show that the number of segments

onstant as the pi ture

hanges. This way, we

an redu e any

ir le/segment

onguration to the parti ular one mentioned above, and the nal number of segments must
remain at 3n ´ 3.

Some preliminary

ir les.

onsiderations:

look at all possible tangent segments joining any two

A segment that is tangent to a

ir le A

an do so in two possible orientations  it

may

ome out of A in

same

ir le with the same orientation will never interse t ea h other. Ea h pair pA, Bq of

has 4

lo kwise or

ounter lo kwise orientation. Two segments tou hing the

hoi es of tangent segments, whi h

ir les

an be identied by their orientations  for example,

pA`, B´q would be the segment whi h omes out of A in lo kwise orientation and omes out of
B in ounter lo kwise orientation. In total, we have 2npn ´ 1q possible segments, disregarding

interse tions.

Now we pi k a

ir le C and start to

tangent segments a
our

ontinuously move and resize it, maintaining all existing

ording to their identi ations, in luding those involving C . We

hoi e of tangent segments until the

onguration rea hes a

we assume that C is kept at least ε units away from any other
onstant; therefore at a transition either: (1) a

an keep

transition. We lose nothing if

ir le, where ε is a positive, xed

urrently drawn tangent segment t suddenly

be omes obstru ted; or (2) a urrently absent tangent segment t suddenly be omes unobstru ted
and available.

Claim. A transition an only o

ur when three

ir les C1 , C2 , C3 are tangent to a

ommon line ℓ

ontaining t, in a way su h that the three tangent segments lying on ℓ (joining the three
pairwise) are not obstru ted by any other

ir les

ir les or tangent segments (other than C1 , C2 , C3 ).

Proof. Sin e (2) is ee tively the reverse of (1), it su es to prove the laim for (1). Suppose t
has suddenly be ome obstru ted, and let us

onsider two

ases.

Shortlisted problems  solutions

71

Case 1: t be omes obstru ted by a ir le

t

t

t

Ø
Then the new

Ø

ir le be omes the third

ir le tangent to ℓ, and no other

ir les or tangent

segments are obstru ting t.

Case 2: t be omes obstru ted by another tangent segment t1
1
When two segments t and t rst interse t ea h other, they must do so at a vertex of one of
1
them. But if a vertex of t rst rossed an interior point of t, the ir le asso iated to this vertex
was already blo king t (absurd), or is about to (we already took are of this in ase 1). So we
1
only have to analyze the possibility of t and t suddenly having a ommon vertex. However,
if that happens, this vertex must belong to a single

ir le (remember we are keeping dierent

ir les at least ε units apart from ea h other throughout the moving/resizing pro ess), and
therefore they must have dierent orientations with respe t to that

ir le.

t′

t′

t′

t
t

t

Ø

Ø

1
Thus, at the transition moment, both t and t are tangent to the same

ir le at a

ommon

point, that is, they must be on the same line ℓ and hen e we again have three
ously tangent to ℓ. Also no other

ir les simultane1
ir les or tangent segments are obstru ting t or t (otherwise,

l

they would have disappeared before this transition).
Next, we fo us on the maximality of a
sition, where three

ordered by their tangent points.

onguration immediately before and after a tran-

ommon tangent line ℓ. Let the three

ir les share a

ir les be C1 , C2 , C3 ,

The only possibly ae ted segments are the ones lying on

ℓ, namely t12 , t23 and t13 . Sin e C2 is in the middle, t12 and t23 must have dierent orientations with respe t to C2 . For C1 , t12 and t13 must have the same orientation, while for C3 , t13
and t23 must have the same orientation. The gure below summarizes the situation, showing
1
1
alternative positions for C1 (namely, C1 and C1 ) and for C3 (C3 and C3 ).

C2
C3

C1

t12
C1′

t23
C3′

72

IMO 2017, Rio de Janeiro

Now perturb the diagram slightly so the three

ir les no longer have a

while preserving the denition of t12 , t23 and t13 a
that no other

ir les or tangent segments

tangent segments joining the same

ommon tangent,

ording to their identi ations. First note

an obstru t any of these segments. Also re all that

ir le at the same orientation will never obstru t ea h other.

The availability of the tangent segments

an now be

he ked using simple diagrams.

Case 1: t13 passes through C2

C2
C3

C1
t13
t12

t23

C1′
In this

C3′

ase, t13 is not available, but both t12 and t23 are.

Case 2: t13 does not pass through C2

C2
C3

C1
t23

t12
t13
C1′

C3′

Now t13 is available, but t12 and t23 obstru t ea h other, so only one
In any

ase, exa tly 2 out of these 3 segments

segments remains
Solution 2.

the

an be drawn.

an be drawn. Thus the maximal number of

onstant as we move or resize the

ir les, and we are done.

First note that all tangent segments lying on the boundary of the

onvex hull of

ir les are always drawn sin e they do not interse t anything else. Now in the nal pi ture,

aside from the n

ir les, the bla kboard is divided into regions. We

as a plane (multi-)graph G in whi h the

an

onsider the pi ture

ir les are the verti es and the tangent segments are

the edges. The idea of this solution is to nd a relation between the number of edges and the
number of regions in G; then, on e we prove that G is

onne ted, we

an use Euler's formula

to nish the problem.
The boundary of ea h region

onsists of 1 or more (for now) simple

losed

urves, ea h

made of ar s and tangent segments. The segment and the ar

might meet smoothly (as in Si ,

i “ 1, 2, . . . , 6 in the gure below) or not (as in P1 , P2 , P3 , P4 ;

all su h points

sharp orners of

the boundary). In other words, if a person walks along the border, her dire tion would suddenly

turn an angle of π at a sharp

orner.

Shortlisted problems  solutions

73

S4

P2

P3
S3

S5

S2
S6
S1
P4
P1

Claim 1. The outer boundary B1 of any internal region has at least 3 sharp orners.
Proof. Let a person walk one lap along B1 in the ounter lo kwise orientation. As she does
so, she will turn lo kwise as she moves along the ir le ar s, and not turn at all when moving
along the lines. On the other hand, her total rotation after one lap is 2π in the ounter lo kwise
dire tion! Where

ould she be turning

ounter lo kwise? She

an only do so at sharp

and, even then, she turns only an angle of π there. But two sharp
at least one ar

orners,

orners are not enough, sin e

must be presentso she must have gone through at least 3 sharp

orners.

l

Claim 2. Ea h internal region is simply onne ted, that is, has only one boundary urve.
Proof. Suppose, by ontradi tion, that some region has an outer boundary B1 and inner boundaries B2 , B3 , . . . , Bm (m ě 2). Let P1 be one of the sharp
Now

onsider a

ar starting at P1 and traveling

orners of B1 .

ounter lo kwise along B1 .

It starts in

reverse, i.e., it is initially fa ing the

orner P1 . Due to the tangent

in a way so that its orientation only

hanges when it is moving along an ar . In parti ular, this

means the

ar will sometimes travel forward. For example, if the

when driving in reverse, it would

ontinue travel forward after the

immediate half-turn. This way, the orientation of the
sin e the

ar always travels

ar only

Now imagine there is a laser pointer at the front of the

B1 .

ar may travel

ar approa hes a sharp

orner

orner, instead of making an

hanges in a

lo kwise dire tion

lo kwise around ea h ar .

the laser endpoint hits P1 , but, as soon as the
around

onditions, the

ar, pointing dire tly ahead. Initially,

ar hits an ar , the endpoint moves

In fa t, the laser endpoint must move

ontinuously along

B1 !

lo kwise

Indeed, if the

endpoint ever jumped (within B1 , or from B1 to one of the inner boundaries), at the moment
of the jump the interrupted laser would be a drawable tangent segment that Lu iano missed
(see gure below for an example).

P2
P3

Car
Laser

P1

74

IMO 2017, Rio de Janeiro

Now, let P2 and P3 be the next two sharp

orners the

previous lemma assures their existen e). At P2 the

ar goes through, after P1 (the

ar starts moving forward, and at P3 it will

start to move in reverse again. So, at P3 , the laser endpoint is at P3 itself. So while the
moved

ounter lo kwise between P1 and P3 , the laser endpoint moved

ar

lo kwise between P1

and P3 . That means the laser beam itself s anned the whole region within B1 , and it should
have

l

rossed some of the inner boundaries.

Claim 3. Ea h region has exa tly 3 sharp orners.
Proof. Consider again the ar of the previous laim, with its laser still rmly atta hed to its
front, traveling the same way as before and going through the same onse utive sharp orners
P1 , P2 and P3 .

As we have seen, as the

endpoint goes

lo kwise from P1 to P3 , so together they

ar goes

ounter lo kwise from P1 to P3 , the laser
over the whole boundary. If there

were a fourth sharp

orner P4 , at some moment the laser endpoint would pass through it. But,

sin e P4 is a sharp

orner, this means the

going through P4 . Sin e the
we would have 3

ar must be on the extension of a tangent segment

ar is not on that segment itself (the

ir les with a

ar never goes through P4 ),

ommon tangent line, whi h is not allowed.

P3

Car

Laser

P2

P4
P1

l
We are now ready to nish the solution. Let r be the number of internal regions, and s be the
number of tangent segments. Sin e ea h tangent segment
to the diagram, and ea h region has exa tly 3 sharp
graph

orresponding to the diagram is

nd s “ 3n ´ 3 and r “ 2n ´ 2.

onne ted, we

ontributes exa tly 2 sharp

orners

orners, we must have 2s “ 3r . Sin e the

an use Euler's formula n ´ s ` r “ 1 and

Shortlisted problems  solutions

75

Number Theory
N1.

The sequen e a0 , a1 , a2 , . . . of positive integers satises

#?
an ,
an`1 “
an ` 3,

if

?
an is an integer

otherwise

for every n ě 0.

Determine all values of a0 ą 1 for whi h there is at least one number a su h that an “ a for

innitely many values of n.

(South Afri a)

Answer: All positive multiples of
Solution. Sin e the value of

3.

an`1 only depends on the value of an , if an “ am for two dierent

indi es n and m, then the sequen e is eventually periodi . So we look for the values of a0 for
whi h the sequen e is eventually periodi .

Claim 1.

If an ” ´1 pmod 3q, then, for all m ą n, am is not a perfe t square. It follows that

the sequen e is eventually stri tly in reasing, so it is not eventually periodi .

Proof. A square

annot be

ongruent to ´1 modulo 3, so an ” ´1 pmod 3q implies that an is

not a square, therefore an`1 “ an ` 3 ą an . As a onsequen e, an`1 ” an ” ´1 pmod 3q, so
an`1 is not a square either. By repeating the argument, we prove that, from an on, all terms of
the sequen e are not perfe t squares and are greater than their prede essors, whi h

ompletes

l

the proof.

Claim 2. If an ı ´1 pmod 3q and an ą 9 then there is an index m ą n su h that am ă an .
Proof. Let t2 be the largest perfe t square whi h is less than an . Sin e an ą 9, t is at least
3. The rst square in the sequen e an , an ` 3, an ` 6, . . . will be pt ` 1q2 , pt ` 2q2 or pt ` 3q2 ,
2
therefore there is an index m ą n su h that am ď t ` 3 ă t ă an , as laimed.
l

Claim 3. If an ” 0 pmod 3q, then there is an index m ą n su h that am “ 3.
Proof. First we noti e that, by the denition of the sequen e, a multiple of 3 is always followed
by another multiple of 3. If an P t3, 6, 9u the sequen e will eventually follow the periodi

pattern

3, 6, 9, 3, 6, 9, . . . . If an ą 9, let j be an index su h that aj is equal to the minimum value of
the set tan`1 , an`2 , . . . u. We must have aj ď 9, otherwise we ould apply Claim 2 to aj and
get a ontradi tion on the minimality hypothesis. It follows that aj P t3, 6, 9u, and the proof is
omplete.
l

Claim 4. If an ” 1 pmod 3q, then there is an index m ą n su h that am ” ´1 pmod 3q.
Proof. In the sequen e, 4 is always followed by 2 ” ´1 pmod 3q, so the laim is true for an “ 4.
If an “ 7, the next terms will be 10, 13, 16, 4, 2, . . . and the

laim is also true. For an ě 10, we

again take an index j ą n su h that aj is equal to the minimum value of the set tan`1 , an`2 , . . . u,

whi h by the denition of the sequen e

onsists of non-multiples of 3. Suppose aj ” 1 pmod 3q.

Then we must have aj ď 9 by Claim 2 and the minimality of aj . It follows that aj P t4, 7u,
so am “ 2 ă aj for some m ą j ,

ontradi ting the minimality of aj . Therefore, we must have

It follows from the previous

laims that if a0 is a multiple of 3 the sequen e will eventually

aj ” ´1 pmod 3q.
rea h the periodi

l

pattern 3, 6, 9, 3, 6, 9, . . . ; if a0 ” ´1 pmod 3q the sequen e will be stri tly

in reasing; and if a0 ” 1 pmod 3q the sequen e will be eventually stri tly in reasing.
So the sequen e will be eventually periodi

if, and only if, a0 is a multiple of 3.

76

IMO 2017, Rio de Janeiro

N2.

Let p ě 2 be a prime number. Eduardo and Fernando play the following game making

moves alternately: in ea h move, the
that was not

urrent player hooses an index i in the set t0, 1, . . . , p´1u

hosen before by either of the two players and then

hooses an element ai of the

set t0, 1, 2, 3, 4, 5, 6, 7, 8, 9u. Eduardo has the rst move. The game ends after all the indi es
i P t0, 1, . . . , p ´ 1u have been hosen. Then the following number is omputed:

M “ a0 ` 10 ¨ a1 ` ¨ ¨ ¨ ` 10

p´1

¨ ap´1 “

p´1
ÿ
j“0

aj ¨ 10j .

The goal of Eduardo is to make the number M divisible by p, and the goal of Fernando is to
prevent this.
Prove that Eduardo has a winning strategy.

Solution. We say that a player makes the move

(Moro o)
pi, ai q if he

hooses the index i and then the

element ai of the set t0, 1, 2, 3, 4, 5, 6, 7, 8, 9u in this move.
If p “ 2 or p “ 5 then Eduardo

hooses i “ 0 and a0 “ 0 in the rst move, and wins, sin e,

independently of the next moves, M will be a multiple of 10.

Now assume that the prime number p does not belong to t2, 5u. Eduardo hooses i “ p ´ 1
pp´1q{2 2
and ap´1 “ 0 in the rst move. By Fermat's Little Theorem, p10
q “ 10p´1 ” 1 pmod pq,
pp´1q{2 2
pp´1q{2
pp´1q{2
so p | p10
q ´ 1 “ p10
` 1qp10
´ 1q. Sin e p is prime, either p | 10pp´1q{2 ` 1 or
p | 10pp´1q{2 ´ 1. Thus we have two ases:

Case a: 10pp´1q{2 ” ´1 pmod pq

In this ase, for ea h move pi, ai q of Fernando, Eduardo immediately makes the move pj, aj q “
p´1
pi ` p´1
, or pj, aj q “ pi ´
, ai q, if 0 ď i ď p´3
, ai q, if p´1
ď i ď p ´ 2. We will have 10j ” ´10i
2
2
2
2
pmod pq, and so aj ¨ 10j “ ai ¨ 10j ” ´ai ¨ 10i pmod pq. Noti e that this move by Eduardo

is always possible. Indeed, immediately before a move by Fernando, for any set of the type

tr, r ` pp ´ 1q{2u with 0 ď r ď pp ´ 3q{2, either no element of this set was
by the players in the previous moves or else both elements of this set were

hosen as an index
hosen as indi es by

the players in the previous moves. Therefore, after ea h of his moves, Eduardo always makes
k
the sum of the numbers ak ¨ 10
orresponding to the already hosen pairs pk, ak q divisible by

p, and thus wins the game.

Case b: 10pp´1q{2 ” 1 pmod pq

In this ase, for ea h move pi, ai q of Fernando, Eduardo immediately makes the move pj, aj q “
p´1
pi ` p´1
, 9 ´ ai q, if 0 ď i ď p´3
, 9 ´ ai q, if p´1
ď i ď p ´ 2. The same
, or pj, aj q “ pi ´
2
2
2
2
j
i
argument as above shows that Eduardo an always make su h move. We will have 10 ” 10
pmod pq, and so aj ¨ 10j ` ai ¨ 10i ” pai ` aj q ¨ 10i “ 9 ¨ 10i pmod pq. Therefore, at the end of
k
the game, the sum of all terms ak ¨ 10 will be ongruent to
p´3

2
ÿ

i“0
and Eduardo wins the game.

9 ¨ 10i “ 10pp´1q{2 ´ 1 ” 0 pmod pq,

Shortlisted problems  solutions

N3.

77

Determine all integers n ě 2 with the following property: for any integers a1 , a2 , . . . , an

whose sum is not divisible by n, there exists an index 1 ď i ď n su h that none of the numbers

ai , ai ` ai`1 , . . . , ai ` ai`1 ` ¨ ¨ ¨ ` ai`n´1
is divisible by n. (We let ai “ ai´n when i ą n.)

(Thailand)

Answer: These integers are exa tly the prime numbers.

n “ ab, with a, b ě 2 integers, then the property in the
ase, let ak “ a for 1 ď k ď n ´ 1 and
an “ 0. The sum a1 ` a2 ` ¨ ¨ ¨ ` an “ a ¨ pn ´ 1q is not divisible by n. Let i with 1 ď i ď n be
an arbitrary index. Taking j “ b if 1 ď i ď n ´ b, and j “ b ` 1 if n ´ b ă i ď n, we have
Solution. Let us rst show that, if

statement of the problem does not hold. Indeed, in this

ai ` ai`1 ` ¨ ¨ ¨ ` ai`j´1 “ a ¨ b “ n ” 0 pmod nq.
It follows that the given example is indeed a
Now let n be a prime number. Suppose by

ounterexample to the property of the statement.
ontradi tion that the property in the statement

of the problem does not hold. Then there are integers a1 , a2 , . . . , an whose sum is not divisible
by n su h that for ea h i, 1 ď i ď n, there is j , 1 ď j ď n, for whi h the number ai ` ai`1 `

¨ ¨ ¨ ` ai`j´1 is divisible by n. Noti e that, in any su h ase, we should have 1 ď j ď n ´ 1,
sin e a1 ` a2 ` ¨ ¨ ¨ ` an is not divisible by n. So we may onstru t re ursively a nite sequen e
of integers 0 “ i0 ă i1 ă i2 ă ¨ ¨ ¨ ă in with is`1 ´ is ď n ´ 1 for 0 ď s ď n ´ 1 su h that, for
0 ď s ď n ´ 1,
ais `1 ` ais `2 ` ¨ ¨ ¨ ` ais`1 ” 0 pmod nq
(where we take indi es modulo n). Indeed, for 0 ď s ă n, we apply the previous observation
to i “ is ` 1 in order to dene is`1 “ is ` j .

In the sequen e of n ` 1 indi es i0 , i1 , i2 , . . . , in , by the pigeonhole prin iple, we have two

distin t elements whi h are
su h that is ” ir

ongruent modulo n. So there are indi es r, s with 0 ď r ă s ď n

pmod nq and

air `1 ` air `2 ` ¨ ¨ ¨ ` ais “

s´1
ÿ
j“r

paij `1 ` aij `2 ` ¨ ¨ ¨ ` aij`1 q ” 0 pmod nq.

Sin e is ” ir pmod nq, we have is ´ ir “ k ¨ n for some positive integer k , and, sin e ij`1 ´ ij ď
n ´ 1 for 0 ď j ď n ´ 1, we have is ´ ir ď pn ´ 1q ¨ n, so k ď n ´ 1. But in this ase

air `1 ` air `2 ` ¨ ¨ ¨ ` ais “ k ¨ pa1 ` a2 ` ¨ ¨ ¨ ` an q
annot be a multiple of n, sin e n is prime and neither k nor a1 ` a2 ` ¨ ¨ ¨ ` an is a multiple

of n. A

ontradi tion.

78

IMO 2017, Rio de Janeiro

N4.

Call a rational number

short if it has nitely many digits in its de imal expansion.
-tasti if there exists a number

For a positive integer m, we say that a positive integer t is m
t

10 ´ 1
10k ´ 1
is short, and su h that
is not short for any
c¨m
c¨m
1 ď k ă t. Let Spmq be the set of m-tasti numbers. Consider Spmq for m “ 1, 2, . . .. What is
the maximum number of elements in Spmq?
c P t1, 2, 3, . . . , 2017u su h that

(Turkey)

Answer:

807.

Solution. First noti e that x P Q is short if and only if there are exponents a, b ě 0 su h that
2a ¨ 5b ¨ x P Z. In fa t, if x is short, then x “ 10nk for some k and we an take a “ b “ k ; on the
2b ¨5a q
a
b
other hand, if 2 ¨ 5 ¨ x “ q P Z then x “
, so x is short.
10a`b
10t ´1
a
b
t
If m “ 2 ¨ 5 ¨ s, with gcdps, 10q “ 1, then
is short if and only if s divides 10 ´ 1. So
m
we may (and will) suppose without loss of generality that gcdpm, 10q “ 1. Dene

C “ t1 ď c ď 2017 : gcdpc, 10q “ 1u.
m-tasti numbers are then pre isely the smallest exponents t ą 0 su h that 10t ” 1
pmod cmq for some integer c P C , that is, the set of orders of 10 modulo cm. In other words,

The

Spmq “ tordcm p10q : c P Cu.
Sin e there are 4 ¨ 201 ` 3 “ 807 numbers c with 1 ď c ď 2017 and gcdpc, 10q “ 1, namely

those su h that c ” 1, 3, 7, 9 pmod 10q,

|Spmq| ď |C| “ 807.
Now we nd m su h that |Spmq| “ 807. Let

P “ t1 ă p ď 2017 : p is prime, p ‰ 2, 5u
hoose a positive integer α su h that every p P P divides 10
α
the produ t of all primes in P ), and let m “ 10 ´ 1.

and

Claim. For every c P C , we have
As an immediate

α

´ 1 (e.g. α “ ϕpT q, T being

ordcm p10q “ cα.

onsequen e, this implies |Spmq| “ |C| “ 807, nishing the problem.

Proof. Obviously ordm p10q “ α. Let t “ ordcm p10q. Then
cm  10t ´ 1

ùñ

m  10t ´ 1

ùñ

α  t.

Hen e t “ kα for some k P Zą0 . We will show that k “ c.

Denote by νp pnq the number of prime fa tors p in n, that is, the maximum exponent β for
β
 n. For every ℓ ě 1 and p P P , the Lifting the Exponent Lemma provides

whi h p

νp p10ℓα ´ 1q “ νp pp10α qℓ ´ 1q “ νp p10α ´ 1q ` νp pℓq “ νp pmq ` νp pℓq,
so

cm  10kα ´ 1 ðñ @p P P ; νp pcmq ď νp p10kα ´ 1q
ðñ @p P P ; νp pmq ` νp pcq ď νp pmq ` νp pkq
ðñ @p P P ; νp pcq ď νp pkq
ðñ c  k.
The rst su h k is k “ c, so ordcm p10q “ cα.

l

Shortlisted problems  solutions

79

The Lifting the Exponent Lemma states that, for any odd prime p, any integers a, b
oprime with p su h that p  a ´ b, and any positive integer exponent n,

Comment.

νp pan ´ bn q “ νp pa ´ bq ` νp pnq,
and, for p “ 2,

ν2 pan ´ bn q “ ν2 pa2 ´ b2 q ` νp pnq ´ 1.

Both laims an be proved by indu tion on n.

80

IMO 2017, Rio de Janeiro

N5.

Find all pairs pp, qq of prime numbers with p ą q for whi h the number

pp ` qqp`q pp ´ qqp´q ´ 1
pp ` qqp´q pp ´ qqp`q ´ 1
is an integer.

(Japan)

Answer: The only su h pair is

p3, 2q.

M “ pp ` qqp´q pp ´ qqp`q ´ 1, whi h is relatively prime with both p ` q and
p ´ q . Denote by pp ´ qq´1 the multipli ative inverse of pp ´ qq modulo M .
By eliminating the term ´1 in the numerator,
Solution. Let

pp ` qqp`q pp ´ qqp´q ´ 1 ” pp ` qqp´q pp ´ qqp`q ´ 1
pp ` qq2q ” pp ´ qq2q pmod Mq
¯2q
´
pp ` qq ¨ pp ´ qq´1
” 1 pmod Mq.

pmod Mq

(1)
(2)

Case 1: q ě 5.

Consider an arbitrary prime divisor r of M . Noti e that M is odd, so r ě 3. By p2q, the

multipli ative order of
it

an be 1, 2, q or 2q .

¯
´
pp ` qq ¨ pp ´ qq´1 modulo r is a divisor of the exponent 2q in (2), so

By Fermat's theorem, the order divides r ´ 1. So, if the order is q or 2q then r ” 1 pmod qq.
2
2
If the order is 1 or 2 then r | pp ` qq ´ pp ´ qq “ 4pq , so r “ p or r “ q . The ase r “ p is not
possible, be ause, by applying Fermat's theorem,

` ˘p
M “ pp ` qqp´q pp ´ qqp`q ´ 1 ” q p´q p´qqp`q ´ 1 “ q 2 ´ 1 ” q 2 ´ 1 “ pq ` 1qpq ´ 1q pmod pq

and the last fa tors q ´ 1 and q ` 1 are less than p and thus p ∤ M . Hen e, all prime divisors
of M are either q or of the form kq ` 1; it follows that all positive divisors of M are

ongruent

to 0 or 1 modulo q .

Now noti e that

´
¯´
¯
p´q
p`q
p´q
p`q
M “ pp ` qq 2 pp ´ qq 2 ´ 1 pp ` qq 2 pp ´ qq 2 ` 1

is the produ t of two

onse utive positive odd numbers; both should be

ongruent to 0 or 1

modulo q . But this is impossible by the assumption q ě 5. So, there is no solution in Case 1.

Case 2: q “ 2.

By p1q, we have M | pp ` qq

2q

´ pp ´ qq2q “ pp ` 2q4 ´ pp ´ 2q4 , so

pp ` 2qp´2 pp ´ 2qp`2 ´ 1 “ M ď pp ` 2q4 ´ pp ´ 2q4 ď pp ` 2q4 ´ 1,
pp ` 2qp´6 pp ´ 2qp`2 ď 1.
If p ě 7 then the left-hand side is obviously greater than 1. For p “ 5 we have
pp ` 2qp´6 pp ´ 2qp`2 “ 7´1 ¨ 37 whi h is also too large.
There remains only one

andidate, p “ 3, whi h provides a solution:

pp ` qqp`q pp ´ qqp´q ´ 1
55 ¨ 11 ´ 1
3124
“
“
“ 781.
p´q
p`q
1
5
pp ` qq pp ´ qq
´1
5 ¨1 ´1
4
So in Case 2 the only solution is pp, qq “ p3, 2q.

Shortlisted problems  solutions

81

Case 3: q “ 3.

Similarly to Case 2, we have

M | pp ` qq2q ´ pp ´ qq2q “ 64 ¨
Sin e M is odd, we

˜ˆ

p`3
2

˙6

ˆ

p´3
2

˙6

´

ˆ

p´3
2

˙6 ¸

.

on lude that

M|

ˆ

p`3
2

˙6

´

and

pp ` 3q

p´3

pp ´ 3q

p`3

˙6 ˆ
˙6 ˆ
˙6
p´3
p`3
p`3
´
ď
´ 1,
´1“M ď
2
2
2
64pp ` 3qp´9 pp ´ 3qp`3 ď 1.
ˆ

If p ě 11 then the left-hand side is obviously greater than 1. If p “ 7 then the left-hand side is
64 ¨ 10´2 ¨ 410 ą 1. If p “ 5 then the left-hand side is 64 ¨ 8´4 ¨ 28 “ 22 ą 1. Therefore, there is
no solution in Case 3.

82

IMO 2017, Rio de Janeiro

N6.

Find the smallest positive integer n, or show that no su h n exists, with the following

property: there are innitely many distin t n-tuples of positive rational numbers pa1 , a2 , . . . , an q

su h that both

a1 ` a2 ` ¨ ¨ ¨ ` an

and

1
1
1
`
` ¨¨¨`
a1 a2
an

are integers.

Answer:

n “ 3.

Solution 1.

(i)

(Singapore)
For n “ 1, a1 P Zą0 and

1
P Zą0 if and only if a1 “ 1. Next we show that
a1

There are nitely many px, yq P Q2ą0 satisfying x ` y P Z and x1 ` y1 P Z

a
c
Write x “
and y “
with a, b, c, d P Zą0 and gcdpa, bq “ gcdpc, dq “ 1. Then x ` y P Z
b
d
1
1
and
is equivalent to the two divisibility onditions
`
P
Z
x
y

bd | ad ` bc p1q

and

ac | ad ` bc p2q

Condition (1) implies that d | ad ` bc

ðñ d | bc ðñ d | b sin e gcdpc, dq “ 1. Still
from (1) we get b | ad ` bc ðñ b | ad ðñ b | d sin e gcdpa, bq “ 1. From b | d and
d | b we have b “ d.

a
ondition (2) shows that a “ c. Hen e x “
“ dc “ y , i.e.,
b
2
the problem amounts to nding all x P Qą0 su h that 2x P Zą0 and
P Zą0 . Letting
x
4
2
n “ 2x P Zą0 , we have that x P Zą0 ðñ n P Zą0 ðñ n “ 1, 2 or 4, and there are
1 1
nitely many solutions, namely px, yq “ p , q, p1, 1q or p2, 2q.
2 2
An analogous reasoning with

(ii)

There are innitely many triples px, y, zq P Q2ą0 su h that x ` y ` z P Z and x1 ` y1 ` z1 P Z.

We will look for triples su h that x ` y ` z “ 1, so we may write them in the form

px, y, zq “

ˆ

a
b
c
,
,
a`b`c a`b`c a`b`c

˙

with a, b, c P Zą0

We want these to satisfy

1 1 1
a`b`c a`b`c a`b`c
b`c a`c a`b
` ` “
`
`
P Z ðñ
`
`
PZ
x y z
a
b
c
a
b
c
2
Fixing a “ 1, it su es to nd innitely many pairs pb, cq P Zą0 su h that

1 1 c b
` ` ` “ 3 ðñ b2 ` c2 ´ 3bc ` b ` c “ 0
b c b c
To show that equation p˚q has innitely many solutions, we use

as

p˚q

Vieta jumping (also known

root ipping ): starting with b “ 2, c “ 3, the following algorithm generates innitely

many solutions. Let c ě b, and view p˚q as a quadrati

equation in b for c xed:

b2 ´ p3c ´ 1q ¨ b ` pc2 ` cq “ 0

p˚˚q

2
Then there exists another root b0 P Z of p˚˚q whi h satises b`b0 “ 3c´1 and b¨b0 “ c `c.
Sin e c ě b by assumption,

c2 ` c
c2 ` c
ě
ąc
b
c
Hen e from the solution pb, cq we obtain another one pc, b0 q with b0 ą c, and we an then
jump again, this time with c as the variable in the quadrati p˚q. This algorithm will
b0 “

generate an innite sequen e of distin t solutions, whose rst terms are

p2, 3q, p3, 6q, p6, 14q, p14, 35q, p35, 90q, p90, 234q, p234, 611q, p611, 1598q, p1598, 4182q, . . .

Shortlisted problems  solutions

83

Comment. Although not needed for solving this problem, we may also expli itly solve the re ursion

given by the Vieta jumping. Dene the sequen e pxn q as follows:

x0 “ 2,

x1 “ 3

Then the triple

px, y, zq “

ˆ

and

xn`2 “ 3xn`1 ´ xn ´ 1 for n ě 0

1
xn
xn`1
,
,
1 ` xn ` xn`1 1 ` xn ` xn`1 1 ` xn ` xn`1

˙

satises the problem onditions for all n P N. It is easy to show that xn “ F2n`1 ` 1, where Fn denotes
the n-th term of the Fibona i sequen e (F0 “ 0, F1 “ 1, and Fn`2 “ Fn`1 ` Fn for n ě 0).
Solution 2.

statement

n
Call the n-tuples pa1 , a2 , . . . , an q P Qą0 satisfying the

good, and those for whi h
def

f pa1 , . . . , an q “ pa1 ` a2 ` ¨ ¨ ¨ ` an q
is an integer

ˆ

onditions of the problem

1
1
1
`
` ¨¨¨`
a1 a2
an

˙

pretty. Then good n-tuples are pretty, and if pb1 , . . . , bn q is pretty then
ˆ

b2
bn
b1
,
,...,
b1 ` b2 ` ¨ ¨ ¨ ` bn b1 ` b2 ` ¨ ¨ ¨ ` bn
b1 ` b2 ` ¨ ¨ ¨ ` bn

is good sin e the sum of its

˙

omponents is 1, and the sum of the re ipro als of its

equals f pb1 , . . . , bn q. We de lare pretty n-tuples proportional to ea h other

omponents

equivalent sin e they

are pre isely those whi h give rise to the same good n-tuple. Clearly, ea h su h equivalen e

lass

ontains exa tly one n-tuple of positive integers having no ommon prime divisors. Call su h
n-tuple a primitive pretty tuple. Our task is to nd innitely many primitive pretty n-tuples.
pa`bq2
,
For n “ 1, there is learly a single primitive 1-tuple. For n “ 2, we have f pa, bq “
ab
whi h an be integral (for oprime a, b P Zą0 ) only if a “ b “ 1 (see for instan e (i) in the rst
solution).

Now we

onstru t innitely many primitive pretty triples for n “ 3. Fix b, c, k P Zą0 ; we

will try to nd su ient
Write σ
equation

“ b ` c, τ “ bc.

onditions for the existen e of an a P Qą0 su h that f pa, b, cq “ k .
From f pa, b, cq “ k , we have that a should satisfy the quadrati

a2 ¨ σ ` a ¨ pσ 2 ´ pk ´ 1qτ q ` στ “ 0

(1)

whose dis riminant is

∆ “ pσ 2 ´ pk ´ 1qτ q2 ´ 4σ 2 τ “ ppk ` 1qτ ´ σ 2 q2 ´ 4kτ 2 .
We need it to be a square of an integer, say, ∆ “ M

2

for some M P Z, i.e., we want

ppk ` 1qτ ´ σ 2 q2 ´ M 2 “ 2k ¨ 2τ 2
so that it su es to set

pk ` 1qτ ´ σ 2 “ τ 2 ` k,
The rst relation reads σ

2

“ pτ ´ 1qpk ´ τ q, so if b and c satisfy
τ ´ 1 | σ2

then k “

M “ τ 2 ´ k.

i.e.

bc ´ 1 | pb ` cq2

σ2
` τ will be integral, and we nd rational solutions to (1), namely
τ ´1

a“

σ
b`c
“
τ ´1
bc ´ 1

or

a“

τ2 ´ τ
bc ¨ pbc ´ 1q
“
σ
b`c

(2)

84

IMO 2017, Rio de Janeiro

We

an now nd innitely many pairs pb, cq satisfying (2) by Vieta jumping. For example,

if we impose

pb ` cq2 “ 5 ¨ pbc ´ 1q
then all pairs pb, cq “ pvi , vi`1 q satisfy the above

v1 “ 2, v2 “ 3,

ondition, where

vi`2 “ 3vi`1 ´ vi

for i ě 0

For pb, cq “ pvi , vi`1 q, one of the solutions to (1) will be a “ pb ` cq{pbc ´ 1q “ 5{pb ` cq “

5{pvi ` vi`1 q. Then the pretty triple pa, b, cq will be equivalent to the integral pretty triple
p5, vi pvi ` vi`1 q, vi`1 pvi ` vi`1 qq

After possibly dividing by 5, we obtain innitely many primitive pretty triples, as required.
Comment. There are many other innite series of pb, cq “ pvi , vi`1 q with bc ´ 1 | pb ` cq .

2

them are:

v1 “ 1,

v2 “ 3,

vi`1 “ 6vi ´ vi´1 ,

pvi ` vi`1 q2 “ 8 ¨ pvi vi`1 ´ 1q;

v1 “ 1,

v2 “ 5,

vi`1 “ 7vi ´ vi´1 ,

pvi ` vi`1 q2 “ 9 ¨ pvi vi`1 ´ 1q

v1 “ 1,

v2 “ 2,

vi`1 “ 7vi ´ vi´1 ,

pvi ` vi`1 q2 “ 9 ¨ pvi vi`1 ´ 1q;

(the last two are in fa t one sequen e prolonged in two possible dire tions).

Some of

Shortlisted problems  solutions

N7.

85

Say that an ordered pair px, yq of integers is an

irredu ible latti e point if x and y

For any nite set S of irredu ible latti e points, show that there is a

are relatively prime.

homogenous polynomial in two variables, f px, yq, with integer

oe ients, of degree at least 1,

su h that f px, yq “ 1 for ea h px, yq in the set S .
Note: A homogenous polynomial of degree

n is any nonzero polynomial of the form

f px, yq “ a0 xn ` a1 xn´1 y ` a2 xn´2 y 2 ` ¨ ¨ ¨ ` an´1 xy n´1 ` an y n .

(U.S.A.)

Solution 1.
First of all, we note that nding a homogenous polynomial f px, yq su h that
f px, yq “ ˘1 is enough, be ause we then have f 2 px, yq “ 1. Label the irredu ible latti e points
px1 , y1 q through pxn , yn q. If any two of these latti e points pxi , yi q and pxj , yj q lie on the same
line through the origin, then pxj , yj q “ p´xi , ´yi q be ause both of the points are irredu ible.
We then have f pxj , yj q “ ˘f pxi , yi q whenever f is homogenous, so we an assume that no two

of the latti e points are

ollinear with the origin by ignoring the extra latti e points.

Consider the homogenous polynomials ℓi px, yq “ yi x ´ xi y and dene

gi px, yq “

ź
j‰i

ℓj px, yq.

Then ℓi pxj , yj q “ 0 if and only if j “ i, be ause there is only one latti e point on ea h line

through the origin.

ai ‰ 0.

Thus, gi pxj , yj q “ 0 for all j

‰ i.

Dene ai

“ gi pxi , yi q, and note that

Note that gi px, yq is a degree n ´ 1 polynomial with the following two properties:

1.

gi pxj , yj q “ 0 if j ‰ i.

2.

gi pxi , yi q “ ai .

ě n ´ 1, there also exists a polynomial of degree N with the same two properties. Spe i ally, let Ii px, yq be a degree 1 homogenous polynomial su h that Ii pxi , yi q “ 1,
N ´pn´1q
whi h exists sin e pxi , yi q is irredu ible. Then Ii px, yq
gi px, yq satises both of the above
properties and has degree N .

For any N

We may now redu e the problem to the following

laim:

Claim: For ea h positive integer a, there is a homogenous polynomial fa px, yq, with integer
oe ients, of degree at least 1, su h that fa px, yq ” 1 pmod aq for all relatively prime px, yq.
To see that this

laim solves the problem, take a to be the least

numbers ai (1 ď i ď n).

Take fa given by the

laim,

ommon multiple of the
k
hoose some power fa px, yq that has

degree at least n ´ 1, and subtra t appropriate multiples of the gi

onstru ted above to obtain

the desired polynomial.
We prove the
hoose either:

k
laim by fa toring a. First, if a is a power of a prime pa “ p q, then we may

• fa px, yq “ pxp´1 ` y p´1qφpaq if p is odd;
• fa px, yq “ px2 ` xy ` y 2 qφpaq if p “ 2.

Now suppose a is any positive integer, and let a “ q1 q2 ¨ ¨ ¨ qk , where the qi are prime powers,

pairwise relatively prime. Let fqi be the polynomials just

onstru ted, and let Fqi be powers of

these that all have the same degree. Note that

a
a
Fqi px, yq ”
qi
qi

pmod aq

for any relatively prime x, y . By Bézout's lemma, there is an integer linear ombination of
a
the
that equals 1. Thus, there is a linear ombination of the Fqi su h that Fqi px, yq ” 1
qi
pmod aq for any relatively prime px, yq; and this polynomial is homogenous be ause all the Fqi
have the same degree.

86

IMO 2017, Rio de Janeiro

Solution 2.

As in the previous solution, label the irredu ible latti e points px1 , y1 q, . . . , pxn , yn q

and assume without loss of generality that no two of the points are

ollinear with the origin.

onstru t a homogenous polynomial f px, yq su h that f pxi , yi q “ 1 for all
1 ď i ď n.
If n “ 1: Sin e x1 and y1 are relatively prime, there exist some integers c, d su h that
cx1 ` dy1 “ 1. Then f px, yq “ cx ` dy is suitable.
If n ě 2: By the indu tion hypothesis we already have a homogeneous polynomial gpx, yq
with gpx1 , y1 q “ . . . “ gpxn´1 , yn´1 q “ 1. Let j “ deg g ,

We indu t on n to

gn px, yq “

n´1
ź
k“1

pyk x ´ xk yq,

and an “ gn pxn , yn q. By assumption, an ‰ 0. Take some integers c, d su h that cxn ` dyn “ 1.
We will

onstru t f px, yq in the form

f px, yq “ gpx, yqK ´ C ¨ gn px, yq ¨ pcx ` dyqL ,
where K and L are some positive integers and C is some integer. We assume that L “ Kj´n`1
so that f is homogenous.

Due to gpx1 , y1 q “ . . . “ gpxn´1 , yn´1 q “ 1 and gn px1 , y1 q “ . . . “ gn pxn´1 , yn´1 q “ 0, the

property f px1 , y1 q “ . . . “ f pxn´1 , yn´1 q “ 1 is automati ally satised with any

hoi e of K, L,

and C .

Furthermore,

f pxn , yn q “ gpxn , yn qK ´ C ¨ gn pxn , yn q ¨ pcxn ` dyn qL “ gpxn , yn qK ´ Can .
If we have an exponent K su h that gpxn , yn q

f pxn , yn q “ 1. We now

hoose su h a K .

K

” 1 pmod an q, then we may hoose C su h that

Consider an arbitrary prime divisor p of an . By

p | an “ gn pxn , yn q “

n´1
ź
k“1

pyk xn ´ xk yn q,

there is some 1 ď k ă n su h that xk yn ” xn yk

pmod pq. We rst show that xk xn or yk yn is
relatively prime with p. This is trivial in the ase xk yn ” xn yk ı 0 pmod pq. In the other ase,
we have xk yn ” xn yk ” 0 pmod pq, If, say p | xk , then p ∤ yk be ause pxk , yk q is irredu ible, so
p | xn ; then p ∤ yn be ause pxk , yk q is irredu ible. In summary, p | xk implies p ∤ yk yn . Similarly,
p | yn implies p ∤ xk xn .
By the homogeneity of g we have the ongruen es
xdk ¨ gpxn , yn q “ gpxk xn , xk yn q ” gpxk xn , yk xn q “ xdn ¨ gpxk , yk q “ xdn

pmod pq

p1.1q

ykd ¨ gpxn , yn q “ gpyk xn , yk yn q ” gpxk yn , yk yn q “ ynd ¨ gpxk , yk q “ ynd

pmod pq.

p1.2q

and

If p ∤ xk xn , then take the pp ´ 1q

by Fermat's theorem, in both

st

power of p1.1q; otherwise take the pp ´ 1q

ases we get

st

power of p1.2q;

gpxn , yn qp´1 ” 1 pmod pq.
If p

α

| m, then we have
gpxn , yn qp

” 1 pmod pα q,

“ n ¨ ϕpan q, whi h is a multiple of all pα´1 pp ´ 1q, is a
hoi e. (The fa tor n is added only so that K ě n and so L ą 0.)

whi h implies that the exponent K
suitable

α´1 pp´1q

Shortlisted problems  solutions

Comment. It is possible to show that there is no

87

onstant C for whi h, given any two irredu ible
latti e points, there is some homogenous polynomial f of degree at most C with integer oe ients
that takes the value 1 on the two points. Indeed, if one of the points is p1, 0q and the other is pa, bq,
the polynomial f px, yq “ a0 xn ` a1 xn´1 y ` ¨ ¨ ¨ ` an y n should satisfy a0 “ 1, and so an ” 1 pmod bq.
If a “ 3 and b “ 2k with k ě 3, then n ě 2k´2 . If we hoose 2k´2 ą C , this gives a ontradi tion.

88

IMO 2017, Rio de Janeiro

N8.

Let p be an odd prime number and Zą0 be the set of positive integers. Suppose that

a fun tion f : Zą0 ˆ Zą0 Ñ t0, 1u satises the following properties:

• f p1, 1q “ 0;
• f pa, bq ` f pb, aq “ 1 for any pair of relatively prime positive integers pa, bq not both equal
to 1;
• f pa ` b, bq “ f pa, bq for any pair of relatively prime positive integers pa, bq.
Prove that

p´1
ÿ

n“1

f pn2 , pq ě

a

2p ´ 2.

(Italy)

Denote by A the set of all pairs of oprime positive integers. Noti e that for
2
every pa, bq P A there exists a pair pu, vq P Z with ua ` vb “ 1. Moreover, if pu0 , v0 q is one
Solution 1.

su h pair, then all su h pairs are of the form pu, vq “ pu0 ` kb, v0 ´ kaq, where k P Z. So there

exists a unique su h pair pu, vq with ´b{2 ă u ď b{2; we denote this pair by pu, vq “ gpa, bq.

Lemma. Let pa, bq P A and pu, vq “ gpa, bq. Then f pa, bq “ 1 ðñ u ą 0.
Proof. We indu t on a ` b. The base ase is a ` b “ 2. In this ase, we have that a “ b “ 1,
gpa, bq “ gp1, 1q “ p0, 1q and f p1, 1q “ 0, so the laim holds.
Assume now that a ` b ą 2, and so a ‰ b, sin e a and b are

oprime. Two

ases are possible.

Case 1: a ą b.

Noti e that gpa ´ b, bq “ pu, v ` uq, sin e upa ´ bq ` pv ` uqb “ 1 and u P p´b{2, b{2s. Thus

f pa, bq “ 1 ðñ f pa ´ b, bq “ 1 ðñ u ą 0 by the indu tion hypothesis.

Case 2: a ă b. (Then, learly, b ě 2.)

Now we estimate v . Sin e vb “ 1 ´ ua, we have

1`

ab
ab
ą vb ě 1 ´ ,
2
2

so

1`a
1 a
1 a
a
ě ` ąvě ´ ą´ .
2
b 2
b 2
2

Thus 1 ` a ą 2v ą ´a, so a ě 2v ą ´a, hen e a{2 ě v ą ´a{2, and thus gpb, aq “ pv, uq.
Observe that f pa, bq “ 1

ðñ f pb, aq “ 0 ðñ f pb ´ a, aq “ 0. We know from Case 1
that gpb ´ a, aq “ pv, u ` vq. We have f pb ´ a, aq “ 0 ðñ v ď 0 by the indu tive hypothesis.
Then, sin e b ą a ě 1 and ua ` vb “ 1, we have v ď 0 ðñ u ą 0, and we are done.
l
The Lemma proves that, for all pa, bq P A, f pa, bq “ 1 if and only if the inverse of a
modulo b, taken in t1, 2, . . . , b ´ 1u, is at most b{2. Then, for any odd prime p and integer
n su h that n ı 0 pmod pq, f pn2 , pq “ 1 i the inverse of n2 mod p is less than p{2. Sin e
tn2 mod p : 1 ď n ď p ´ 1u “ tn´2 mod p : 1 ď n ď p ´ 1u, in luding multipli ities (two for
ea h quadrati

quadrati

residue in ea h set), we

on lude that the desired sum is twi e the number of

residues that are less than p{2, i.e.,

p´1
ÿ

n“1

ˇ"
*ˇ
ˇ
p ˇˇ
p´1
2
ˇ
and k mod p ă
f pn , pq “ 2 ˇ k : 1 ď k ď
.
2
2 ˇ
2

Sin e the number of perfe t squares in the interval r1, p{2q is t

on lude that

p´1
ÿ

n“1

2

f pn , pq ą 2

ˆc

p
´1
2

˙

“

a
2p ´ 2.

(1)

a
a
p{2u ą p{2 ´ 1, we

Shortlisted problems  solutions

Solution 2.

89

We provide a dierent proof for the Lemma. For this purpose, we use

ontinued

fra tions to nd gpa, bq “ pu, vq expli itly.
The fun tion f is

ompletely determined on A by the following

Claim. Represent a{b as a

ontinued fra tion; that is, let a0 be an integer and a1 , . . . , ak be

positive integers su h that ak ě 2 and

1

a
“ a0 `
b

a1 `

“ ra0 ; a1 , a2 , . . . , ak s.

1
a2 `

1
¨¨¨`

1
ak

Then f pa, bq “ 0

ðñ k is even.
Proof. We indu t on b. If b “ 1, then a{b “ ras and k “ 0. Then, for a ě 1, an easy indu tion
shows that f pa, 1q “ f p1, 1q “ 0.
Now onsider the ase b ą 1. Perform the Eu lidean division a “ qb ` r , with 0 ď r ă b.
We have r ‰ 0 be ause gcdpa, bq “ 1. Hen e
f pa, bq “ f pr, bq “ 1 ´ f pb, rq,
Then the number of terms in the

a
“ rq; a1 , . . . , ak s,
b

and

b
“ ra1 ; a2 , . . . , ak s.
r

ontinued fra tion representations of a{b and b{r dier by

one. Sin e r ă b, the indu tive hypothesis yields

f pb, rq “ 0 ðñ k ´ 1 is even,
and thus

f pa, bq “ 0 ðñ f pb, rq “ 1 ðñ k ´ 1 is odd ðñ k is even.
Now we use the following well-known properties of
Let pi and qi be

l

ontinued fra tions to prove the Lemma:

oprime positive integers with ra0 ; a1 , a2 , . . . , ai s “ pi {qi , with the notation

borrowed from the Claim. In parti ular, a{b “ ra0 ; a1 , a2 , . . . , ak s “ pk {qk . Assume that k ą 0

and dene q´1 “ 0 if ne essary. Then

• qk “ ak qk´1 ` qk´2 ,

and

• aqk´1 ´ bpk´1 “ pk qk´1 ´ qk pk´1 “ p´1qk´1.
Assume that k ą 0. Then ak ě 2, and

b
b “ qk “ ak qk´1 ` qk´2 ě ak qk´1 ě 2qk´1 ùñ qk´1 ď ,
2
with stri t inequality for k ą 1, and

p´1qk´1 qk´1 a ` p´1qk pk´1 b “ 1.
so

Now we nish the proof of the Lemma. It is immediate for k “ 0. If k “ 1, then p´1q

If k ą 1, we have qk´1 ă b{2, so

´b{2 ă 0 ď p´1qk´1qk´1 ď b{2.
´b{2 ă p´1qk´1qk´1 ă b{2.

Thus, for any k ą 0, we nd that gpa, bq “ pp´1q

k´1

qk´1 , p´1qk pk´1q, and so

f pa, bq “ 1 ðñ k is odd ðñ u “ p´1qk´1 qk´1 ą 0.

k´1

“ 1,

90

IMO 2017, Rio de Janeiro

The Lemma an also be established by observing that f is uniquely dened on A,
dening f1 pa, bq “ 1 if u ą 0 in gpa, bq “ pu, vq and f1 pa, bq “ 0 otherwise, and verifying that f1
satises all the onditions from the statement.
It seems that the main di ulty of the problem is in onje turing the Lemma.
Comment 1.

The ase p ” 1 pmod 4q is, in fa t, easier than the original problem. We have, in
general, for 1 ď a ď p ´ 1,

Comment 2.

f pa, pq “ 1 ´ f pp, aq “ 1 ´ f pp ´ a, aq “ f pa, p ´ aq “ f pa ` pp ´ aq, p ´ aq “ f pp, p ´ aq “ 1 ´ f pp ´ a, pq.

If p ” 1 pmod 4q, then a is a quadrati residue modulo p if and only if p ´ a is a quadrati residue
modulo p. Therefore, denoting by rk (with 1 ď rk ď p ´ 1) the remainder of the division of k 2 by p,
we get
p´1
p´1
p´1
ÿ
ÿ
1 ÿ
p´1
2
f prn , pq “
f pn , pq “
pf prn , pq ` f pp ´ rn , pqq “
.
2
2
n“1
n“1
n“1

ř
The estimate for the sum pn“1 f pn2 , pq an be improved by rening the nal argument
in Solution 1. In fa t, one an prove that

Comment 3.

p´1
ÿ

n“1

f pn2 , pq ě

p´1
.
16

By ounting the number of perfe t squares in the intervals rkp, pk ` 1{2qpq, we nd that
˜[dˆ
¸
˙ _ Y
p´1
p´1
]
ÿ
ÿ
a
1
k`
kp .
f pn2 , pq “
p ´
2
n“1
k“0

(2)

Ea h summand of (2) is non-negative. We now estimate the number of positive summands. Suppose
that a summand is zero, i.e.,
[ dˆ
˙ _ Y
a ]
1
k`
kp “: q.
p “
2
Then both of the numbers kp and kp ` p{2 lie within the interval rq 2 , pq ` 1q2 q. Hen e
p
ă pq ` 1q2 ´ q 2 ,
2
whi h implies
p´1
qě
.
4
?
Sin e q ď kp, if the k th summand of (2) is zero, then

kě

pp ´ 1q2
p´2
p´1
q2
ě
ą
ùñ k ě
.
p
16p
16
16

p´1
So at least the rst r p´1
16 s summands (from k “ 0 to k “ r 16 s ´ 1) are positive, and the result
follows.
Comment 4.

The bound an be further improved by using dierent methods. In fa t, we prove that
p´1
ÿ

n“1

f pn2 , pq ě

p´3
.
4

To that end, we use the Legendre symbol
$
if p  a
ˆ ˙ ’
&0
a
“ 1
if a is a nonzero quadrati residue mod p
’
p
%
´1 otherwise.

We start with the following Claim, whi h tells us that there are not too many onse utive quadrati
residues or onse utive quadrati non-residues.

Shortlisted problems  solutions

Claim.

91

řp´1 ` n ˘` n`1 ˘

“ ´1.
p
` n ˘` n`1 ˘ ` npn`1q ˘
. For 1 ď n ď p ´ 1, we get that npn ` 1q ” n2 p1 ` n´1 q pmod pq,
Proof. We have p p “
p
` npn`1q ˘ ` 1`n´1 ˘
hen e
. Sin e t1 ` n´1 mod p : 1 ď n ď p ´ 1u “ t0, 2, 3, . . . , p ´ 1 mod pu, we nd
“
p
p
n“1 p

p´1
ÿˆ

n“1

be ause

řp

` ˘

n
n“1 p

n
p

˙ˆ

n`1
p

˙

“

p´1
ÿˆ

n“1

1 ` n´1
p

˙

“

p´1
ÿˆ

n“1

n
p

˙

´ 1 “ ´1,

“ 0.

l

Observe that (1) be omes
p´1
ÿ

n“1

2

f pn , pq “ 2 |S| ,

"
ˆ ˙
*
p´1
r
S “ r: 1 ď r ď
“1 .
and
2
p

We onne t S with the sum from the laim by pairing quadrati residues and quadrati non-residues.
To that end, dene
"
ˆ ˙
*
p´1
r
1
S “ r: 1 ď r ď
and
“ ´1
2
p
*
"
ˆ ˙
r
p`1
ď r ď p ´ 1 and
“1
T “ r:
2
p
"
ˆ ˙
*
r
p`1
1
T “ r:
ď r ď p ´ 1 and
“ ´1
2
p
Sin e there are exa tly pp ´ 1q{2 nonzero quadrati residues modulo p, |S| ` |T | “ pp ´ 1q{2. Also
we obviously have |T | ` |T 1 | “ pp ´ 1q{2. Then |S| “` |T˘`1 |. ˘
For the sake of brevity, dene t “ |S| “ |T 1 |. If np n`1
“ ´1, then exa tly of one the numbers
p
`n˘
` n`1 ˘
is equal to 1, so
p and
p

ˇ"
ˆ ˙ˆ
˙
*ˇ
ˇ
ˇ
n
n
`
1
p
´
3
ˇ n: 1 ď n ď
and
“ ´1 ˇˇ ď |S| ` |S ´ 1| “ 2t.
ˇ
2
p
p
` ˘`
` ˘
`
˘
˘
On the other hand, if np n`1
is equal to ´1, and
“ ´1, then exa tly one of np and n`1
p
p
ˇ"
ˆ ˙ˆ
˙
*ˇ
ˇ
ˇ
n
n
`
1
p
`
1
ˇ n:
ď n ď p ´ 2 and
“ ´1 ˇˇ ď |T 1 | ` |T 1 ´ 1| “ 2t.
ˇ
2
p
p

Thus, taking into a ount that the middle term

` pp´1q{2 ˘` pp`1q{2 ˘
p

p

may happen to be ´1,

ˇ"
ˆ ˙ˆ
˙
*ˇ
ˇ
ˇ
n`1
ˇ n : 1 ď n ď p ´ 2 and n
“ ´1 ˇˇ ď 4t ` 1.
ˇ
p
p

This implies that
ˇ"
ˆ ˙ˆ
˙
*ˇ
ˇ
ˇ
n`1
ˇ ě pp ´ 2q ´ p4t ` 1q “ p ´ 4t ´ 3,
ˇ n : 1 ď n ď p ´ 2 and n
“
1
ˇ
ˇ
p
p

and so

´1 “

p´1
ÿˆ

n“1

n
p

˙ˆ

n`1
p

˙

ě p ´ 4t ´ 3 ´ p4t ` 1q “ p ´ 8t ´ 4,

whi h implies 8t ě p ´ 3, and thus
p´1
ÿ

n“1

f pn2 , pq “ 2t ě

p´3
.
4

92

Comment 5.

IMO 2017, Rio de Janeiro

It is possible to prove that
p´1
ÿ

n“1

f pn2 , pq ě

p´1
.
2

The ase p ” 1 pmod 4q was already mentioned, and it is the equality ase. If p ” 3 pmod 4q,
then, by a theorem of Diri hlet, we have
ˇ"
ˆ ˙
*ˇ
ˇ
ˇ
ˇ r : 1 ď r ď p ´ 1 and r “ 1 ˇ ą p ´ 1 ,
ˇ
ˇ
2
p
4

whi h implies the result.
See https://en.wikipedia.org/wiki/Quadrati _residue#Diri hlet.27s_formulas for the full
statement of the theorem. It seems that no elementary proof of it is known; a proof using omplex
analysis is available, for instan e, in Chapter 7 of the book Quadrati Residues and Non-Residues:
Sele ted Topi s, by Steve Wright, available in https://arxiv.org/abs/1408.0235.

